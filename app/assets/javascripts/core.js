var Prototype={Version:"1.7",Browser:function(){var a=navigator.userAgent,b="[object Opera]"==Object.prototype.toString.call(window.opera);return{IE:!!window.attachEvent&&!b,Opera:b,WebKit:-1<a.indexOf("AppleWebKit/"),Gecko:-1<a.indexOf("Gecko")&&-1===a.indexOf("KHTML"),MobileSafari:/Apple.*Mobile/.test(a)}}(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:function(){var a=window.Element||window.HTMLElement;return!(!a||!a.prototype)}(),SpecificElementExtensions:function(){if("undefined"!==
typeof window.HTMLDivElement)return!0;var a=document.createElement("div"),b=document.createElement("form"),c=!1;a.__proto__&&a.__proto__!==b.__proto__&&(c=!0);return c}()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(a){return a}};Prototype.Browser.MobileSafari&&(Prototype.BrowserFeatures.SpecificElementExtensions=!1);
var Class=function(){function a(){}var b;a:{for(var c in{toString:1})if("toString"===c){b=!1;break a}b=!0}return{create:function(){function b(){this.initialize.apply(this,arguments)}var c=null,f=$A(arguments);Object.isFunction(f[0])&&(c=f.shift());Object.extend(b,Class.Methods);b.superclass=c;b.subclasses=[];c&&(a.prototype=c.prototype,b.prototype=new a,c.subclasses.push(b));for(var c=0,e=f.length;c<e;c++)b.addMethods(f[c]);b.prototype.initialize||(b.prototype.initialize=Prototype.emptyFunction);
return b.prototype.constructor=b},Methods:{addMethods:function(a){var c=this.superclass&&this.superclass.prototype,f=Object.keys(a);b&&(a.toString!=Object.prototype.toString&&f.push("toString"),a.valueOf!=Object.prototype.valueOf&&f.push("valueOf"));for(var e=0,i=f.length;e<i;e++){var j=f[e],k=a[j];if(c&&Object.isFunction(k)&&"$super"==k.argumentNames()[0]){var h=k,k=function(a){return function(){return c[a].apply(this,arguments)}}(j).wrap(h);k.valueOf=h.valueOf.bind(h);k.toString=h.toString.bind(h)}this.prototype[j]=
k}return this}}}}();
(function(){function a(a){switch(a){case null:return k;case void 0:return h}switch(typeof a){case "boolean":return q;case "number":return z;case "string":return n}return p}function b(a,b){for(var e in b)a[e]=b[e];return a}function c(a){return d("",{"":a},[])}function d(b,e,c){e=e[b];a(e)===p&&"function"===typeof e.toJSON&&(e=e.toJSON(b));b=j.call(e);switch(b){case r:case u:case m:e=e.valueOf()}switch(e){case null:return"null";case !0:return"true";case !1:return"false"}switch(typeof e){case "string":return e.inspect(!0);case "number":return isFinite(e)?
String(e):"null";case "object":for(var i=0,k=c.length;i<k;i++)if(c[i]===e)throw new TypeError;c.push(e);var f=[];if(b===y){i=0;for(k=e.length;i<k;i++){var h=d(i,e,c);f.push("undefined"===typeof h?"null":h)}f="["+f.join(",")+"]"}else{for(var g=Object.keys(e),i=0,k=g.length;i<k;i++)b=g[i],h=d(b,e,c),"undefined"!==typeof h&&f.push(b.inspect(!0)+":"+h);f="{"+f.join(",")+"}"}c.pop();return f}}function g(a){return JSON.stringify(a)}function f(b){if(a(b)!==p)throw new TypeError;var e=[],c;for(c in b)b.hasOwnProperty(c)&&
e.push(c);return e}function e(a){return j.call(a)===y}function i(a){return"undefined"===typeof a}var j=Object.prototype.toString,k="Null",h="Undefined",q="Boolean",z="Number",n="String",p="Object",u="[object Boolean]",r="[object Number]",m="[object String]",y="[object Array]",v=window.JSON&&"function"===typeof JSON.stringify&&"0"===JSON.stringify(0)&&"undefined"===typeof JSON.stringify(Prototype.K);"function"==typeof Array.isArray&&(Array.isArray([])&&!Array.isArray({}))&&(e=Array.isArray);b(Object,
{extend:b,inspect:function(a){try{return i(a)?"undefined":null===a?"null":a.inspect?a.inspect():String(a)}catch(b){if(b instanceof RangeError)return"...";throw b;}},toJSON:v?g:c,toQueryString:function(a){return $H(a).toQueryString()},toHTML:function(a){return a&&a.toHTML?a.toHTML():String.interpret(a)},keys:Object.keys||f,values:function(a){var b=[],e;for(e in a)b.push(a[e]);return b},clone:function(a){return b({},a)},isElement:function(a){return!!(a&&1==a.nodeType)},isArray:e,isHash:function(a){return a instanceof
Hash},isFunction:function(a){return"[object Function]"===j.call(a)},isString:function(a){return j.call(a)===m},isNumber:function(a){return j.call(a)===r},isDate:function(a){return"[object Date]"===j.call(a)},isUndefined:i})})();
Object.extend(Function.prototype,function(){function a(a,b){for(var c=a.length,e=b.length;e--;)a[c+e]=b[e];return a}function b(b,g){b=c.call(b,0);return a(b,g)}var c=Array.prototype.slice;return{argumentNames:function(){var a=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return 1==a.length&&!a[0]?[]:a},bind:function(a){if(2>arguments.length&&Object.isUndefined(arguments[0]))return this;var g=this,f=c.call(arguments,
1);return function(){var e=b(f,arguments);return g.apply(a,e)}},bindAsEventListener:function(b){var g=this,f=c.call(arguments,1);return function(e){e=a([e||window.event],f);return g.apply(b,e)}},curry:function(){if(!arguments.length)return this;var a=this,g=c.call(arguments,0);return function(){var c=b(g,arguments);return a.apply(this,c)}},delay:function(a){var b=this,f=c.call(arguments,1);return window.setTimeout(function(){return b.apply(b,f)},1E3*a)},defer:function(){var b=a([0.01],arguments);
return this.delay.apply(this,b)},wrap:function(b){var c=this;return function(){var f=a([c.bind(this)],arguments);return b.apply(this,f)}},methodize:function(){if(this._methodized)return this._methodized;var b=this;return this._methodized=function(){var c=a([this],arguments);return b.apply(null,c)}}}}());
(function(a){function b(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function c(){return this.toISOString()}a.toISOString||(a.toISOString=b);a.toJSON||(a.toJSON=c)})(Date.prototype);RegExp.prototype.match=RegExp.prototype.test;
RegExp.escape=function(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};
var PeriodicalExecuter=Class.create({initialize:function(a,b){this.callback=a;this.frequency=b;this.currentlyExecuting=!1;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),1E3*this.frequency)},execute:function(){this.callback(this)},stop:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=!0,this.execute(),this.currentlyExecuting=!1}catch(a){throw this.currentlyExecuting=
!1,a;}}});Object.extend(String,{interpret:function(a){return null==a?"":String(a)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}});
Object.extend(String.prototype,function(){function a(a){if(Object.isFunction(a))return a;var b=new Template(a);return function(a){return b.evaluate(a)}}function b(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function c(a){var b=this.strip().match(/([^?#]*)(#.*)?$/);return!b?{}:b[1].split(a||"&").inject({},function(a,b){if((b=b.split("="))[0]){var e=decodeURIComponent(b.shift()),c=1<b.length?b.join("="):b[0];void 0!=c&&(c=decodeURIComponent(c));e in a?(Object.isArray(a[e])||(a[e]=[a[e]]),a[e].push(c)):
a[e]=c}return a})}function d(a){var b=this.unfilterJSON(),c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;c.test(b)&&(b=b.replace(c,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));try{if(!a||b.isJSON())return eval("("+b+")")}catch(k){}throw new SyntaxError("Badly formed JSON string: "+this.inspect());}function g(){var a=this.unfilterJSON();return JSON.parse(a)}var f=window.JSON&&"function"===typeof JSON.parse&&
JSON.parse('{"test": true}').test;return{gsub:function(b,c){var j="",k=this,d,c=a(c);Object.isString(b)&&(b=RegExp.escape(b));if(!b.length&&!b.source)return c=c(""),c+k.split("").join(c)+c;for(;0<k.length;)(d=k.match(b))?(j+=k.slice(0,d.index),j+=String.interpret(c(d)),k=k.slice(d.index+d[0].length)):(j+=k,k="");return j},sub:function(b,c,j){c=a(c);j=Object.isUndefined(j)?1:j;return this.gsub(b,function(a){return 0>--j?a[0]:c(a)})},scan:function(a,b){this.gsub(a,b);return String(this)},truncate:function(a,
b){a=a||30;b=Object.isUndefined(b)?"...":b;return this.length>a?this.slice(0,a-b.length)+b:String(this)},strip:String.prototype.trim||b,stripTags:function(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},stripScripts:function(){return this.replace(RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var a=RegExp(Prototype.ScriptFragment,"im");return(this.match(RegExp(Prototype.ScriptFragment,"img"))||[]).map(function(b){return(b.match(a)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(a){return eval(a)})},
escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},toQueryParams:c,parseQuery:c,toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(a){return 1>a?"":Array(a+1).join(this)},camelize:function(){return this.replace(/-+(.)?/g,function(a,
b){return b?b.toUpperCase():""})},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()},dasherize:function(){return this.replace(/_/g,"-")},inspect:function(a){var b=this.replace(/[\x00-\x1f\\]/g,function(a){return a in String.specialChar?String.specialChar[a]:"\\u00"+a.charCodeAt().toPaddedString(2,
16)});return a?'"'+b.replace(/"/g,'\\"')+'"':"'"+b.replace(/'/g,"\\'")+"'"},unfilterJSON:function(a){return this.replace(a||Prototype.JSONFilter,"$1")},isJSON:function(){var a=this;if(a.blank())return!1;a=a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@");a=a.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");a=a.replace(/(?:^|:|,)(?:\s*\[)+/g,"");return/^[\],:{}\s]*$/.test(a)},evalJSON:f?g:d,include:function(a){return-1<this.indexOf(a)},startsWith:function(a){return 0===
this.lastIndexOf(a,0)},endsWith:function(a){var b=this.length-a.length;return 0<=b&&this.indexOf(a,b)===b},empty:function(){return""==this},blank:function(){return/^\s*$/.test(this)},interpolate:function(a,b){return(new Template(this,b)).evaluate(a)}}}());
var Template=Class.create({initialize:function(a,b){this.template=a.toString();this.pattern=b||Template.Pattern},evaluate:function(a){a&&Object.isFunction(a.toTemplateReplacements)&&(a=a.toTemplateReplacements());return this.template.gsub(this.pattern,function(b){if(null==a)return b[1]+"";var c=b[1]||"";if("\\"==c)return b[2];var d=a,g=b[3],f=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/,b=f.exec(g);if(null==b)return c;for(;null!=b;){var e=b[1].startsWith("[")?b[2].replace(/\\\\]/g,"]"):b[1],d=d[e];if(null==
d||""==b[3])break;g=g.substring("["==b[3]?b[1].length:b[0].length);b=f.exec(g)}return c+String.interpret(d)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;
var $break={},Enumerable=function(){function a(a,b){var a=a||Prototype.K,e=!0;this.each(function(c,d){e=e&&!!a.call(b,c,d);if(!e)throw $break;});return e}function b(a,b){var a=a||Prototype.K,e=!1;this.each(function(c,d){if(e=!!a.call(b,c,d))throw $break;});return e}function c(a,b){var a=a||Prototype.K,e=[];this.each(function(c,d){e.push(a.call(b,c,d))});return e}function d(a,b){var e;this.each(function(c,d){if(a.call(b,c,d))throw e=c,$break;});return e}function g(a,b){var e=[];this.each(function(c,
d){a.call(b,c,d)&&e.push(c)});return e}function f(a){if(Object.isFunction(this.indexOf)&&-1!=this.indexOf(a))return!0;var b=!1;this.each(function(e){if(e==a)throw b=!0,$break;});return b}function e(){return this.map()}return{each:function(a,b){var e=0;try{this._each(function(c){a.call(b,c,e++)})}catch(c){if(c!=$break)throw c;}return this},eachSlice:function(a,b,e){var c=-a,d=[],f=this.toArray();if(1>a)return f;for(;(c+=a)<f.length;)d.push(f.slice(c,c+a));return d.collect(b,e)},all:a,every:a,any:b,
some:b,collect:c,map:c,detect:d,findAll:g,select:g,filter:g,grep:function(a,b,e){var b=b||Prototype.K,c=[];Object.isString(a)&&(a=RegExp(RegExp.escape(a)));this.each(function(d,f){a.match(d)&&c.push(b.call(e,d,f))});return c},include:f,member:f,inGroupsOf:function(a,b){b=Object.isUndefined(b)?null:b;return this.eachSlice(a,function(e){for(;e.length<a;)e.push(b);return e})},inject:function(a,b,e){this.each(function(c,d){a=b.call(e,a,c,d)});return a},invoke:function(a){var b=$A(arguments).slice(1);
return this.map(function(e){return e[a].apply(e,b)})},max:function(a,b){var a=a||Prototype.K,e;this.each(function(c,d){c=a.call(b,c,d);if(null==e||c>=e)e=c});return e},min:function(a,b){var a=a||Prototype.K,e;this.each(function(c,d){c=a.call(b,c,d);if(null==e||c<e)e=c});return e},partition:function(a,b){var a=a||Prototype.K,e=[],c=[];this.each(function(d,f){(a.call(b,d,f)?e:c).push(d)});return[e,c]},pluck:function(a){var b=[];this.each(function(e){b.push(e[a])});return b},reject:function(a,b){var e=
[];this.each(function(c,d){a.call(b,c,d)||e.push(c)});return e},sortBy:function(a,b){return this.map(function(e,c){return{value:e,criteria:a.call(b,e,c)}}).sort(function(a,b){var e=a.criteria,c=b.criteria;return e<c?-1:e>c?1:0}).pluck("value")},toArray:e,entries:e,zip:function(){var a=Prototype.K,b=$A(arguments);Object.isFunction(b.last())&&(a=b.pop());var e=[this].concat(b).map($A);return this.map(function(b,c){return a(e.pluck(c))})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+
this.toArray().inspect()+">"},find:d}}();function $A(a){if(!a)return[];if("toArray"in Object(a))return a.toArray();for(var b=a.length||0,c=Array(b);b--;)c[b]=a[b];return c}function $w(a){return!Object.isString(a)?[]:(a=a.strip())?a.split(/\s+/):[]}Array.from=$A;
(function(){function a(a,b){for(var e=0,c=this.length>>>0;e<c;e++)e in this&&a.call(b,this[e],e,this)}function b(){return e.call(this,0)}function c(a,b){b||(b=0);var e=this.length;for(0>b&&(b=e+b);b<e;b++)if(this[b]===a)return b;return-1}function d(a,b){var b=isNaN(b)?this.length:(0>b?this.length+b:b)+1,e=this.slice(0,b).reverse().indexOf(a);return 0>e?e:b-e-1}function g(){for(var a=e.call(this,0),b,c=0,d=arguments.length;c<d;c++)if(b=arguments[c],Object.isArray(b)&&!("callee"in b))for(var i=0,f=
b.length;i<f;i++)a.push(b[i]);else a.push(b);return a}var f=Array.prototype,e=f.slice,i=f.forEach;i||(i=a);Object.extend(f,Enumerable);f._reverse||(f._reverse=f.reverse);Object.extend(f,{_each:i,clear:function(){this.length=0;return this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(a){return null!=a})},flatten:function(){return this.inject([],function(a,b){if(Object.isArray(b))return a.concat(b.flatten());a.push(b);return a})},
without:function(){var a=e.call(arguments,0);return this.select(function(b){return!a.include(b)})},reverse:function(a){return(!1===a?this.toArray():this)._reverse()},uniq:function(a){return this.inject([],function(b,e,c){(0==c||(a?b.last()!=e:!b.include(e)))&&b.push(e);return b})},intersect:function(a){return this.uniq().findAll(function(b){return a.detect(function(a){return b===a})})},clone:b,toArray:b,size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+
"]"}});(function(){return 1!==[].concat(arguments)[0][0]})(1,2)&&(f.concat=g);f.indexOf||(f.indexOf=c);f.lastIndexOf||(f.lastIndexOf=d)})();function $H(a){return new Hash(a)}
var Hash=Class.create(Enumerable,function(){function a(){return Object.clone(this._object)}return{initialize:function(a){this._object=Object.isHash(a)?a.toObject():Object.clone(a)},_each:function(a){for(var c in this._object){var d=this._object[c],g=[c,d];g.key=c;g.value=d;a(g)}},set:function(a,c){return this._object[a]=c},get:function(a){if(this._object[a]!==Object.prototype[a])return this._object[a]},unset:function(a){var c=this._object[a];delete this._object[a];return c},toObject:a,toTemplateReplacements:a,
keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},index:function(a){var c=this.detect(function(c){return c.value===a});return c&&c.key},merge:function(a){return this.clone().update(a)},update:function(a){return(new Hash(a)).inject(this,function(a,b){a.set(b.key,b.value);return a})},toQueryString:function(){return this.inject([],function(a,c){var d=encodeURIComponent(c.key),g=c.value;if(g&&"object"==typeof g){if(Object.isArray(g)){for(var f=[],e=0,i=g.length,j;e<
i;e++)j=g[e],f.push(Object.isUndefined(j)?d:d+"="+encodeURIComponent(String.interpret(j)));return a.concat(f)}}else a.push(Object.isUndefined(g)?d:d+"="+encodeURIComponent(String.interpret(g)));return a}).join("&")},inspect:function(){return"#<Hash:{"+this.map(function(a){return a.map(Object.inspect).join(": ")}).join(", ")+"}>"},toJSON:a,clone:function(){return new Hash(this)}}}());Hash.from=$H;
Object.extend(Number.prototype,function(){return{toColorPart:function(){return this.toPaddedString(2,16)},succ:function(){return this+1},times:function(a,b){$R(0,this,!0).each(a,b);return this},toPaddedString:function(a,b){var c=this.toString(b||10);return"0".times(a-c.length)+c},abs:function(){return Math.abs(this)},round:function(){return Math.round(this)},ceil:function(){return Math.ceil(this)},floor:function(){return Math.floor(this)}}}());function $R(a,b,c){return new ObjectRange(a,b,c)}
var ObjectRange=Class.create(Enumerable,function(){return{initialize:function(a,b,c){this.start=a;this.end=b;this.exclusive=c},_each:function(a){for(var b=this.start;this.include(b);)a(b),b=b.succ()},include:function(a){return a<this.start?!1:this.exclusive?a<this.end:a<=this.end}}}()),Abstract={},Try={these:function(){for(var a,b=0,c=arguments.length;b<c;b++){var d=arguments[b];try{a=d();break}catch(g){}}return a}},Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},
function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},activeRequestCount:0,Responders:{responders:[],_each:function(a){this.responders._each(a)},register:function(a){this.include(a)||this.responders.push(a)},unregister:function(a){this.responders=this.responders.without(a)},dispatch:function(a,b,c,d){this.each(function(g){if(Object.isFunction(g[a]))try{g[a].apply(g,[b,c,d])}catch(f){}})}}};Object.extend(Ajax.Responders,Enumerable);
Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(a){this.options={method:"post",asynchronous:!0,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:!0,evalJS:!0};Object.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();Object.isHash(this.options.parameters)&&(this.options.parameters=this.options.parameters.toObject())}});
Ajax.Request=Class.create(Ajax.Base,{_complete:!1,timeout:!1,initialize:function($super,b,c){$super(c);this.transport=Ajax.getTransport();this.request(b)},request:function(a){this.url=a;this.method=this.options.method;a=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);["get","post"].include(this.method)||(a+=(a?"&":"")+"_method="+this.method,this.method="post");a&&"get"===this.method&&(this.url+=(this.url.include("?")?"&":"?")+a);this.parameters=
a.toQueryParams();try{var b=new Ajax.Response(this);if(this.options.onCreate)this.options.onCreate(b);Ajax.Responders.dispatch("onCreate",this,b);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body="post"==this.method?this.options.postBody||a:null;this.transport.send(this.body);if(!this.options.asynchronous&&
this.transport.overrideMimeType)this.onStateChange();this.options.timeoutDelay&&this.options.onTimeOut&&this.startTimer(this.options.timeoutDelay)}catch(c){this.dispatchException(c)}},onStateChange:function(){var a=this.transport.readyState;1<a&&!(4==a&&this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var a={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};
if("post"==this.method&&(a["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:""),this.transport.overrideMimeType&&2005>(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]))a.Connection="close";if("object"==typeof this.options.requestHeaders){var b=this.options.requestHeaders;if(Object.isFunction(b.push))for(var c=0,d=b.length;c<d;c+=2)a[b[c]]=b[c+1];else $H(b).each(function(b){a[b.key]=b.value})}for(var g in a)this.transport.setRequestHeader(g,
a[g])},success:function(){var a=this.getStatus();return!a||200<=a&&300>a||304==a},getStatus:function(){try{return 1223===this.transport.status?204:this.transport.status||0}catch(a){return 0}},clearTimeout:function(){clearTimeout(this.timer)},startTimer:function(a){this.timer=setTimeout(this.handleTimeout.bind(this),1E3*a)},handleTimeout:function(){try{this.timeout=!0,this.transport.abort(),this.options.onTimeOut(new Ajax.Response(this))}catch(a){this.dispatchException(a)}},respondToReadyState:function(a){var a=
Ajax.Request.Events[a],b=new Ajax.Response(this);if("Complete"==a&&!this.timeout){try{this._complete=!0,(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(b,b.headerJSON)}catch(c){this.dispatchException(c)}var d=b.getHeader("Content-type");("force"==this.options.evalJS||this.options.evalJS&&this.isSameOrigin()&&d&&d.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))&&this.evalResponse()}try{(this.options["on"+a]||Prototype.emptyFunction)(b,
b.headerJSON),Ajax.Responders.dispatch("on"+a,this,b,b.headerJSON)}catch(g){this.dispatchException(g)}"Complete"==a&&(this.timer&&this.clearTimeout(),this.transport.onreadystatechange=Prototype.emptyFunction)},isSameOrigin:function(){var a=this.url.match(/^\s*https?:\/\/[^\/]*/);return!a||a[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(a){try{return this.transport.getResponseHeader(a)||
null}catch(b){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(a){this.dispatchException(a)}},dispatchException:function(a){(this.options.onException||Prototype.emptyFunction)(this,a);Ajax.Responders.dispatch("onException",this,a)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];
Ajax.Response=Class.create({initialize:function(a){this.request=a;var a=this.transport=a.transport,b=this.readyState=a.readyState;if(2<b&&!Prototype.Browser.IE||4==b)this.status=this.getStatus(),this.statusText=this.getStatusText(),this.responseText=String.interpret(a.responseText),this.headerJSON=this._getHeaderJSON();4==b&&(a=a.responseXML,this.responseXML=Object.isUndefined(a)?null:a,this.responseJSON=this._getResponseJSON())},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||
""}catch(a){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(a){return null}},getResponseHeader:function(a){return this.transport.getResponseHeader(a)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var a=this.getHeader("X-JSON");if(!a)return null;a=decodeURIComponent(escape(a));try{return a.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}},
_getResponseJSON:function(){var a=this.request.options;if(!a.evalJSON||"force"!=a.evalJSON&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(a.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}}});
Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,b,c,d){this.container={success:b.success||b,failure:b.failure||(b.success?null:b)};var d=Object.clone(d),g=d.onComplete;d.onComplete=function(b,e){this.updateContent(b.responseText);Object.isFunction(g)&&g(b,e)}.bind(this);$super(c,d)},updateContent:function(a){var b=this.container[this.success()?"success":"failure"],c=this.options;c.evalScripts||(a=a.stripScripts());if(b=$(b))if(c.insertion)if(Object.isString(c.insertion)){var d=
{};d[c.insertion]=a;b.insert(d)}else c.insertion(b,a);else b.update(a)}});
Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,b,c,d){$super(d);this.onComplete=this.options.onComplete;this.frequency=this.options.frequency||2;this.decay=this.options.decay||1;this.updater={};this.container=b;this.url=c;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=void 0;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},
updateComplete:function(a){this.options.decay&&(this.decay=a.responseText==this.lastText?this.decay*this.options.decay:1,this.lastText=a.responseText);this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});
function $(a){if(1<arguments.length){for(var b=0,c=[],d=arguments.length;b<d;b++)c.push($(arguments[b]));return c}Object.isString(a)&&(a=document.getElementById(a));return Element.extend(a)}Prototype.BrowserFeatures.XPath&&(document._getElementsByXPath=function(a,b){for(var c=[],d=document.evaluate(a,$(b)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),g=0,f=d.snapshotLength;g<f;g++)c.push(Element.extend(d.snapshotItem(g)));return c});if(!Node)var Node={};
Node.ELEMENT_NODE||Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});
(function(a){var b;try{var c=document.createElement('<input name="x">');b="input"===c.tagName.toLowerCase()&&"x"===c.name}catch(d){b=!1}c=a.Element;a.Element=function(a,c){var c=c||{},a=a.toLowerCase(),e=Element.cache;if(b&&c.name)return a="<"+a+' name="'+c.name+'">',delete c.name,Element.writeAttribute(document.createElement(a),c);e[a]||(e[a]=Element.extend(document.createElement(a)));e=("select"===a?0:!("type"in c))?e[a].cloneNode(!1):document.createElement(a);return Element.writeAttribute(e,c)};
Object.extend(a.Element,c||{});c&&(a.Element.prototype=c.prototype)})(this);Element.idCounter=1;Element.cache={};Element._purgeElement=function(a){var b=a._prototypeUID;b&&(Element.stopObserving(a),a._prototypeUID=void 0,delete Element.Storage[b])};
Element.Methods={visible:function(a){return"none"!=$(a).style.display},toggle:function(a){a=$(a);Element[Element.visible(a)?"hide":"show"](a);return a},hide:function(a){a=$(a);a.style.display="none";return a},show:function(a){a=$(a);a.style.display="";return a},remove:function(a){a=$(a);a.parentNode.removeChild(a);return a},update:function(){var a;a=document.createElement("select");var b=!0;a.innerHTML='<option value="test">test</option>';a.options&&a.options[0]&&(b="OPTION"!==a.options[0].nodeName.toUpperCase());
a=b;var c;a:{try{var d=document.createElement("table");if(d&&d.tBodies){d.innerHTML="<tbody><tr><td>test</td></tr></tbody>";c="undefined"==typeof d.tBodies[0];break a}}catch(g){c=!0;break a}c=void 0}var f;try{var e=document.createElement("div");e.innerHTML="<link>";f=0===e.childNodes.length}catch(i){f=!0}var j=a||c||f,k;c=document.createElement("script");d=!1;try{c.appendChild(document.createTextNode("")),d=!c.firstChild||c.firstChild&&3!==c.firstChild.nodeType}catch(h){d=!0}k=d;return function(a,
b){for(var a=$(a),e=Element._purgeElement,c=a.getElementsByTagName("*"),d=c.length;d--;)e(c[d]);b&&b.toElement&&(b=b.toElement());if(Object.isElement(b))return a.update().insert(b);b=Object.toHTML(b);e=a.tagName.toUpperCase();if("SCRIPT"===e&&k)return a.text=b,a;if(j)if(e in Element._insertionTranslations.tags){for(;a.firstChild;)a.removeChild(a.firstChild);Element._getContentFromAnonymousElement(e,b.stripScripts()).each(function(b){a.appendChild(b)})}else if(f&&Object.isString(b)&&-1<b.indexOf("<link")){for(;a.firstChild;)a.removeChild(a.firstChild);
Element._getContentFromAnonymousElement(e,b.stripScripts(),!0).each(function(b){a.appendChild(b)})}else a.innerHTML=b.stripScripts();else a.innerHTML=b.stripScripts();b.evalScripts.bind(b).defer();return a}}(),replace:function(a,b){a=$(a);if(b&&b.toElement)b=b.toElement();else if(!Object.isElement(b)){var b=Object.toHTML(b),c=a.ownerDocument.createRange();c.selectNode(a);b.evalScripts.bind(b).defer();b=c.createContextualFragment(b.stripScripts())}a.parentNode.replaceChild(b,a);return a},insert:function(a,
b){a=$(a);if(Object.isString(b)||Object.isNumber(b)||Object.isElement(b)||b&&(b.toElement||b.toHTML))b={bottom:b};var c,d,g,f;for(f in b)c=b[f],f=f.toLowerCase(),d=Element._insertionTranslations[f],c&&c.toElement&&(c=c.toElement()),Object.isElement(c)?d(a,c):(c=Object.toHTML(c),g=("before"==f||"after"==f?a.parentNode:a).tagName.toUpperCase(),g=Element._getContentFromAnonymousElement(g,c.stripScripts()),("top"==f||"after"==f)&&g.reverse(),g.each(d.curry(a)),c.evalScripts.bind(c).defer());return a},
wrap:function(a,b,c){a=$(a);Object.isElement(b)?$(b).writeAttribute(c||{}):b=Object.isString(b)?new Element(b,c):new Element("div",b);a.parentNode&&a.parentNode.replaceChild(b,a);b.appendChild(a);return b},inspect:function(a){var a=$(a),b="<"+a.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(c){var d=c.first(),c=c.last();(d=(a[d]||"").toString())&&(b+=" "+c+"="+d.inspect(!0))});return b+">"},recursivelyCollect:function(a,b,c){for(var a=$(a),c=c||-1,d=[];(a=a[b])&&!(1==a.nodeType&&
d.push(Element.extend(a)),d.length==c););return d},ancestors:function(a){return Element.recursivelyCollect(a,"parentNode")},descendants:function(a){return Element.select(a,"*")},firstDescendant:function(a){for(a=$(a).firstChild;a&&1!=a.nodeType;)a=a.nextSibling;return $(a)},immediateDescendants:function(a){for(var b=[],a=$(a).firstChild;a;)1===a.nodeType&&b.push(Element.extend(a)),a=a.nextSibling;return b},previousSiblings:function(a){return Element.recursivelyCollect(a,"previousSibling")},nextSiblings:function(a){return Element.recursivelyCollect(a,
"nextSibling")},siblings:function(a){a=$(a);return Element.previousSiblings(a).reverse().concat(Element.nextSiblings(a))},match:function(a,b){a=$(a);return Object.isString(b)?Prototype.Selector.match(a,b):b.match(a)},up:function(a,b,c){a=$(a);if(1==arguments.length)return $(a.parentNode);var d=Element.ancestors(a);return Object.isNumber(b)?d[b]:Prototype.Selector.find(d,b,c)},down:function(a,b,c){a=$(a);return 1==arguments.length?Element.firstDescendant(a):Object.isNumber(b)?Element.descendants(a)[b]:
Element.select(a,b)[c||0]},previous:function(a,b,c){a=$(a);Object.isNumber(b)&&(c=b,b=!1);Object.isNumber(c)||(c=0);return b?Prototype.Selector.find(a.previousSiblings(),b,c):a.recursivelyCollect("previousSibling",c+1)[c]},next:function(a,b,c){a=$(a);Object.isNumber(b)&&(c=b,b=!1);Object.isNumber(c)||(c=0);if(b)return Prototype.Selector.find(a.nextSiblings(),b,c);Object.isNumber(c);return a.recursivelyCollect("nextSibling",c+1)[c]},select:function(a){var a=$(a),b=Array.prototype.slice.call(arguments,
1).join(", ");return Prototype.Selector.select(b,a)},adjacent:function(a){var a=$(a),b=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(b,a.parentNode).without(a)},identify:function(a){var a=$(a),b=Element.readAttribute(a,"id");if(b)return b;do b="anonymous_element_"+Element.idCounter++;while($(b));Element.writeAttribute(a,"id",b);return b},readAttribute:function(a,b){a=$(a);if(Prototype.Browser.IE){var c=Element._attributeTranslations.read;if(c.values[b])return c.values[b](a,
b);c.names[b]&&(b=c.names[b]);if(b.include(":"))return!a.attributes||!a.attributes[b]?null:a.attributes[b].value}return a.getAttribute(b)},writeAttribute:function(a,b,c){var a=$(a),d={},g=Element._attributeTranslations.write;"object"==typeof b?d=b:d[b]=Object.isUndefined(c)?!0:c;for(var f in d)b=g.names[f]||f,c=d[f],g.values[f]&&(b=g.values[f](a,c)),!1===c||null===c?a.removeAttribute(b):!0===c?a.setAttribute(b,b):a.setAttribute(b,c);return a},getHeight:function(a){return Element.getDimensions(a).height},
getWidth:function(a){return Element.getDimensions(a).width},classNames:function(a){return new Element.ClassNames(a)},hasClassName:function(a,b){if(a=$(a)){var c=a.className;return 0<c.length&&(c==b||RegExp("(^|\\s)"+b+"(\\s|$)").test(c))}},addClassName:function(a,b){if(a=$(a))return Element.hasClassName(a,b)||(a.className+=(a.className?" ":"")+b),a},removeClassName:function(a,b){if(a=$(a))return a.className=a.className.replace(RegExp("(^|\\s+)"+b+"(\\s+|$)")," ").strip(),a},toggleClassName:function(a,
b){if(a=$(a))return Element[Element.hasClassName(a,b)?"removeClassName":"addClassName"](a,b)},cleanWhitespace:function(a){for(var a=$(a),b=a.firstChild;b;){var c=b.nextSibling;3==b.nodeType&&!/\S/.test(b.nodeValue)&&a.removeChild(b);b=c}return a},empty:function(a){return $(a).innerHTML.blank()},descendantOf:function(a,b){a=$(a);b=$(b);if(a.compareDocumentPosition)return 8===(a.compareDocumentPosition(b)&8);if(b.contains)return b.contains(a)&&b!==a;for(;a=a.parentNode;)if(a==b)return!0;return!1},scrollTo:function(a){var a=
$(a),b=Element.cumulativeOffset(a);window.scrollTo(b[0],b[1]);return a},getStyle:function(a,b){var a=$(a),b="float"==b?"cssFloat":b.camelize(),c=a.style[b];if(!c||"auto"==c)c=(c=document.defaultView.getComputedStyle(a,null))?c[b]:null;return"opacity"==b?c?parseFloat(c):1:"auto"==c?null:c},getOpacity:function(a){return $(a).getStyle("opacity")},setStyle:function(a,b){var a=$(a),c=a.style;if(Object.isString(b))return a.style.cssText+=";"+b,b.include("opacity")?a.setOpacity(b.match(/opacity:\s*(\d?\.?\d*)/)[1]):
a;for(var d in b)"opacity"==d?a.setOpacity(b[d]):c["float"==d||"cssFloat"==d?Object.isUndefined(c.styleFloat)?"cssFloat":"styleFloat":d]=b[d];return a},setOpacity:function(a,b){a=$(a);a.style.opacity=1==b||""===b?"":1E-5>b?0:b;return a},makePositioned:function(a){var a=$(a),b=Element.getStyle(a,"position");if("static"==b||!b)a._madePositioned=!0,a.style.position="relative",Prototype.Browser.Opera&&(a.style.top=0,a.style.left=0);return a},undoPositioned:function(a){a=$(a);a._madePositioned&&(a._madePositioned=
void 0,a.style.position=a.style.top=a.style.left=a.style.bottom=a.style.right="");return a},makeClipping:function(a){a=$(a);if(a._overflow)return a;a._overflow=Element.getStyle(a,"overflow")||"auto";"hidden"!==a._overflow&&(a.style.overflow="hidden");return a},undoClipping:function(a){a=$(a);if(!a._overflow)return a;a.style.overflow="auto"==a._overflow?"":a._overflow;a._overflow=null;return a},clonePosition:function(a,b,c){var c=Object.extend({setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,
offsetLeft:0},c||{}),b=$(b),d=Element.viewportOffset(b),g=[0,0],f=null,a=$(a);"absolute"==Element.getStyle(a,"position")&&(f=Element.getOffsetParent(a),g=Element.viewportOffset(f));f==document.body&&(g[0]-=document.body.offsetLeft,g[1]-=document.body.offsetTop);c.setLeft&&(a.style.left=d[0]-g[0]+c.offsetLeft+"px");c.setTop&&(a.style.top=d[1]-g[1]+c.offsetTop+"px");c.setWidth&&(a.style.width=b.offsetWidth+"px");c.setHeight&&(a.style.height=b.offsetHeight+"px");return a}};
Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};
Prototype.Browser.Opera?(Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(a,b,c){switch(c){case "height":case "width":if(!Element.visible(b))return null;var d=parseInt(a(b,c),10);return d!==b["offset"+c.capitalize()]?d+"px":("height"===c?["border-top-width","padding-top","padding-bottom","border-bottom-width"]:["border-left-width","padding-left","padding-right","border-right-width"]).inject(d,function(c,d){var e=a(b,d);return null===e?c:c-parseInt(e,10)})+"px";default:return a(b,c)}}),
Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(a,b,c){return"title"===c?b.title:a(b,c)})):Prototype.Browser.IE?(Element.Methods.getStyle=function(a,b){var a=$(a),b="float"==b||"cssFloat"==b?"styleFloat":b.camelize(),c=a.style[b];!c&&a.currentStyle&&(c=a.currentStyle[b]);return"opacity"==b?(c=(a.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/))&&c[1]?parseFloat(c[1])/100:1:"auto"==c?("width"==b||"height"==b)&&"none"!=a.getStyle("display")?a["offset"+b.capitalize()]+
"px":null:c},Element.Methods.setOpacity=function(a,b){var a=$(a),c=a.currentStyle;if(c&&!c.hasLayout||!c&&"normal"==a.style.zoom)a.style.zoom=1;var c=a.getStyle("filter"),d=a.style;if(1==b||""===b)return(c=c.replace(/alpha\([^\)]*\)/gi,""))?d.filter=c:d.removeAttribute("filter"),a;1E-5>b&&(b=0);d.filter=c.replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+100*b+")";return a},Element._attributeTranslations=function(){var a="className",b="for",c=document.createElement("div");c.setAttribute(a,"x");"x"!==
c.className&&(c.setAttribute("class","x"),"x"===c.className&&(a="class"));c=null;c=document.createElement("label");c.setAttribute(b,"x");"x"!==c.htmlFor&&(c.setAttribute("htmlFor","x"),"x"===c.htmlFor&&(b="htmlFor"));var c=null,a={"class":a,className:a,"for":b,htmlFor:b},b=document.createElement("div"),d;b.onclick=Prototype.emptyFunction;b=b.getAttribute("onclick");-1<String(b).indexOf("{")?d=function(a,b){b=a.getAttribute(b);if(!b)return null;b=b.toString();b=b.split("{")[1];b=b.split("}")[0];return b.strip()}:
""===b&&(d=function(a,b){b=a.getAttribute(b);return!b?null:b.strip()});b=null;return{read:{names:a,values:{_getAttr:function(a,b){return a.getAttribute(b)},_getAttr2:function(a,b){return a.getAttribute(b,2)},_getAttrNode:function(a,b){var e=a.getAttributeNode(b);return e?e.value:""},_getEv:d,_flag:function(a,b){return $(a).hasAttribute(b)?b:null},style:function(a){return a.style.cssText.toLowerCase()},title:function(a){return a.title}}}}}(),Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",
cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(a,b){a.checked=!!b},style:function(a,b){a.style.cssText=b?b:""}}},Element._attributeTranslations.has={},$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(a){Element._attributeTranslations.write.names[a.toLowerCase()]=a;Element._attributeTranslations.has[a.toLowerCase()]=a}),function(a){Object.extend(a,{href:a._getAttr2,src:a._getAttr2,
type:a._getAttr,action:a._getAttrNode,disabled:a._flag,checked:a._flag,readonly:a._flag,multiple:a._flag,onload:a._getEv,onunload:a._getEv,onclick:a._getEv,ondblclick:a._getEv,onmousedown:a._getEv,onmouseup:a._getEv,onmouseover:a._getEv,onmousemove:a._getEv,onmouseout:a._getEv,onfocus:a._getEv,onblur:a._getEv,onkeypress:a._getEv,onkeydown:a._getEv,onkeyup:a._getEv,onsubmit:a._getEv,onreset:a._getEv,onselect:a._getEv,onchange:a._getEv})}(Element._attributeTranslations.read.values),Prototype.BrowserFeatures.ElementExtensions&&
function(){Element.Methods.down=function(a,b,c){a=$(a);if(1==arguments.length)return a.firstDescendant();var d;if(Object.isNumber(b)){d=a.getElementsByTagName("*");for(var g=[],f=0,e;e=d[f];f++)"!"!==e.tagName&&g.push(e);d=g[b]}else d=Element.select(a,b)[c||0];return d}}()):Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)?Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=1==b?0.999999:""===b?"":1E-5>b?0:b;return a}:Prototype.Browser.WebKit&&(Element.Methods.setOpacity=
function(a,b){a=$(a);a.style.opacity=1==b||""===b?"":1E-5>b?0:b;if(1==b)if("IMG"==a.tagName.toUpperCase()&&a.width)a.width++,a.width--;else try{var c=document.createTextNode(" ");a.appendChild(c);a.removeChild(c)}catch(d){}return a});
"outerHTML"in document.documentElement&&(Element.Methods.replace=function(a,b){a=$(a);b&&b.toElement&&(b=b.toElement());if(Object.isElement(b))return a.parentNode.replaceChild(b,a),a;var b=Object.toHTML(b),c=a.parentNode,d=c.tagName.toUpperCase();if(Element._insertionTranslations.tags[d]){var g=a.next(),d=Element._getContentFromAnonymousElement(d,b.stripScripts());c.removeChild(a);g?d.each(function(a){c.insertBefore(a,g)}):d.each(function(a){c.appendChild(a)})}else a.outerHTML=b.stripScripts();b.evalScripts.bind(b).defer();
return a});Element._returnOffset=function(a,b){var c=[a,b];c.left=a;c.top=b;return c};Element._getContentFromAnonymousElement=function(a,b,c){var d=new Element("div"),a=Element._insertionTranslations.tags[a],g=!1;a?g=!0:c&&(g=!0,a=["","",0]);if(g){d.innerHTML="&nbsp;"+a[0]+b+a[1];d.removeChild(d.firstChild);for(b=a[2];b--;)d=d.firstChild}else d.innerHTML=b;return $A(d.childNodes)};
Element._insertionTranslations={before:function(a,b){a.parentNode.insertBefore(b,a)},top:function(a,b){a.insertBefore(b,a.firstChild)},bottom:function(a,b){a.appendChild(b)},after:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};
(function(){var a=Element._insertionTranslations.tags;Object.extend(a,{THEAD:a.TBODY,TFOOT:a.TBODY,TH:a.TD})})();Element.Methods.Simulated={hasAttribute:function(a,b){var b=Element._attributeTranslations.has[b]||b,c=$(a).getAttributeNode(b);return!(!c||!c.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);
(function(a){!Prototype.BrowserFeatures.ElementExtensions&&a.__proto__&&(window.HTMLElement={},window.HTMLElement.prototype=a.__proto__,Prototype.BrowserFeatures.ElementExtensions=!0)})(document.createElement("div"));
Element.extend=function(){function a(a,b){for(var c in b){var d=b[c];Object.isFunction(d)&&!(c in a)&&(a[c]=d.methodize())}}var b;a:{if("undefined"!=typeof window.Element&&(b=window.Element.prototype)){var c="_"+(Math.random()+"").slice(2),d=document.createElement("object");b[c]="x";d="x"!==d[c];delete b[c];b=d;break a}b=!1}if(Prototype.BrowserFeatures.SpecificElementExtensions)return b?function(b){if(b&&"undefined"==typeof b._extendedByPrototype){var c=b.tagName;c&&/^(?:object|applet|embed)$/i.test(c)&&
(a(b,Element.Methods),a(b,Element.Methods.Simulated),a(b,Element.Methods.ByTag[c.toUpperCase()]))}return b}:Prototype.K;var g={},f=Element.Methods.ByTag;b=Object.extend(function(b){if(!b||"undefined"!=typeof b._extendedByPrototype||1!=b.nodeType||b==window)return b;var c=Object.clone(g),d=b.tagName.toUpperCase();f[d]&&Object.extend(c,f[d]);a(b,c);b._extendedByPrototype=Prototype.emptyFunction;return b},{refresh:function(){Prototype.BrowserFeatures.ElementExtensions||(Object.extend(g,Element.Methods),
Object.extend(g,Element.Methods.Simulated))}});b.refresh();return b}();Element.hasAttribute=document.documentElement.hasAttribute?function(a,b){return a.hasAttribute(b)}:Element.Methods.Simulated.hasAttribute;
Element.addMethods=function(a){function b(b){b=b.toUpperCase();Element.Methods.ByTag[b]||(Element.Methods.ByTag[b]={});Object.extend(Element.Methods.ByTag[b],a)}function c(a,b,c){var c=c||!1,e;for(e in a){var d=a[e];if(Object.isFunction(d)&&(!c||!(e in b)))b[e]=d.methodize()}}function d(a){var b,c={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",
Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};c[a]&&(b="HTML"+c[a]+"Element");if(window[b])return window[b];b="HTML"+a+"Element";if(window[b])return window[b];b="HTML"+a.capitalize()+"Element";if(window[b])return window[b];a=document.createElement(a);return a.__proto__||a.constructor.prototype}
var g=Prototype.BrowserFeatures,f=Element.Methods.ByTag;a||(Object.extend(Form,Form.Methods),Object.extend(Form.Element,Form.Element.Methods),Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods),BUTTON:Object.clone(Form.Element.Methods)}));if(2==arguments.length)var e=a,a=arguments[1];e?Object.isArray(e)?e.each(b):b(e):Object.extend(Element.Methods,a||{});
e=window.HTMLElement?HTMLElement.prototype:Element.prototype;g.ElementExtensions&&(c(Element.Methods,e),c(Element.Methods.Simulated,e,!0));if(g.SpecificElementExtensions)for(var i in Element.Methods.ByTag)g=d(i),Object.isUndefined(g)||c(f[i],g.prototype);Object.extend(Element,Element.Methods);delete Element.ByTag;Element.extend.refresh&&Element.extend.refresh();Element.cache={}};
document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};
(function(a){function b(b){g||(g=c.WebKit&&!d.evaluate?document:c.Opera&&9.5>window.parseFloat(window.opera.version())?document.body:document.documentElement);f[b]="client"+b;a["get"+b]=function(){return g[f[b]]};return a["get"+b]()}var c=Prototype.Browser,d=document,g,f={};a.getWidth=b.curry("Width");a.getHeight=b.curry("Height")})(document.viewport);Element.Storage={UID:1};
Element.addMethods({getStorage:function(a){if(a=$(a))return a===window?a=0:("undefined"===typeof a._prototypeUID&&(a._prototypeUID=Element.Storage.UID++),a=a._prototypeUID),Element.Storage[a]||(Element.Storage[a]=$H()),Element.Storage[a]},store:function(a,b,c){if(a=$(a))return 2===arguments.length?Element.getStorage(a).update(b):Element.getStorage(a).set(b,c),a},retrieve:function(a,b,c){if(a=$(a)){var a=Element.getStorage(a),d=a.get(b);Object.isUndefined(d)&&(a.set(b,c),d=c);return d}},clone:function(a,
b){if(a=$(a)){var c=a.cloneNode(b);c._prototypeUID=void 0;if(b)for(var d=Element.select(c,"*"),g=d.length;g--;)d[g]._prototypeUID=void 0;return Element.extend(c)}},purge:function(a){if(a=$(a)){var b=Element._purgeElement;b(a);for(var a=a.getElementsByTagName("*"),c=a.length;c--;)b(a[c]);return null}}});
(function(){function a(a,b,c){var d=null;Object.isElement(a)&&(d=a,a=d.getStyle(b));if(null===a)return null;if(/^(?:-)?\d+(\.\d+)?(px)?$/i.test(a))return window.parseFloat(a);var f=a.include("%"),g=c===document.viewport;return/\d/.test(a)&&d&&d.runtimeStyle&&(!f||!g)?(c=d.style.left,b=d.runtimeStyle.left,d.runtimeStyle.left=d.currentStyle.left,d.style.left=a||0,a=d.style.pixelLeft,d.style.left=c,d.runtimeStyle.left=b,a):d&&f?(c=c||d.parentNode,a=(a=a.match(/^(\d+)%?$/i))?Number(a[1])/100:null,f=null,
d.getStyle("position"),d=b.include("left")||b.include("right")||b.include("width"),b=b.include("top")||b.include("bottom")||b.include("height"),c===document.viewport?d?f=document.viewport.getWidth():b&&(f=document.viewport.getHeight()):d?f=$(c).measure("width"):b&&(f=$(c).measure("height")),null===f?0:f*a):0}function b(a){a=$(a);if(a.nodeType===Node.DOCUMENT_NODE||g(a)||"BODY"===a.nodeName.toUpperCase()||"HTML"===a.nodeName.toUpperCase())return $(document.body);if("inline"!==Element.getStyle(a,"display")&&
a.offsetParent)return $(a.offsetParent);for(;(a=a.parentNode)&&a!==document.body;)if("static"!==Element.getStyle(a,"position"))return"HTML"===a.nodeName.toUpperCase()?$(document.body):$(a);return $(document.body)}function c(a){var a=$(a),b=0,c=0;if(a.parentNode){do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a)}return new Element.Offset(c,b)}function d(a){var a=$(a),b=a.getLayout(),c=0,d=0;do if(c+=a.offsetTop||0,d+=a.offsetLeft||0,a=a.offsetParent){if("BODY"===a.nodeName.toUpperCase())break;
if("static"!==Element.getStyle(a,"position"))break}while(a);d-=b.get("margin-top");c-=b.get("margin-left");return new Element.Offset(d,c)}function g(a){return a!==document.body&&!Element.descendantOf(a,document.body)}var f=Prototype.K;"currentStyle"in document.documentElement&&(f=function(a){a.currentStyle.hasLayout||(a.style.zoom=1);return a});Element.Layout=Class.create(Hash,{initialize:function($super,a,b){$super();this.element=$(a);Element.Layout.PROPERTIES.each(function(a){this._set(a,null)},
this);b&&(this._preComputing=!0,this._begin(),Element.Layout.PROPERTIES.each(this._compute,this),this._end(),this._preComputing=!1)},_set:function(a,b){return Hash.prototype.set.call(this,a,b)},set:function(){throw"Properties of Element.Layout are read-only.";},get:function($super,a){var b=$super(a);return null===b?this._compute(a):b},_begin:function(){if(!this._prepared){var b=this.element,c;a:{for(c=b;c&&c.parentNode;){if("none"===c.getStyle("display")){c=!1;break a}c=$(c.parentNode)}c=!0}if(!c){b.store("prototype_original_styles",
{position:b.style.position||"",width:b.style.width||"",visibility:b.style.visibility||"",display:b.style.display||""});c=b.getStyle("position");var d=b.getStyle("width");if("0px"===d||null===d)b.style.display="block",d=b.getStyle("width");var f="fixed"===c?document.viewport:b.parentNode;b.setStyle({position:"absolute",visibility:"hidden",display:"block"});var g=b.getStyle("width");c=d&&g===d?a(b,"width",f):"absolute"===c||"fixed"===c?a(b,"width",f):$(b.parentNode).getLayout().get("width")-this.get("margin-left")-
this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right");b.setStyle({width:c+"px"})}this._prepared=!0}},_end:function(){var a=this.element,b=a.retrieve("prototype_original_styles");a.store("prototype_original_styles",null);a.setStyle(b);this._prepared=!1},_compute:function(a){var b=Element.Layout.COMPUTATIONS;if(!(a in b))throw"Property not found.";return this._set(a,b[a].call(this,this.element))},toObject:function(){var a=$A(arguments),
b={};(0===a.length?Element.Layout.PROPERTIES:a.join(" ").split(" ")).each(function(a){if(Element.Layout.PROPERTIES.include(a)){var c=this.get(a);null!=c&&(b[a]=c)}},this);return b},toHash:function(){var a=this.toObject.apply(this,arguments);return new Hash(a)},toCSS:function(){var a=$A(arguments),b={};(0===a.length?Element.Layout.PROPERTIES:a.join(" ").split(" ")).each(function(a){if(Element.Layout.PROPERTIES.include(a)&&!Element.Layout.COMPOSITE_PROPERTIES.include(a)){var c=this.get(a);if(null!=
c){var e=b;a.include("border")&&(a+="-width");a=a.camelize();e[a]=c+"px"}}},this);return b},inspect:function(){return"#<Element.Layout>"}});Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),
COMPUTATIONS:{height:function(){this._preComputing||this._begin();var a=this.get("border-box-height");if(0>=a)return this._preComputing||this._end(),0;var b=this.get("border-top"),c=this.get("border-bottom"),d=this.get("padding-top"),f=this.get("padding-bottom");this._preComputing||this._end();return a-b-c-d-f},width:function(){this._preComputing||this._begin();var a=this.get("border-box-width");if(0>=a)return this._preComputing||this._end(),0;var b=this.get("border-left"),c=this.get("border-right"),
d=this.get("padding-left"),f=this.get("padding-right");this._preComputing||this._end();return a-b-c-d-f},"padding-box-height":function(){var a=this.get("height"),b=this.get("padding-top"),c=this.get("padding-bottom");return a+b+c},"padding-box-width":function(){var a=this.get("width"),b=this.get("padding-left"),c=this.get("padding-right");return a+b+c},"border-box-height":function(a){this._preComputing||this._begin();a=a.offsetHeight;this._preComputing||this._end();return a},"border-box-width":function(a){this._preComputing||
this._begin();a=a.offsetWidth;this._preComputing||this._end();return a},"margin-box-height":function(){var a=this.get("border-box-height"),b=this.get("margin-top"),c=this.get("margin-bottom");return 0>=a?0:a+b+c},"margin-box-width":function(){var a=this.get("border-box-width"),b=this.get("margin-left"),c=this.get("margin-right");return 0>=a?0:a+b+c},top:function(a){return a.positionedOffset().top},bottom:function(a){var b=a.positionedOffset(),a=a.getOffsetParent().measure("height"),c=this.get("border-box-height");
return a-c-b.top},left:function(a){return a.positionedOffset().left},right:function(a){var b=a.positionedOffset(),a=a.getOffsetParent().measure("width"),c=this.get("border-box-width");return a-c-b.left},"padding-top":function(b){return a(b,"paddingTop")},"padding-bottom":function(b){return a(b,"paddingBottom")},"padding-left":function(b){return a(b,"paddingLeft")},"padding-right":function(b){return a(b,"paddingRight")},"border-top":function(b){return a(b,"borderTopWidth")},"border-bottom":function(b){return a(b,
"borderBottomWidth")},"border-left":function(b){return a(b,"borderLeftWidth")},"border-right":function(b){return a(b,"borderRightWidth")},"margin-top":function(b){return a(b,"marginTop")},"margin-bottom":function(b){return a(b,"marginBottom")},"margin-left":function(b){return a(b,"marginLeft")},"margin-right":function(b){return a(b,"marginRight")}}});"getBoundingClientRect"in document.documentElement&&Object.extend(Element.Layout.COMPUTATIONS,{right:function(a){var b=f(a.getOffsetParent()),a=a.getBoundingClientRect();
return(b.getBoundingClientRect().right-a.right).round()},bottom:function(a){var b=f(a.getOffsetParent()),a=a.getBoundingClientRect();return(b.getBoundingClientRect().bottom-a.bottom).round()}});Element.Offset=Class.create({initialize:function(a,b){this.left=a.round();this.top=b.round();this[0]=this.left;this[1]=this.top},relativeTo:function(a){return new Element.Offset(this.left-a.left,this.top-a.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},
toArray:function(){return[this.left,this.top]}});Prototype.Browser.IE?(b=b.wrap(function(a,b){b=$(b);if(b.nodeType===Node.DOCUMENT_NODE||g(b)||"BODY"===b.nodeName.toUpperCase()||"HTML"===b.nodeName.toUpperCase())return $(document.body);var c=b.getStyle("position");if("static"!==c)return a(b);b.setStyle({position:"relative"});var d=a(b);b.setStyle({position:c});return d}),d=d.wrap(function(a,b){b=$(b);if(!b.parentNode)return new Element.Offset(0,0);var c=b.getStyle("position");if("static"!==c)return a(b);
var d=b.getOffsetParent();d&&"fixed"===d.getStyle("position")&&f(d);b.setStyle({position:"relative"});d=a(b);b.setStyle({position:c});return d})):Prototype.Browser.Webkit&&(c=function(a){var a=$(a),b=0,c=0;do{b+=a.offsetTop||0;c+=a.offsetLeft||0;if(a.offsetParent==document.body&&"absolute"==Element.getStyle(a,"position"))break;a=a.offsetParent}while(a);return new Element.Offset(c,b)});Element.addMethods({getLayout:function(a,b){return new Element.Layout(a,b)},measure:function(a,b){return $(a).getLayout().get(b)},
getDimensions:function(a){var a=$(a),b=Element.getStyle(a,"display");if(b&&"none"!==b)return{width:a.offsetWidth,height:a.offsetHeight};var b=a.style,b={visibility:b.visibility,position:b.position,display:b.display},c={visibility:"hidden",display:"block"};"fixed"!==b.position&&(c.position="absolute");Element.setStyle(a,c);c={width:a.offsetWidth,height:a.offsetHeight};Element.setStyle(a,b);return c},getOffsetParent:b,cumulativeOffset:c,positionedOffset:d,cumulativeScrollOffset:function(a){var b=0,
c=0;do b+=a.scrollTop||0,c+=a.scrollLeft||0,a=a.parentNode;while(a);return new Element.Offset(c,b)},viewportOffset:function(a){$(f);var b=0,c=0,d=document.body,f=a;do if(b+=f.offsetTop||0,c+=f.offsetLeft||0,f.offsetParent==d&&"absolute"==Element.getStyle(f,"position"))break;while(f=f.offsetParent);f=a;do f!=d&&(b-=f.scrollTop||0,c-=f.scrollLeft||0);while(f=f.parentNode);return new Element.Offset(c,b)},absolutize:function(a){a=$(a);if("absolute"===Element.getStyle(a,"position"))return a;var c=b(a),
d=a.viewportOffset(),c=c.viewportOffset(),d=d.relativeTo(c),c=a.getLayout();a.store("prototype_absolutize_original_styles",{left:a.getStyle("left"),top:a.getStyle("top"),width:a.getStyle("width"),height:a.getStyle("height")});a.setStyle({position:"absolute",top:d.top+"px",left:d.left+"px",width:c.get("width")+"px",height:c.get("height")+"px"});return a},relativize:function(a){a=$(a);if("relative"===Element.getStyle(a,"position"))return a;var b=a.retrieve("prototype_absolutize_original_styles");b&&
a.setStyle(b);return a}});"getBoundingClientRect"in document.documentElement&&Element.addMethods({viewportOffset:function(a){a=$(a);if(g(a))return new Element.Offset(0,0);var a=a.getBoundingClientRect(),b=document.documentElement;return new Element.Offset(a.left-b.clientLeft,a.top-b.clientTop)}})})();window.$$=function(){var a=$A(arguments).join(", ");return Prototype.Selector.select(a,document)};
Prototype.Selector=function(){function a(a){for(var b=0,g=a.length;b<g;b++)Element.extend(a[b]);return a}var b=Prototype.K;return{select:function(){throw Error('Method "Prototype.Selector.select" must be defined.');},match:function(){throw Error('Method "Prototype.Selector.match" must be defined.');},find:function(a,b,g){var g=g||0,f=Prototype.Selector.match,e=a.length,i=0,j;for(j=0;j<e;j++)if(f(a[j],b)&&g==i++)return Element.extend(a[j])},extendElements:Element.extend===b?b:a,extendElement:Element.extend}}();
(function(){function a(a,b,c,d,e,f){for(var e="previousSibling"==a&&!f,g=0,j=d.length;g<j;g++){var i=d[g];if(i){e&&1===i.nodeType&&(i.sizcache=c,i.sizset=g);for(var i=i[a],h=!1;i;){if(i.sizcache===c){h=d[i.sizset];break}1===i.nodeType&&!f&&(i.sizcache=c,i.sizset=g);if(i.nodeName===b){h=i;break}i=i[a]}d[g]=h}}}function b(a,b,c,d,e,f){for(var e="previousSibling"==a&&!f,g=0,j=d.length;g<j;g++){var h=d[g];if(h){e&&1===h.nodeType&&(h.sizcache=c,h.sizset=g);for(var h=h[a],k=!1;h;){if(h.sizcache===c){k=
d[h.sizset];break}if(1===h.nodeType)if(f||(h.sizcache=c,h.sizset=g),"string"!==typeof b){if(h===b){k=!0;break}}else if(0<i.filter(b,[h]).length){k=h;break}h=h[a]}d[g]=k}}}var c=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d=0,g=Object.prototype.toString,f=!1,e=!0;[0,0].sort(function(){e=!1;return 0});var i=function(a,b,d,e){var d=d||[],f=b=b||document;if(1!==b.nodeType&&9!==b.nodeType)return[];if(!a||"string"!==
typeof a)return d;for(var l=[],h,w,s,m,n=!0,p=v(b),r=a;null!==(c.exec(""),h=c.exec(r));)if(r=h[3],l.push(h[1]),h[2]){m=h[3];break}if(1<l.length&&k.exec(a))if(2===l.length&&j.relative[l[0]])w=x(l[0]+l[1],b);else for(w=j.relative[l[0]]?[b]:i(l.shift(),b);l.length;)a=l.shift(),j.relative[a]&&(a+=l.shift()),w=x(a,w);else if(!e&&(1<l.length&&9===b.nodeType&&!p&&j.match.ID.test(l[0])&&!j.match.ID.test(l[l.length-1]))&&(h=i.find(l.shift(),b,p),b=h.expr?i.filter(h.expr,h.set)[0]:h.set[0]),b){h=e?{expr:l.pop(),
set:q(e)}:i.find(l.pop(),1===l.length&&("~"===l[0]||"+"===l[0])&&b.parentNode?b.parentNode:b,p);w=h.expr?i.filter(h.expr,h.set):h.set;for(0<l.length?s=q(w):n=!1;l.length;){var A=l.pop();h=A;j.relative[A]?h=l.pop():A="";null==h&&(h=b);j.relative[A](s,h,p)}}else s=[];s||(s=w);if(!s)throw"Syntax error, unrecognized expression: "+(A||a);if("[object Array]"===g.call(s))if(n)if(b&&1===b.nodeType)for(a=0;null!=s[a];a++)s[a]&&(!0===s[a]||1===s[a].nodeType&&y(b,s[a]))&&d.push(w[a]);else for(a=0;null!=s[a];a++)s[a]&&
1===s[a].nodeType&&d.push(w[a]);else d.push.apply(d,s);else q(s,d);m&&(i(m,f,d,e),i.uniqueSort(d));return d};i.uniqueSort=function(a){if(n&&(f=e,a.sort(n),f))for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1);return a};i.matches=function(a,b){return i(a,null,null,b)};i.find=function(a,b,c){var d,e;if(!a)return[];for(var f=0,g=j.order.length;f<g;f++){var h=j.order[f];if(e=j.leftMatch[h].exec(a)){var i=e[1];e.splice(1,1);if("\\"!==i.substr(i.length-1)&&(e[1]=(e[1]||"").replace(/\\/g,""),d=j.find[h](e,
b,c),null!=d)){a=a.replace(j.match[h],"");break}}}d||(d=b.getElementsByTagName("*"));return{set:d,expr:a}};i.filter=function(a,b,c,d){for(var e=a,f=[],g=b,h,i,k=b&&b[0]&&v(b[0]);a&&b.length;){for(var m in j.filter)if(null!=(h=j.match[m].exec(a))){var p=j.filter[m],n,q;i=!1;g==f&&(f=[]);if(j.preFilter[m])if(h=j.preFilter[m](h,g,c,f,d,k)){if(!0===h)continue}else i=n=!0;if(h)for(var r=0;null!=(q=g[r]);r++)if(q){n=p(q,h,r,g);var u=d^!!n;c&&null!=n?u?i=!0:g[r]=!1:u&&(f.push(q),i=!0)}if(void 0!==n){c||
(g=f);a=a.replace(j.match[m],"");if(!i)return[];break}}if(a==e){if(null==i)throw"Syntax error, unrecognized expression: "+a;break}e=a}return g};var j=i.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,
POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")}},relative:{"+":function(a,b,c){var d="string"===typeof b,e=d&&!/\W/.test(b),d=d&&!e;e&&!c&&(b=b.toUpperCase());for(var c=0,e=a.length,f;c<e;c++)if(f=a[c]){for(;(f=f.previousSibling)&&1!==f.nodeType;);a[c]=d||f&&f.nodeName===b?f||
!1:f===b}d&&i.filter(b,a,!0)},">":function(a,b,c){var d="string"===typeof b;if(d&&!/\W/.test(b))for(var b=c?b:b.toUpperCase(),c=0,e=a.length;c<e;c++){var f=a[c];f&&(d=f.parentNode,a[c]=d.nodeName===b?d:!1)}else{c=0;for(e=a.length;c<e;c++)(f=a[c])&&(a[c]=d?f.parentNode:f.parentNode===b);d&&i.filter(b,a,!0)}},"":function(c,t,e){var f=d++,g=b;if(!/\W/.test(t))var h=t=e?t:t.toUpperCase(),g=a;g("parentNode",t,f,c,h,e)},"~":function(c,t,e){var f=d++,g=b;if("string"===typeof t&&!/\W/.test(t))var h=t=e?t:
t.toUpperCase(),g=a;g("previousSibling",t,f,c,h,e)}},find:{ID:function(a,b,c){if("undefined"!==typeof b.getElementById&&!c)return(a=b.getElementById(a[1]))?[a]:[]},NAME:function(a,b){if("undefined"!==typeof b.getElementsByName){for(var c=[],d=b.getElementsByName(a[1]),e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return 0===c.length?null:c}},TAG:function(a,b){return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(/\\/g,"")+" ";if(f)return a;
for(var f=0,g;null!=(g=b[f]);f++)g&&(e^(g.className&&0<=(" "+g.className+" ").indexOf(a))?c||d.push(g):c&&(b[f]=!1));return!1},ID:function(a){return a[1].replace(/\\/g,"")},TAG:function(a,b){for(var c=0;!1===b[c];c++);return b[c]&&v(b[c])?a[1]:a[1].toUpperCase()},CHILD:function(a){if("nth"==a[1]){var b=/(-?)(\d*)n((?:\+|-)?\d*)/.exec("even"==a[2]&&"2n"||"odd"==a[2]&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0;a[3]=b[3]-0}a[0]=d++;return a},ATTR:function(a,b,c,d,e,f){b=a[1].replace(/\\/g,
"");!f&&j.attrMap[b]&&(a[1]=j.attrMap[b]);"~="===a[2]&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(a,b,d,e,f){if("not"===a[1])if(1<(c.exec(a[3])||"").length||/^\w/.test(a[3]))a[3]=i(a[3],null,null,b);else return a=i.filter(a[3],b,d,1^f),d||e.push.apply(e,a),!1;else if(j.match.POS.test(a[0])||j.match.CHILD.test(a[0]))return!0;return a},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return!1===a.disabled&&"hidden"!==a.type},disabled:function(a){return!0===a.disabled},checked:function(a){return!0===
a.checked},selected:function(a){a.parentNode.selectedIndex;return!0===a.selected},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!i(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){return"text"===a.type},radio:function(a){return"radio"===a.type},checkbox:function(a){return"checkbox"===a.type},file:function(a){return"file"===a.type},password:function(a){return"password"===a.type},submit:function(a){return"submit"===
a.type},image:function(a){return"image"===a.type},reset:function(a){return"reset"===a.type},button:function(a){return"button"===a.type||"BUTTON"===a.nodeName.toUpperCase()},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)}},setFilters:{first:function(a,b){return 0===b},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return 0===b%2},odd:function(a,b){return 1===b%2},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-
0==b},eq:function(a,b,c){return c[3]-0==b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=j.filters[e];if(f)return f(a,c,b,d);if("contains"===e)return 0<=(a.textContent||a.innerText||"").indexOf(b[3]);if("not"===e){b=b[3];c=0;for(d=b.length;c<d;c++)if(b[c]===a)return!1;return!0}},CHILD:function(a,b){var c=b[1],d=a;switch(c){case "only":case "first":for(;d=d.previousSibling;)if(1===d.nodeType)return!1;if("first"==c)return!0;d=a;case "last":for(;d=d.nextSibling;)if(1===d.nodeType)return!1;return!0;
case "nth":var c=b[2],e=b[3];if(1==c&&0==e)return!0;var f=b[0],g=a.parentNode;if(g&&(g.sizcache!==f||!a.nodeIndex)){for(var h=0,d=g.firstChild;d;d=d.nextSibling)1===d.nodeType&&(d.nodeIndex=++h);g.sizcache=f}d=a.nodeIndex-e;return 0==c?0==d:0==d%c&&0<=d/c}},ID:function(a,b){return 1===a.nodeType&&a.getAttribute("id")===b},TAG:function(a,b){return"*"===b&&1===a.nodeType||a.nodeName===b},CLASS:function(a,b){return-1<(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)},ATTR:function(a,b){var c=
b[1],c=j.attrHandle[c]?j.attrHandle[c](a):null!=a[c]?a[c]:a.getAttribute(c),d=c+"",e=b[2],f=b[4];return null==c?"!="===e:"="===e?d===f:"*="===e?0<=d.indexOf(f):"~="===e?0<=(" "+d+" ").indexOf(f):!f?d&&!1!==c:"!="===e?d!=f:"^="===e?0===d.indexOf(f):"$="===e?d.substr(d.length-f.length)===f:"|="===e?d===f||d.substr(0,f.length+1)===f+"-":!1},POS:function(a,b,c,d){var e=j.setFilters[b[2]];if(e)return e(a,c,b,d)}}},k=j.match.POS,h;for(h in j.match)j.match[h]=RegExp(j.match[h].source+/(?![^\[]*\])(?![^\(]*\))/.source),
j.leftMatch[h]=RegExp(/(^(?:.|\r|\n)*?)/.source+j.match[h].source);var q=function(a,b){a=Array.prototype.slice.call(a,0);return b?(b.push.apply(b,a),b):a};try{Array.prototype.slice.call(document.documentElement.childNodes,0)}catch(z){q=function(a,b){var c=b||[];if("[object Array]"===g.call(a))Array.prototype.push.apply(c,a);else if("number"===typeof a.length)for(var d=0,e=a.length;d<e;d++)c.push(a[d]);else for(d=0;a[d];d++)c.push(a[d]);return c}}var n;document.documentElement.compareDocumentPosition?
n=function(a,b){if(!a.compareDocumentPosition||!b.compareDocumentPosition)return a==b&&(f=!0),0;var c=a.compareDocumentPosition(b)&4?-1:a===b?0:1;0===c&&(f=!0);return c}:"sourceIndex"in document.documentElement?n=function(a,b){if(!a.sourceIndex||!b.sourceIndex)return a==b&&(f=!0),0;var c=a.sourceIndex-b.sourceIndex;0===c&&(f=!0);return c}:document.createRange&&(n=function(a,b){if(!a.ownerDocument||!b.ownerDocument)return a==b&&(f=!0),0;var c=a.ownerDocument.createRange(),d=b.ownerDocument.createRange();
c.setStart(a,0);c.setEnd(a,0);d.setStart(b,0);d.setEnd(b,0);c=c.compareBoundaryPoints(Range.START_TO_END,d);0===c&&(f=!0);return c});h=document.createElement("div");var p="script"+(new Date).getTime();h.innerHTML="<a name='"+p+"'/>";var u=document.documentElement;u.insertBefore(h,u.firstChild);document.getElementById(p)&&(j.find.ID=function(a,b,c){if("undefined"!==typeof b.getElementById&&!c)return(b=b.getElementById(a[1]))?b.id===a[1]||"undefined"!==typeof b.getAttributeNode&&b.getAttributeNode("id").nodeValue===
a[1]?[b]:void 0:[]},j.filter.ID=function(a,b){var c="undefined"!==typeof a.getAttributeNode&&a.getAttributeNode("id");return 1===a.nodeType&&c&&c.nodeValue===b});u.removeChild(h);u=h=null;h=document.createElement("div");h.appendChild(document.createComment(""));0<h.getElementsByTagName("*").length&&(j.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if("*"===a[1]){for(var d=[],e=0;c[e];e++)1===c[e].nodeType&&d.push(c[e]);c=d}return c});h.innerHTML="<a href='#'></a>";h.firstChild&&("undefined"!==
typeof h.firstChild.getAttribute&&"#"!==h.firstChild.getAttribute("href"))&&(j.attrHandle.href=function(a){return a.getAttribute("href",2)});h=null;if(document.querySelectorAll){var r=i;h=document.createElement("div");h.innerHTML="<p class='TEST'></p>";if(!(h.querySelectorAll&&0===h.querySelectorAll(".TEST").length)){var i=function(a,b,c,d){b=b||document;if(!d&&9===b.nodeType&&!v(b))try{return q(b.querySelectorAll(a),c)}catch(e){}return r(a,b,c,d)},m;for(m in r)i[m]=r[m];h=null}}document.getElementsByClassName&&
document.documentElement.getElementsByClassName&&(m=document.createElement("div"),m.innerHTML="<div class='test e'></div><div class='test'></div>",0!==m.getElementsByClassName("e").length&&(m.lastChild.className="e",1!==m.getElementsByClassName("e").length&&(j.order.splice(1,0,"CLASS"),j.find.CLASS=function(a,b,c){if("undefined"!==typeof b.getElementsByClassName&&!c)return b.getElementsByClassName(a[1])},m=null)));var y=document.compareDocumentPosition?function(a,b){return a.compareDocumentPosition(b)&
16}:function(a,b){return a!==b&&(a.contains?a.contains(b):!0)},v=function(a){return 9===a.nodeType&&"HTML"!==a.documentElement.nodeName||!!a.ownerDocument&&"HTML"!==a.ownerDocument.documentElement.nodeName},x=function(a,b){for(var c=[],d="",e,f=b.nodeType?[b]:b;e=j.match.PSEUDO.exec(a);)d+=e[0],a=a.replace(j.match.PSEUDO,"");a=j.relative[a]?a+"*":a;e=0;for(var g=f.length;e<g;e++)i(a,f[e],c);return i.filter(d,c)};window.Sizzle=i})();Prototype._original_property=window.Sizzle;
(function(a){var b=Prototype.Selector.extendElements;Prototype.Selector.engine=a;Prototype.Selector.select=function(c,d){return b(a(c,d||document))};Prototype.Selector.match=function(b,d){return 1==a.matches(d,[b]).length}})(Sizzle);window.Sizzle=Prototype._original_property;delete Prototype._original_property;
var Form={reset:function(a){a=$(a);a.reset();return a},serializeElements:function(a,b){"object"!=typeof b?b={hash:!!b}:Object.isUndefined(b.hash)&&(b.hash=!0);var c,d,g=!1,f=b.submit,e,i;b.hash?(i={},e=function(a,b,c){b in a?(Object.isArray(a[b])||(a[b]=[a[b]]),a[b].push(c)):a[b]=c;return a}):(i="",e=function(a,b,c){return a+(a?"&":"")+encodeURIComponent(b)+"="+encodeURIComponent(c)});return a.inject(i,function(a,b){if(!b.disabled&&b.name&&(c=b.name,d=$(b).getValue(),null!=d&&"file"!=b.type&&("submit"!=
b.type||!g&&!1!==f&&(!f||c==f)&&(g=!0))))a=e(a,c,d);return a})},Methods:{serialize:function(a,b){return Form.serializeElements(Form.getElements(a),b)},getElements:function(a){for(var a=$(a).getElementsByTagName("*"),b,c=[],d=Form.Element.Serializers,g=0;b=a[g];g++)c.push(b);return c.inject([],function(a,b){d[b.tagName.toLowerCase()]&&a.push(Element.extend(b));return a})},getInputs:function(a,b,c){a=$(a);a=a.getElementsByTagName("input");if(!b&&!c)return $A(a).map(Element.extend);for(var d=0,g=[],
f=a.length;d<f;d++){var e=a[d];b&&e.type!=b||c&&e.name!=c||g.push(Element.extend(e))}return g},disable:function(a){a=$(a);Form.getElements(a).invoke("disable");return a},enable:function(a){a=$(a);Form.getElements(a).invoke("enable");return a},findFirstElement:function(a){var a=$(a).getElements().findAll(function(a){return"hidden"!=a.type&&!a.disabled}),b=a.findAll(function(a){return a.hasAttribute("tabIndex")&&0<=a.tabIndex}).sortBy(function(a){return a.tabIndex}).first();return b?b:a.find(function(a){return/^(?:input|select|textarea)$/i.test(a.tagName)})},
focusFirstElement:function(a){var a=$(a),b=a.findFirstElement();b&&b.activate();return a},request:function(a,b){var a=$(a),b=Object.clone(b||{}),c=b.parameters,d=a.readAttribute("action")||"";d.blank()&&(d=window.location.href);b.parameters=a.serialize(!0);c&&(Object.isString(c)&&(c=c.toQueryParams()),Object.extend(b.parameters,c));a.hasAttribute("method")&&!b.method&&(b.method=a.method);return new Ajax.Request(d,b)}},Element:{focus:function(a){$(a).focus();return a},select:function(a){$(a).select();
return a}}};
Form.Element.Methods={serialize:function(a){a=$(a);if(!a.disabled&&a.name){var b=a.getValue();if(void 0!=b){var c={};c[a.name]=b;return Object.toQueryString(c)}}return""},getValue:function(a){var a=$(a),b=a.tagName.toLowerCase();return Form.Element.Serializers[b](a)},setValue:function(a,b){var a=$(a),c=a.tagName.toLowerCase();Form.Element.Serializers[c](a,b);return a},clear:function(a){$(a).value="";return a},present:function(a){return""!=$(a).value},activate:function(a){a=$(a);try{a.focus(),a.select&&
("input"!=a.tagName.toLowerCase()||!/^(?:button|reset|submit)$/i.test(a.type))&&a.select()}catch(b){}return a},disable:function(a){a=$(a);a.disabled=!0;return a},enable:function(a){a=$(a);a.disabled=!1;return a}};var Field=Form.Element,$F=Form.Element.Methods.getValue;
Form.Element.Serializers=function(){function a(a,b){if(Object.isUndefined(b))return a.checked?a.value:null;a.checked=!!b}function b(a,b){if(Object.isUndefined(b))return a.value;a.value=b}function c(a){var b=a.selectedIndex;return 0<=b?g(a.options[b]):null}function d(a){var b,c=a.length;if(!c)return null;var d=0;for(b=[];d<c;d++){var k=a.options[d];k.selected&&b.push(g(k))}return b}function g(a){return Element.hasAttribute(a,"value")?a.value:a.text}return{input:function(c,d){switch(c.type.toLowerCase()){case "checkbox":case "radio":return a(c,
d);default:return b(c,d)}},inputSelector:a,textarea:b,select:function(a,b){if(Object.isUndefined(b))return("select-one"===a.type?c:d)(a);for(var g,j,k=!Object.isArray(b),h=0,q=a.length;h<q;h++)if(g=a.options[h],j=this.optionValue(g),k){if(j==b){g.selected=!0;break}}else g.selected=b.include(j)},selectOne:c,selectMany:d,optionValue:g,button:b}}();
Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,b,c,d){$super(d,c);this.element=$(b);this.lastValue=this.getValue()},execute:function(){var a=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(a)?this.lastValue!=a:String(this.lastValue)!=String(a))this.callback(this.element,a),this.lastValue=a}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});
Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});
Abstract.EventObserver=Class.create({initialize:function(a,b){this.element=$(a);this.callback=b;this.lastValue=this.getValue();"form"==this.element.tagName.toLowerCase()?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var a=this.getValue();this.lastValue!=a&&(this.callback(this.element,a),this.lastValue=a)},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(a){if(a.type)switch(a.type.toLowerCase()){case "checkbox":case "radio":Event.observe(a,
"click",this.onElementEvent.bind(this));break;default:Event.observe(a,"change",this.onElementEvent.bind(this))}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});
(function(){function a(a,b){return a.which?a.which===b+1:a.button===b}function b(a,b){return a.button===u[b]}function c(a,b){switch(b){case 0:return 1==a.which&&!a.metaKey;case 1:return 2==a.which||1==a.which&&a.metaKey;case 2:return 3==a.which;default:return!1}}function d(a){var b=document.documentElement,c=document.body||{scrollLeft:0};return isEventSupported("touchstart")&&a.touches?a.touches[0]?a.touches[0].pageX:a.pageX:a.pageX||a.clientX+(b.scrollLeft||c.scrollLeft)-(b.clientLeft||0)}function g(a){var b=
document.documentElement,c=document.body||{scrollTop:0};return isEventSupported("touchstart")&&a.touches?a.touches[0]?a.touches[0].pageY:a.pageY:a.pageY||a.clientY+(b.scrollTop||c.scrollTop)-(b.clientTop||0)}function f(){for(var a=0,b=v.length;a<b;a++)h.stopObserving(v[a]),v[a]=null}function e(a,b,c){var a=$(a),d;var e=a;d=Element.retrieve(e,"prototype_event_registry");Object.isUndefined(d)&&(v.push(e),d=Element.retrieve(e,"prototype_event_registry",$H()));var f=d.get(b);Object.isUndefined(f)&&(f=
[],d.set(b,f));if(f.pluck("handler").include(c))d=!1;else{var g;if(b.include(":"))g=function(a){if(Object.isUndefined(a.eventName)||a.eventName!==b)return!1;h.extend(a,e);c.call(e,a)};else if(!z&&("mouseenter"===b||"mouseleave"===b)){if("mouseenter"===b||"mouseleave"===b)g=function(a){h.extend(a,e);for(var b=a.relatedTarget;b&&b!==e;)try{b=b.parentNode}catch(d){b=e}b!==e&&c.call(e,a)}}else g=function(a){h.extend(a,e);c.call(e,a)};g.handler=c;f.push(g);d=g}if(!d)return a;b.include(":")?a.addEventListener?
a.addEventListener("dataavailable",d,!1):(a.attachEvent("ondataavailable",d),a.attachEvent("onlosecapture",d)):(f=x(b),a.addEventListener?a.addEventListener(f,d,!1):a.attachEvent("on"+f,d));return a}function i(a,b,c){var a=$(a),d=Element.retrieve(a,"prototype_event_registry");if(!d)return a;if(!b)return d.each(function(b){i(a,b.key)}),a;var e=d.get(b);if(!e)return a;if(!c)return e.each(function(c){i(a,b,c.handler)}),a;for(var f=e.length,g;f--;)if(e[f].handler===c){g=e[f];break}if(!g)return a;b.include(":")?
a.removeEventListener?a.removeEventListener("dataavailable",g,!1):(a.detachEvent("ondataavailable",g),a.detachEvent("onlosecapture",g)):(c=x(b),a.removeEventListener?a.removeEventListener(c,g,!1):a.detachEvent("on"+c,g));d.set(b,e.without(g));return a}function j(a,b,c,d){a=$(a);Object.isUndefined(d)&&(d=!0);a==document&&(document.createEvent&&!a.dispatchEvent)&&(a=document.documentElement);var e;document.createEvent?(e=document.createEvent("HTMLEvents"),e.initEvent("dataavailable",d,!0)):(e=document.createEventObject(),
e.eventType=d?"ondataavailable":"onlosecapture");e.eventName=b;e.memo=c||{};document.createEvent?a.dispatchEvent(e):a.fireEvent(e.eventType,e);return h.extend(e)}function k(a,b,c,d){a=$(a);Object.isFunction(c)&&Object.isUndefined(d)&&(d=c,c=null);return(new h.Handler(a,b,c,d)).start()}var h={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}},q=document.documentElement,
z="onmouseenter"in q&&"onmouseleave"in q,n=function(){return!1};window.attachEvent&&(n=window.addEventListener?function(a){return!(a instanceof window.Event)}:function(){return!0});var p,u={"0":1,1:4,2:2};p=window.attachEvent?window.addEventListener?function(c,d){return n(c)?b(c,d):a(c,d)}:b:Prototype.Browser.WebKit?c:a;h.Methods={isLeftClick:function(a){return p(a,0)},isMiddleClick:function(a){return p(a,1)},isRightClick:function(a){return p(a,2)},element:function(a){var a=h.extend(a),b=a.target,
c=a.type;if((a=a.currentTarget)&&a.tagName&&("load"===c||"error"===c||"click"===c&&"input"===a.tagName.toLowerCase()&&"radio"===a.type))b=a;b.nodeType==Node.TEXT_NODE&&(b=b.parentNode);return Element.extend(b)},findElement:function(a,b){var c=h.element(a);if(!b)return c;for(;c;){if(Object.isElement(c)&&Prototype.Selector.match(c,b))return Element.extend(c);c=c.parentNode}},pointer:function(a){return{x:d(a),y:g(a)}},pointerX:d,pointerY:g,stop:function(a){h.extend(a);a.preventDefault();a.stopPropagation();
a.stopped=!0}};var r=Object.keys(h.Methods).inject({},function(a,b){a[b]=h.Methods[b].methodize();return a});if(window.attachEvent){var m=function(a){switch(a.type){case "mouseover":case "mouseenter":a=a.fromElement;break;case "mouseout":case "mouseleave":a=a.toElement;break;default:return null}return Element.extend(a)},y={stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.returnValue=!1},inspect:function(){return"[object Event]"}};h.extend=function(a,b){if(!a)return!1;
if(!n(a)||a._extendedByPrototype)return a;a._extendedByPrototype=Prototype.emptyFunction;var c=h.pointer(a);Object.extend(a,{target:a.srcElement||b,relatedTarget:m(a),pageX:c.x,pageY:c.y});Object.extend(a,r);Object.extend(a,y);return a}}else h.extend=Prototype.K;window.addEventListener&&(h.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__,Object.extend(h.prototype,r));var v=[];Prototype.Browser.IE&&window.attachEvent("onunload",f);Prototype.Browser.WebKit&&window.addEventListener("unload",
Prototype.emptyFunction,!1);var x=Prototype.K,B={mouseenter:"mouseover",mouseleave:"mouseout"};z||(x=function(a){return B[a]||a});h.Handler=Class.create({initialize:function(a,b,c,d){this.element=$(a);this.eventName=b;this.selector=c;this.callback=d;this.handler=this.handleEvent.bind(this)},start:function(){h.observe(this.element,this.eventName,this.handler);return this},stop:function(){h.stopObserving(this.element,this.eventName,this.handler);return this},handleEvent:function(a){var b=h.findElement(a,
this.selector);b&&this.callback.call(this.element,a,b)}});Object.extend(h,h.Methods);Object.extend(h,{fire:j,observe:e,stopObserving:i,on:k});Element.addMethods({fire:j,observe:e,stopObserving:i,on:k});Object.extend(document,{fire:j.methodize(),observe:e.methodize(),stopObserving:i.methodize(),on:k.methodize(),loaded:!1});window.Event?Object.extend(window.Event,h):window.Event=h})();
(function(){function a(){document.loaded||(d&&window.clearTimeout(d),document.loaded=!0,document.fire("dom:loaded"))}function b(){"complete"===document.readyState&&(document.stopObserving("readystatechange",b),a())}function c(){try{document.documentElement.doScroll("left")}catch(b){d=c.defer();return}a()}var d;document.addEventListener?document.addEventListener("DOMContentLoaded",a,!1):(document.observe("readystatechange",b),window==top&&(d=c.defer()));Event.observe(window,"load",a)})();Element.addMethods();
Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;
var Insertion={Before:function(a,b){return Element.insert(a,{before:b})},Top:function(a,b){return Element.insert(a,{top:b})},Bottom:function(a,b){return Element.insert(a,{bottom:b})},After:function(a,b){return Element.insert(a,{after:b})}},$continue=Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:!1,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||
document.body.scrollTop||0},within:function(a,b,c){if(this.includeScrollOffsets)return this.withinIncludingScrolloffsets(a,b,c);this.xcomp=b;this.ycomp=c;this.offset=Element.cumulativeOffset(a);return c>=this.offset[1]&&c<this.offset[1]+a.offsetHeight&&b>=this.offset[0]&&b<this.offset[0]+a.offsetWidth},withinIncludingScrolloffsets:function(a,b,c){var d=Element.cumulativeScrollOffset(a);this.xcomp=b+d[0]-this.deltaX;this.ycomp=c+d[1]-this.deltaY;this.offset=Element.cumulativeOffset(a);return this.ycomp>=
this.offset[1]&&this.ycomp<this.offset[1]+a.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+a.offsetWidth},overlap:function(a,b){if(!a)return 0;if("vertical"==a)return(this.offset[1]+b.offsetHeight-this.ycomp)/b.offsetHeight;if("horizontal"==a)return(this.offset[0]+b.offsetWidth-this.xcomp)/b.offsetWidth},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(a){Position.prepare();return Element.absolutize(a)},relativize:function(a){Position.prepare();
return Element.relativize(a)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(a,b,c){c=c||{};return Element.clonePosition(b,a,c)}};
document.getElementsByClassName||(document.getElementsByClassName=function(a){function b(a){return a.blank()?null:"[contains(concat(' ', @class, ' '), ' "+a+" ')]"}a.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(a,d){var d=d.toString().strip(),g=/\s/.test(d)?$w(d).map(b).join(""):b(d);return g?document._getElementsByXPath(".//*"+g,a):[]}:function(a,b){var b=b.toString().strip(),g=[],f=/\s/.test(b)?$w(b):null;if(!f&&!b)return g;for(var e=$(a).getElementsByTagName("*"),b=" "+b+" ",
i=0,j,k;j=e[i];i++)j.className&&((k=" "+j.className+" ")&&(k.include(b)||f&&f.all(function(a){return!a.toString().blank()&&k.include(" "+a+" ")})))&&g.push(Element.extend(j));return g};return function(a,b){return $(b||document.body).getElementsByClassName(a)}}(Element.Methods));Element.ClassNames=Class.create();
Element.ClassNames.prototype={initialize:function(a){this.element=$(a)},_each:function(a){this.element.className.split(/\s+/).select(function(a){return 0<a.length})._each(a)},set:function(a){this.element.className=a},add:function(a){this.include(a)||this.set($A(this).concat(a).join(" "))},remove:function(a){this.include(a)&&this.set($A(this).without(a).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);
(function(){window.Selector=Class.create({initialize:function(a){this.expression=a.strip()},findElements:function(a){return Prototype.Selector.select(this.expression,a)},match:function(a){return Prototype.Selector.match(a,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}});Object.extend(Selector,{matchElements:function(a,b){for(var c=Prototype.Selector.match,d=[],g=0,f=a.length;g<f;g++){var e=a[g];c(e,b)&&d.push(Element.extend(e))}return d},
findElement:function(a,b,c){for(var c=c||0,d=0,g,f=0,e=a.length;f<e;f++)if(g=a[f],Prototype.Selector.match(g,b)&&c===d++)return Element.extend(g)},findChildElements:function(a,b){var c=b.toArray().join(", ");return Prototype.Selector.select(c,a||document)}})})();
String.prototype.parseColor=function(a){var b="#";if("rgb("==this.slice(0,4)){var c=this.slice(4,this.length-1).split(","),d=0;do b+=parseInt(c[d]).toColorPart();while(3>++d)}else if("#"==this.slice(0,1)){if(4==this.length)for(d=1;4>d;d++)b+=(this.charAt(d)+this.charAt(d)).toLowerCase();7==this.length&&(b=this.toLowerCase())}return 7==b.length?b:a||this};
Element.collectTextNodes=function(a){return $A($(a).childNodes).collect(function(a){return 3==a.nodeType?a.nodeValue:a.hasChildNodes()?Element.collectTextNodes(a):""}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(a,b){return $A($(a).childNodes).collect(function(a){return 3==a.nodeType?a.nodeValue:a.hasChildNodes()&&!Element.hasClassName(a,b)?Element.collectTextNodesIgnoreClass(a,b):""}).flatten().join("")};
Element.setContentZoom=function(a,b){a=$(a);a.setStyle({fontSize:b/100+"em"});Prototype.Browser.WebKit&&window.scrollBy(0,0);return a};Element.getInlineOpacity=function(a){return $(a).style.opacity||""};Element.forceRerendering=function(a){try{var a=$(a),b=document.createTextNode(" ");a.appendChild(b);a.removeChild(b)}catch(c){}};
var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(a){return-Math.cos(a*Math.PI)/2+0.5},reverse:function(a){return 1-a},flicker:function(a){a=-Math.cos(a*Math.PI)/4+0.75+Math.random()/4;return 1<a?1:a},wobble:function(a){return-Math.cos(a*Math.PI*9*a)/2+0.5},pulse:function(a,b){return-Math.cos(2*(a*((b||5)-0.5))*Math.PI)/2+0.5},spring:function(a){return 1-
Math.cos(4.5*a*Math.PI)*Math.exp(6*-a)},none:function(){return 0},full:function(){return 1}},DefaultOptions:{duration:1,fps:100,sync:!1,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(a){var b="position:relative";Prototype.Browser.IE&&(b+=";zoom:1");a=$(a);$A(a.childNodes).each(function(c){3==c.nodeType&&(c.nodeValue.toArray().each(function(d){a.insertBefore((new Element("span",{style:b})).update(" "==d?String.fromCharCode(160):d),c)}),Element.remove(c))})},multiple:function(a,b,c){var a=
("object"==typeof a||Object.isFunction(a))&&a.length?a:$(a).childNodes,d=Object.extend({speed:0.1,delay:0},c||{}),e=d.delay;$A(a).each(function(a,c){new b(a,Object.extend(d,{delay:c*d.speed+e}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(a,b,c){a=$(a);b=(b||"appear").toLowerCase();return Effect[Effect.PAIRS[b][a.visible()?1:0]](a,Object.extend({queue:{position:"end",scope:a.id||"global",limit:1}},c||{}))}};
Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;
Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(a){this.effects._each(a)},add:function(a){var b=(new Date).getTime();switch(Object.isString(a.options.queue)?a.options.queue:a.options.queue.position){case "front":this.effects.findAll(function(a){return"idle"==a.state}).each(function(b){b.startOn+=a.finishOn;b.finishOn+=a.finishOn});break;case "with-last":b=this.effects.pluck("startOn").max()||b;break;case "end":b=this.effects.pluck("finishOn").max()||
b}a.startOn+=b;a.finishOn+=b;(!a.options.queue.limit||this.effects.length<a.options.queue.limit)&&this.effects.push(a);this.interval||(this.interval=setInterval(this.loop.bind(this),15))},remove:function(a){this.effects=this.effects.reject(function(b){return b==a});0==this.effects.length&&(clearInterval(this.interval),this.interval=null)},loop:function(){for(var a=(new Date).getTime(),b=0,c=this.effects.length;b<c;b++)this.effects[b]&&this.effects[b].loop(a)}});
Effect.Queues={instances:$H(),get:function(a){return!Object.isString(a)?a:this.instances.get(a)||this.instances.set(a,new Effect.ScopedQueue)}};Effect.Queue=Effect.Queues.get("global");
Effect.Base=Class.create({position:null,start:function(a){a&&!1===a.transition&&(a.transition=Effect.Transitions.linear);this.options=Object.extend(Object.extend({},Effect.DefaultOptions),a||{});this.currentFrame=0;this.state="idle";this.startOn=1E3*this.options.delay;this.finishOn=this.startOn+1E3*this.options.duration;this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;var b=function(a,b){if(a.options[b+
"Internal"])a.options[b+"Internal"](a);if(a.options[b])a.options[b](a)};this.render=function(a){"idle"===this.state&&(this.state="running",b(this,"beforeSetup"),this.setup&&this.setup(),b(this,"afterSetup"));"running"===this.state&&(this.position=a=this.options.transition(a)*this.fromToDelta+this.options.from,b(this,"beforeUpdate"),this.update&&this.update(a),b(this,"afterUpdate"))};this.event("beforeStart");this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)},
loop:function(a){if(a>=this.startOn)if(a>=this.finishOn)this.render(1),this.cancel(),this.event("beforeFinish"),this.finish&&this.finish(),this.event("afterFinish");else{var a=(a-this.startOn)/this.totalTime,b=(a*this.totalFrames).round();b>this.currentFrame&&(this.render(a),this.currentFrame=b)}},cancel:function(){this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this);this.state="finished"},event:function(a){if(this.options[a+"Internal"])this.options[a+
"Internal"](this);if(this.options[a])this.options[a](this)},inspect:function(){var a=$H();for(property in this)Object.isFunction(this[property])||a.set(property,this[property]);return"#<Effect:"+a.inspect()+",options:"+$H(this.options).inspect()+">"}});
Effect.Parallel=Class.create(Effect.Base,{initialize:function(a,b){this.effects=a||[];this.start(b)},update:function(a){this.effects.invoke("render",a)},finish:function(a){this.effects.each(function(b){b.render(1);b.cancel();b.event("beforeFinish");b.finish&&b.finish(a);b.event("afterFinish")})}});
Effect.Tween=Class.create(Effect.Base,{initialize:function(a,b,c){var a=Object.isString(a)?$(a):a,d=$A(arguments),e=d.last(),d=5==d.length?d[3]:null;this.method=Object.isFunction(e)?e.bind(a):Object.isFunction(a[e])?a[e].bind(a):function(b){a[e]=b};this.start(Object.extend({from:b,to:c},d||{}))},update:function(a){this.method(a)}});Effect.Event=Class.create(Effect.Base,{initialize:function(a){this.start(Object.extend({duration:0},a||{}))},update:Prototype.emptyFunction});
Effect.Opacity=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});var c=Object.extend({from:this.element.getOpacity()||0,to:1},b||{});this.start(c)},update:function(a){this.element.setOpacity(a)}});
Effect.Move=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;var c=Object.extend({x:0,y:0,mode:"relative"},b||{});this.start(c)},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");"absolute"==this.options.mode&&(this.options.x-=this.originalLeft,this.options.y-=this.originalTop)},update:function(a){this.element.setStyle({left:(this.options.x*
a+this.originalLeft).round()+"px",top:(this.options.y*a+this.originalTop).round()+"px"})}});Effect.MoveBy=function(a,b,c,d){return new Effect.Move(a,Object.extend({x:c,y:b},d||{}))};
Effect.Scale=Class.create(Effect.Base,{initialize:function(a,b,c){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;a=Object.extend({scaleX:!0,scaleY:!0,scaleContent:!0,scaleFromCenter:!1,scaleMode:"box",scaleFrom:100,scaleTo:b},c||{});this.start(a)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||!1;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(a){this.originalStyle[a]=
this.element.style[a]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var a=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(b){0<a.indexOf(b)&&(this.fontSize=parseFloat(a),this.fontSizeType=b)}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;"box"==this.options.scaleMode&&(this.dims=[this.element.offsetHeight,this.element.offsetWidth]);/^content/.test(this.options.scaleMode)&&(this.dims=
[this.element.scrollHeight,this.element.scrollWidth]);this.dims||(this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth])},update:function(a){a=this.options.scaleFrom/100+this.factor*a;this.options.scaleContent&&this.fontSize&&this.element.setStyle({fontSize:this.fontSize*a+this.fontSizeType});this.setDimensions(this.dims[0]*a,this.dims[1]*a)},finish:function(){this.restoreAfterFinish&&this.element.setStyle(this.originalStyle)},setDimensions:function(a,b){var c={};
this.options.scaleX&&(c.width=b.round()+"px");this.options.scaleY&&(c.height=a.round()+"px");if(this.options.scaleFromCenter){var d=(a-this.dims[0])/2,e=(b-this.dims[1])/2;"absolute"==this.elementPositioning?(this.options.scaleY&&(c.top=this.originalTop-d+"px"),this.options.scaleX&&(c.left=this.originalLeft-e+"px")):(this.options.scaleY&&(c.top=-d+"px"),this.options.scaleX&&(c.left=-e+"px"))}this.element.setStyle(c)}});
Effect.Highlight=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;var c=Object.extend({startcolor:"#ffff99"},b||{});this.start(c)},setup:function(){"none"==this.element.getStyle("display")?this.cancel():(this.oldStyle={},this.options.keepBackgroundImage||(this.oldStyle.backgroundImage=this.element.getStyle("background-image"),this.element.setStyle({backgroundImage:"none"})),this.options.endcolor||(this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff")),
this.options.restorecolor||(this.options.restorecolor=this.element.getStyle("background-color")),this._base=$R(0,2).map(function(a){return parseInt(this.options.startcolor.slice(2*a+1,2*a+3),16)}.bind(this)),this._delta=$R(0,2).map(function(a){return parseInt(this.options.endcolor.slice(2*a+1,2*a+3),16)-this._base[a]}.bind(this)))},update:function(a){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(b,c,d){return b+(this._base[d]+this._delta[d]*a).round().toColorPart()}.bind(this))})},
finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});Effect.ScrollTo=function(a,b){var c=b||{},d=document.viewport.getScrollOffsets(),e=$(a).cumulativeOffset();c.offset&&(e[1]+=c.offset);return new Effect.Tween(null,d.top,e[1],c,function(a){scrollTo(d.left,a.round())})};
Effect.Fade=function(a,b){var a=$(a),c=a.getInlineOpacity(),d=Object.extend({from:a.getOpacity()||1,to:0,afterFinishInternal:function(a){0==a.options.to&&a.element.hide().setStyle({opacity:c})}},b||{});return new Effect.Opacity(a,d)};
Effect.Appear=function(a,b){var a=$(a),c=Object.extend({from:"none"==a.getStyle("display")?0:a.getOpacity()||0,to:1,afterFinishInternal:function(a){a.element.forceRerendering()},beforeSetup:function(a){a.element.setOpacity(a.options.from).show()}},b||{});return new Effect.Opacity(a,c)};
Effect.Puff=function(a,b){var a=$(a),c={opacity:a.getInlineOpacity(),position:a.getStyle("position"),top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height};return new Effect.Parallel([new Effect.Scale(a,200,{sync:!0,scaleFromCenter:!0,scaleContent:!0,restoreAfterFinish:!0}),new Effect.Opacity(a,{sync:!0,to:0})],Object.extend({duration:1,beforeSetupInternal:function(a){Position.absolutize(a.effects[0].element)},afterFinishInternal:function(a){a.effects[0].element.hide().setStyle(c)}},
b||{}))};Effect.BlindUp=function(a,b){a=$(a);a.makeClipping();return new Effect.Scale(a,0,Object.extend({scaleContent:!1,scaleX:!1,restoreAfterFinish:!0,afterFinishInternal:function(a){a.element.hide().undoClipping()}},b||{}))};
Effect.BlindDown=function(a,b){var a=$(a),c=a.getDimensions();return new Effect.Scale(a,100,Object.extend({scaleContent:!1,scaleX:!1,scaleFrom:0,scaleMode:{originalHeight:c.height,originalWidth:c.width},restoreAfterFinish:!0,afterSetup:function(a){a.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(a){a.element.undoClipping()}},b||{}))};
Effect.SwitchOff=function(a,b){var a=$(a),c=a.getInlineOpacity();return new Effect.Appear(a,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(a){new Effect.Scale(a.element,1,{duration:0.3,scaleFromCenter:!0,scaleX:!1,scaleContent:!1,restoreAfterFinish:!0,beforeSetup:function(a){a.element.makePositioned().makeClipping()},afterFinishInternal:function(a){a.element.hide().undoClipping().undoPositioned().setStyle({opacity:c})}})}},b||{}))};
Effect.DropOut=function(a,b){var a=$(a),c={top:a.getStyle("top"),left:a.getStyle("left"),opacity:a.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(a,{x:0,y:100,sync:!0}),new Effect.Opacity(a,{sync:!0,to:0})],Object.extend({duration:0.5,beforeSetup:function(a){a.effects[0].element.makePositioned()},afterFinishInternal:function(a){a.effects[0].element.hide().undoPositioned().setStyle(c)}},b||{}))};
Effect.Shake=function(a,b){var a=$(a),c=Object.extend({distance:20,duration:0.5},b||{}),d=parseFloat(c.distance),e=parseFloat(c.duration)/10,f={top:a.getStyle("top"),left:a.getStyle("left")};return new Effect.Move(a,{x:d,y:0,duration:e,afterFinishInternal:function(a){new Effect.Move(a.element,{x:2*-d,y:0,duration:2*e,afterFinishInternal:function(a){new Effect.Move(a.element,{x:2*d,y:0,duration:2*e,afterFinishInternal:function(a){new Effect.Move(a.element,{x:2*-d,y:0,duration:2*e,afterFinishInternal:function(a){new Effect.Move(a.element,
{x:2*d,y:0,duration:2*e,afterFinishInternal:function(a){new Effect.Move(a.element,{x:-d,y:0,duration:e,afterFinishInternal:function(a){a.element.undoPositioned().setStyle(f)}})}})}})}})}})}})};
Effect.SlideDown=function(a,b){var a=$(a).cleanWhitespace(),c=a.down().getStyle("bottom"),d=a.getDimensions();return new Effect.Scale(a,100,Object.extend({scaleContent:!1,scaleX:!1,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:d.height,originalWidth:d.width},restoreAfterFinish:!0,afterSetup:function(a){a.element.makePositioned();a.element.down().makePositioned();window.opera&&a.element.setStyle({top:""});a.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(a){a.element.down().setStyle({bottom:a.dims[0]-
a.element.clientHeight+"px"})},afterFinishInternal:function(a){a.element.undoClipping().undoPositioned();a.element.down().undoPositioned().setStyle({bottom:c})}},b||{}))};
Effect.SlideUp=function(a,b){var a=$(a).cleanWhitespace(),c=a.down().getStyle("bottom"),d=a.getDimensions();return new Effect.Scale(a,window.opera?0:1,Object.extend({scaleContent:!1,scaleX:!1,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:d.height,originalWidth:d.width},restoreAfterFinish:!0,afterSetup:function(a){a.element.makePositioned();a.element.down().makePositioned();window.opera&&a.element.setStyle({top:""});a.element.makeClipping().show()},afterUpdateInternal:function(a){a.element.down().setStyle({bottom:a.dims[0]-
a.element.clientHeight+"px"})},afterFinishInternal:function(a){a.element.hide().undoClipping().undoPositioned();a.element.down().undoPositioned().setStyle({bottom:c})}},b||{}))};Effect.Squish=function(a){return new Effect.Scale(a,window.opera?1:0,{restoreAfterFinish:!0,beforeSetup:function(a){a.element.makeClipping()},afterFinishInternal:function(a){a.element.hide().undoClipping()}})};
Effect.Grow=function(a,b){var a=$(a),c=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},b||{}),d={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:a.getInlineOpacity()},e=a.getDimensions(),f,g,h,i;switch(c.direction){case "top-left":f=g=h=i=0;break;case "top-right":f=e.width;g=i=0;h=-e.width;break;case "bottom-left":f=h=0;g=e.height;i=-e.height;break;
case "bottom-right":f=e.width;g=e.height;h=-e.width;i=-e.height;break;case "center":f=e.width/2,g=e.height/2,h=-e.width/2,i=-e.height/2}return new Effect.Move(a,{x:f,y:g,duration:0.01,beforeSetup:function(a){a.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(a){new Effect.Parallel([new Effect.Opacity(a.element,{sync:!0,to:1,from:0,transition:c.opacityTransition}),new Effect.Move(a.element,{x:h,y:i,sync:!0,transition:c.moveTransition}),new Effect.Scale(a.element,100,{scaleMode:{originalHeight:e.height,
originalWidth:e.width},sync:!0,scaleFrom:window.opera?1:0,transition:c.scaleTransition,restoreAfterFinish:!0})],Object.extend({beforeSetup:function(a){a.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(a){a.effects[0].element.undoClipping().undoPositioned().setStyle(d)}},c))}})};
Effect.Shrink=function(a,b){var a=$(a),c=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},b||{}),d={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:a.getInlineOpacity()},e=a.getDimensions(),f,g;switch(c.direction){case "top-left":f=g=0;break;case "top-right":f=e.width;g=0;break;case "bottom-left":f=0;g=e.height;break;case "bottom-right":f=e.width;g=
e.height;break;case "center":f=e.width/2,g=e.height/2}return new Effect.Parallel([new Effect.Opacity(a,{sync:!0,to:0,from:1,transition:c.opacityTransition}),new Effect.Scale(a,window.opera?1:0,{sync:!0,transition:c.scaleTransition,restoreAfterFinish:!0}),new Effect.Move(a,{x:f,y:g,sync:!0,transition:c.moveTransition})],Object.extend({beforeStartInternal:function(a){a.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(a){a.effects[0].element.hide().undoClipping().undoPositioned().setStyle(d)}},
c))};Effect.Pulsate=function(a,b){var a=$(a),c=b||{},d=a.getInlineOpacity(),e=c.transition||Effect.Transitions.linear;return new Effect.Opacity(a,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(a){a.element.setStyle({opacity:d})}},c),{transition:function(a){return 1-e(-Math.cos(2*(a*(c.pulses||5))*Math.PI)/2+0.5)}}))};
Effect.Fold=function(a,b){var a=$(a),c={top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height};a.makeClipping();return new Effect.Scale(a,5,Object.extend({scaleContent:!1,scaleX:!1,afterFinishInternal:function(){new Effect.Scale(a,1,{scaleContent:!1,scaleY:!1,afterFinishInternal:function(a){a.element.hide().undoClipping().setStyle(c)}})}},b||{}))};
Effect.Morph=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;var c=Object.extend({style:{}},b||{});if(Object.isString(c.style))if(c.style.include(":"))this.style=c.style.parseStyle();else{this.element.addClassName(c.style);this.style=$H(this.element.getStyles());this.element.removeClassName(c.style);var d=this.element.getStyles();this.style=this.style.reject(function(a){return a.value==d[a.key]});c.afterFinishInternal=function(a){a.element.addClassName(a.options.style);
a.transforms.each(function(b){a.element.style[b.style]=""})}}else this.style=$H(c.style);this.start(c)},setup:function(){function a(a){if(!a||["rgba(0, 0, 0, 0)","transparent"].include(a))a="#ffffff";a=a.parseColor();return $R(0,2).map(function(c){return parseInt(a.slice(2*c+1,2*c+3),16)})}this.transforms=this.style.map(function(b){var c=b[0],b=b[1],d=null;"#zzzzzz"!=b.parseColor("#zzzzzz")?(b=b.parseColor(),d="color"):"opacity"==c?(b=parseFloat(b),Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&
this.element.setStyle({zoom:1})):Element.CSS_LENGTH.test(b)&&(d=b.match(/^([\+\-]?[0-9\.]+)(.*)$/),b=parseFloat(d[1]),d=3==d.length?d[2]:null);var e=this.element.getStyle(c);return{style:c.camelize(),originalValue:"color"==d?a(e):parseFloat(e||0),targetValue:"color"==d?a(b):b,unit:d}}.bind(this)).reject(function(a){return a.originalValue==a.targetValue||"color"!=a.unit&&(isNaN(a.originalValue)||isNaN(a.targetValue))})},update:function(a){for(var b={},c,d=this.transforms.length;d--;)b[(c=this.transforms[d]).style]=
"color"==c.unit?"#"+Math.round(c.originalValue[0]+(c.targetValue[0]-c.originalValue[0])*a).toColorPart()+Math.round(c.originalValue[1]+(c.targetValue[1]-c.originalValue[1])*a).toColorPart()+Math.round(c.originalValue[2]+(c.targetValue[2]-c.originalValue[2])*a).toColorPart():(c.originalValue+(c.targetValue-c.originalValue)*a).toFixed(3)+(null===c.unit?"":c.unit);this.element.setStyle(b,!0)}});
Effect.Transform=Class.create({initialize:function(a,b){this.tracks=[];this.options=b||{};this.addTracks(a)},addTracks:function(a){a.each(function(a){var a=$H(a),c=a.values().first();this.tracks.push($H({ids:a.keys().first(),effect:Effect.Morph,options:{style:c}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(a){var b=a.get("ids"),c=a.get("effect"),d=a.get("options");return[$(b)||$$(b)].flatten().map(function(a){return new c(a,Object.extend({sync:!0},
d))})}).flatten(),this.options)}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");
Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");
String.prototype.parseStyle=function(){var a,b=$H();Prototype.Browser.WebKit?a=(new Element("div",{style:this})).style:(String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>',a=String.__parseStyleElement.childNodes[0].style);Element.CSS_PROPERTIES.each(function(c){a[c]&&b.set(c,a[c])});Prototype.Browser.IE&&this.include("opacity")&&b.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);return b};
Element.getStyles=document.defaultView&&document.defaultView.getComputedStyle?function(a){var b=document.defaultView.getComputedStyle($(a),null);return Element.CSS_PROPERTIES.inject({},function(a,d){a[d]=b[d];return a})}:function(a){var a=$(a),b=a.currentStyle,c;c=Element.CSS_PROPERTIES.inject({},function(a,c){a[c]=b[c];return a});c.opacity||(c.opacity=a.getOpacity());return c};
Effect.Methods={morph:function(a,b,c){a=$(a);new Effect.Morph(a,Object.extend({style:b},c||{}));return a},visualEffect:function(a,b,c){a=$(a);b=b.dasherize().camelize();b=b.charAt(0).toUpperCase()+b.substring(1);new Effect[b](a,c);return a},highlight:function(a,b){a=$(a);new Effect.Highlight(a,b);return a}};
$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(a){Effect.Methods[a]=function(b,c){b=$(b);Effect[a.charAt(0).toUpperCase()+a.substring(1)](b,c);return b}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(a){Effect.Methods[a]=Element[a]});Element.addMethods(Effect.Methods);
if(Object.isUndefined(Effect))throw"dragdrop_mm.js requires including script.aculo.us' effects.js library";
var Droppables={drops:[],remove:function(a){this.drops=this.drops.reject(function(c){return c.element==$(a)})},add:function(a,c){var a=$(a),b=Object.extend({greedy:!0,hoverclass:null,tree:!1,isAffected:Droppables.isAffected},c||{});if(b.containment){b._containers=[];var d=b.containment;Object.isArray(d)?d.each(function(a){b._containers.push($(a))}):b._containers.push($(d))}b.accept&&(b.accept=[b.accept].flatten());Element.makePositioned(a);b.element=a;this.drops.push(b)},findDeepestChild:function(a){deepest=
a[0];for(i=1;i<a.length;++i)Element.isParent(a[i].element,deepest.element)&&(deepest=a[i]);return deepest},isContained:function(a,c){var b;b=c.tree?a.treeNode:a.parentNode;return c._containers.detect(function(a){return b==a})},isAffected:function(a,c,b){Position.prepare();return b.element!=c&&(!b._containers||this.isContained(c,b))&&(!b.accept||Element.classNames(c).detect(function(a){return b.accept.include(a)}))&&Position.withinIncludingScrolloffsets(b.element,a[0],a[1])},deactivate:function(a){a.hoverclass&&
Element.removeClassName(a.element,a.hoverclass);this.last_active=null},activate:function(a){a.hoverclass&&Element.addClassName(a.element,a.hoverclass);this.last_active=a},show:function(a,c,b){if(this.drops.length){var d,e=[];if(b){var f=[];(f=b(a,c))&&e.push(this.drops.detect(function(a){return a.element==f}))}else this.drops.each(function(b){if(Droppables.isAffected(a,c,b)&&(e.push(b),b.greedy))throw $break;});0<e.length&&(d=Droppables.findDeepestChild(e));this.last_active&&this.last_active!=d&&
this.deactivate(this.last_active);if(d){Position.withinIncludingScrolloffsets(d.element,a[0],a[1]);if(d.onHover)d.onHover(c,d.element,Position.overlap(d.overlap,d.element));d!=this.last_active&&Droppables.activate(d)}}},fire:function(a,c){if(this.last_active){Position.prepare();var b=Draggables.supportsTouch?Draggables._lastPointer:[Event.pointerX(a),Event.pointerY(a)];if(this.isAffected(b,c,this.last_active)&&this.last_active.onDrop)return this.last_active.onDrop(c,this.last_active.element,a),!0}},
reset:function(){this.last_active&&this.deactivate(this.last_active)}},Draggables={drags:[],observers:[],supportsTouch:!1,register:function(a){0==this.drags.length&&(this.eventMouseUp=this.endDrag.bindAsEventListener(this),this.eventMouseMove=this.updateDrag.bindAsEventListener(this),this.eventKeypress=this.keyPress.bindAsEventListener(this),Draggables.supportsTouch?(Event.observe(document,"touchend",this.eventMouseUp),Event.observe(document,"touchmove",this.eventMouseMove)):(Event.observe(document,
"mouseup",this.eventMouseUp),Event.observe(document,"mousemove",this.eventMouseMove)),Event.observe(document,"keypress",this.eventKeypress));this.drags.push(a)},unregister:function(a){this.drags=this.drags.reject(function(c){return c==a});0==this.drags.length&&(Draggables.supportsTouch?(Event.stopObserving(document,"touchend",this.eventMouseUp),Event.stopObserving(document,"touchmove",this.eventMouseMove)):(Event.stopObserving(document,"mouseup",this.eventMouseUp),Event.stopObserving(document,"mousemove",
this.eventMouseMove)),Event.stopObserving(document,"keypress",this.eventKeypress))},activate:function(a){a.options.delay?this._timeout=setTimeout(function(){Draggables._timeout=null;window.focus();Draggables.activeDraggable=a}.bind(this),a.options.delay):(window.focus(),this.activeDraggable=a);this.initTime=new Date},deactivate:function(){this.activeDraggable=null},updateDrag:function(a){if(this.activeDraggable){var c=[Event.pointerX(a),Event.pointerY(a)];this._lastPointer&&this._lastPointer.inspect()==
c.inspect()||(this._lastPointer=c,50<new Date-this.initTime?this.activeDraggable.updateDrag(a,c):this.activeDraggable.deactivate)}},endDrag:function(a){this._timeout&&(clearTimeout(this._timeout),this._timeout=null);this.activeDraggable&&(this.activeDraggable.endDrag(a),this.activeDraggable=null)},keyPress:function(a){this.activeDraggable&&this.activeDraggable.keyPress(a)},addObserver:function(a){this.observers.push(a);this._cacheObserverCallbacks()},removeObserver:function(a){this.observers=this.observers.reject(function(c){return c.element==
a});this._cacheObserverCallbacks()},notify:function(a,c,b){0<this[a+"Count"]&&this.observers.each(function(d){if(d[a])d[a](a,c,b)});if(c.options[a])c.options[a](c,b)},_cacheObserverCallbacks:function(){["onStart","onEnd","onDrag"].each(function(a){Draggables[a+"Count"]=Draggables.observers.select(function(c){return c[a]}).length})}},Draggable=Class.create({initialize:function(a,c){var b={handle:!1,reverteffect:function(a,b,c){var g=0.02*Math.sqrt(Math.abs(b^2)+Math.abs(c^2));new Effect.Move(a,{x:-c,
y:-b,duration:g,queue:{scope:"_draggable",position:"end"}})},endeffect:function(a){var b=Object.isNumber(a._opacity)?a._opacity:1;new Effect.Opacity(a,{duration:0.2,from:0.7,to:b,queue:{scope:"_draggable",position:"end"},afterFinish:function(){Draggable._dragging[a]=!1}})},zindex:1E3,revert:!1,quiet:!1,scroll:!1,scrollSensitivity:20,scrollSpeed:15,snap:!1,delay:0};(!c||Object.isUndefined(c.endeffect))&&Object.extend(b,{starteffect:function(a){a._opacity=Element.getOpacity(a);Draggable._dragging[a]=
!0;new Effect.Opacity(a,{duration:0.2,from:a._opacity,to:0.7})}});b=Object.extend(b,c||{});this.element=$(a);b.handle&&Object.isString(b.handle)&&(this.handle=this.element.down("."+b.handle,0));this.handle||(this.handle=$(b.handle));this.handle||(this.handle=this.element);b.scroll&&(!b.scroll.scrollTo&&!b.scroll.outerHTML)&&(b.scroll=$(b.scroll),this._isScrollChild=this.element.parentNode?Element.childOf(this.element,b.scroll):!0);Element.makePositioned(this.element);this.options=b;this.dragging=
!1;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Draggables.supportsTouch?Event.observe(this.handle,"touchstart",this.eventMouseDown):Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this)},destroy:function(){Draggables.supportsTouch?Event.stopObserving(this.handle,"touchstart",this.eventMouseDown):Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);Draggables.unregister(this)},currentDelta:function(){return[parseInt(Element.getStyle(this.element,
"left")||"0"),parseInt(Element.getStyle(this.element,"top")||"0")]},initDrag:function(a){if(Object.isUndefined(Draggable._dragging[this.element])||!Draggable._dragging[this.element])if(Event.isLeftClick(a)||a.touches)if(!(tag_name=Event.element(a).tagName.toUpperCase())||!("INPUT"==tag_name||"SELECT"==tag_name||"OPTION"==tag_name||"BUTTON"==tag_name||"TEXTAREA"==tag_name)){var c=[Event.pointerX(a),Event.pointerY(a)],b=this.element.cumulativeOffset();this.offset=[0,1].map(function(a){return c[a]-b[a]});
this.element.offset=this.offset;Draggables.activate(this);Event.stop(a);_Event.callBlurObservers()}},startDrag:function(a){this.dragging=!0;this.delta||(this.delta=this.currentDelta());this.options.zindex&&(this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0),this.element.style.zIndex=this.options.zindex);this.options.ghosting&&(this._clone=this.element.cloneNode(!0),(this._originallyAbsolute="absolute"==this.element.getStyle("position"))||Position.absolutize(this.element),Element.extend(this.element),
this.element.parentNode.insertBefore(this._clone,this.element),this.options.parent&&(this.element._previousPosition={},this.element._previousPosition.parent=this.element.parentNode,this.element._previousPosition.sibling=this.element.next(),this.element.parentNode.removeChild(this.element),$(this.options.parent).insert({top:this.element})),this.element._listener&&(this._clone.style.color="#ccc"));if(this.options.scroll)if(this.options.scroll==window){var c=this._getWindowScroll(this.options.scroll);
this.originalScrollOffsets=[c.left,c.top]}else this.originalScrollOffsets=Element.cumulativeScrollOffset(this.options.scroll);Draggables.notify("onStart",this,a);this.options.starteffect&&this.options.starteffect(this.element)},updateDrag:function(a,c){this.dragging||this.startDrag(a);this.options.quiet||(Position.prepare(),Droppables.show(c,this.element,this.options.customFindAffected));Draggables.notify("onDrag",this,a);this.draw(c);this.options.change&&this.options.change(this);if(this.options.scroll){this.element._listener&&
(c=[a.clientX,a.clientY]);this.stopScrolling();var b,d=Element.cumulativeScrollOffset(this.options.scroll);if(this.options.scroll==window)with(this._getWindowScroll(this.options.scroll))b=[left,top,left+width,top+height];else b=Position.page(this.options.scroll).toArray(),b[0]+=d[0]+Position.deltaX,b[1]+=d[1]+Position.deltaY,b.push(b[0]+this.options.scroll.offsetWidth),b.push(b[1]+this.options.scroll.offsetHeight);var e=[0,0],f=[c[0],c[1]];this.element._listener&&(f[0]+=d[0],f[1]+=d[1]);var g,h;this.element._listener?
(d=sideBar&&sideBar.visible?sideBar.el.clientWidth:25,g=App.HEADER_HEIGHT,h=App.FOOTER_HEIGHT):h=g=d=0;f[0]<b[0]+this.options.scrollSensitivity&&(e[0]=f[0]-(b[0]+this.options.scrollSensitivity));f[1]<b[1]+this.options.scrollSensitivity+g&&(e[1]=f[1]-(b[1]+this.options.scrollSensitivity+g));f[0]>b[2]-this.options.scrollSensitivity-d&&(e[0]=f[0]-(b[2]-this.options.scrollSensitivity-d));f[1]>b[3]-this.options.scrollSensitivity-h&&(e[1]=f[1]-(b[3]-this.options.scrollSensitivity-h));this.startScrolling(e)}Prototype.Browser.WebKit&&
window.scrollBy(0,0);Event.stop(a)},finishDrag:function(a,c){this.dragging=!1;if(this.options.quiet){Position.prepare();var b=[Event.pointerX(a),Event.pointerY(a)];Droppables.show(b,this.element)}this.options.ghosting&&(!this._originallyAbsolute&&!this.element._listener&&Position.relativize(this.element),delete this._originallyAbsolute,this._clone&&Element.remove(this._clone),this._clone=null,this.options.parent&&this.element._previousPosition&&(this.element.parentNode.removeChild(this.element),b=
this.element._previousPosition,b.sibling?b.parent.insertBefore(this.element,b.sibling):b.parent.appendChild(this.element),this.element.setStyle({position:"relative"})));b=!1;c&&((b=Droppables.fire(a,this.element))?Draggables._lastPointer=null:b=!1);if(b&&this.options.onDropped)this.options.onDropped(this.element);Draggables.notify("onEnd",this,a);var d=this.options.revert;d&&Object.isFunction(d)&&(d=d(this.element));var e=this.currentDelta();d&&this.options.reverteffect?(0==b||"failure"!=d)&&this.options.reverteffect(this.element,
e[1]-this.delta[1],e[0]-this.delta[0]):this.delta=e;this.options.zindex&&(this.element.style.zIndex=this.originalZ);this.options.endeffect&&this.options.endeffect(this.element);Draggables.deactivate(this);Droppables.reset()},keyPress:function(a){a.keyCode==Event.KEY_ESC&&(this.finishDrag(a,!1),Event.stop(a))},endDrag:function(a){this.dragging&&(this.stopScrolling(),this.finishDrag(a,!0),Event.stop(a))},draw:function(a){var c=this.element.cumulativeOffset();if(this.options.ghosting&&!this.element._listener){var b=
Position.realOffset(this.element);c[0]+=b[0]-Position.deltaX;c[1]+=b[1]-Position.deltaY}b=this.currentDelta();c[0]-=b[0];c[1]-=b[1];this.options.scroll&&(this.options.scroll!=window&&this._isScrollChild)&&(b=Element.cumulativeScrollOffset(this.options.scroll),c[0]-=b[0]-this.originalScrollOffsets[0],c[1]-=b[1]-this.originalScrollOffsets[1]);b=[0,1].map(function(b){return a[b]-c[b]-this.offset[b]}.bind(this));this.options.snap&&(b=Object.isFunction(this.options.snap)?this.options.snap(b[0],b[1],this):
Object.isArray(this.options.snap)?b.map(function(a,b){return(a/this.options.snap[b]).round()*this.options.snap[b]}.bind(this)):b.map(function(a){return(a/this.options.snap).round()*this.options.snap}.bind(this)));var d=this.element.style;if(!this.options.constraint||"horizontal"==this.options.constraint)d.left=b[0]+"px";if(!this.options.constraint||"vertical"==this.options.constraint)d.top=b[1]+"px";"hidden"==d.visibility&&(d.visibility="")},stopScrolling:function(){this.scrollInterval&&(clearInterval(this.scrollInterval),
this.scrollInterval=null,Draggables._lastScrollPointer=null)},startScrolling:function(a){if(a[0]||a[1])this.scrollSpeed=[a[0]*this.options.scrollSpeed,a[1]*this.options.scrollSpeed],this.lastScrolled=new Date,this.scrollInterval=setInterval(this.scroll.bind(this),10)},scroll:function(){var a=new Date,c=a-this.lastScrolled;this.lastScrolled=a;if(this.options.scroll==window)with(this._getWindowScroll(this.options.scroll)){if(this.scrollSpeed[0]||this.scrollSpeed[1])a=c/1E3,this.options.scroll.scrollTo(left+
a*this.scrollSpeed[0],top+a*this.scrollSpeed[1])}else a=[parseInt(this.scrollSpeed[0]*c/1E3),parseInt(this.scrollSpeed[1]*c/1E3)],this.options.scroll.scrollLeft+=a[0],this.options.scroll.scrollTop+=a[1];Position.prepare();Droppables.show(Draggables._lastPointer,this.element);Draggables.notify("onDrag",this);this._isScrollChild&&(Draggables._lastScrollPointer=Draggables._lastScrollPointer||$A(Draggables._lastPointer),Draggables._lastScrollPointer[0]+=parseInt(this.scrollSpeed[0]*c/1E3),Draggables._lastScrollPointer[1]+=
parseInt(this.scrollSpeed[1]*c/1E3),0>Draggables._lastScrollPointer[0]&&(Draggables._lastScrollPointer[0]=0),0>Draggables._lastScrollPointer[1]&&(Draggables._lastScrollPointer[1]=0),this.draw(Draggables._lastScrollPointer));this.options.change&&this.options.change(this)},_getWindowScroll:function(a){var c,b,d;with(a.document)a.document.documentElement&&documentElement.scrollTop?(c=documentElement.scrollTop,b=documentElement.scrollLeft):a.document.body&&(c=body.scrollTop,b=body.scrollLeft),a.innerWidth?
(d=a.innerWidth,a=a.innerHeight):a.document.documentElement&&documentElement.clientWidth?(d=documentElement.clientWidth,a=documentElement.clientHeight):(d=body.offsetWidth,a=body.offsetHeight);return{top:c,left:b,width:d,height:a}}});Draggable._dragging={};
var SortableObserver=Class.create({initialize:function(a,c){this.element=$(a);this.observer=c;this.lastValue=Sortable.serialize(this.element)},onStart:function(){this.lastValue=Sortable.serialize(this.element)},onEnd:function(a,c){Sortable.unmark();this.lastValue!=Sortable.serialize(this.element)&&this.observer(this.element,c)}}),Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(a){for(;"BODY"!=a.tagName.toUpperCase();){if(a.id&&Sortable.sortables[a.id])return a;
a=a.parentNode}},options:function(a){if(a=Sortable._findRootElement($(a)))return Sortable.sortables[a.id]},destroy:function(a){a=$(a);if(a=Sortable.sortables[a.id])Draggables.removeObserver(a.element),a.droppables.each(function(a){Droppables.remove(a)}),a.draggables.invoke("destroy"),delete Sortable.sortables[a.element.id]},create:function(a,c){var a=$(a),b=Object.extend({element:a,tag:"li",dropOnEmpty:!1,tree:!1,treeTag:"ul",overlap:"vertical",constraint:"vertical",containment:a,handle:!1,only:!1,
delay:0,hoverclass:null,ghosting:!1,quiet:!1,scroll:!1,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:!1,handles:!1,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},c||{});this.destroy(a);var d={revert:!0,quiet:b.quiet,scroll:b.scroll,scrollSpeed:b.scrollSpeed,scrollSensitivity:b.scrollSensitivity,delay:b.delay,ghosting:b.ghosting,constraint:b.constraint,handle:b.handle};b.starteffect&&(d.starteffect=b.starteffect);b.reverteffect?d.reverteffect=b.reverteffect:
b.ghosting&&(d.reverteffect=function(a){a.style.top=0;a.style.left=0});b.endeffect&&(d.endeffect=b.endeffect);b.zindex&&(d.zindex=b.zindex);var e={overlap:b.overlap,containment:b.containment,tree:b.tree,hoverclass:b.hoverclass,onHover:Sortable.onHover},f={onHover:Sortable.onEmptyHover,overlap:b.overlap,containment:b.containment,hoverclass:b.hoverclass};Element.cleanWhitespace(a);b.draggables=[];b.droppables=[];if(b.dropOnEmpty||b.tree)Droppables.add(a,f),b.droppables.push(a);(b.elements||this.findElements(a,
b)||[]).each(function(c,f){var j=b.handles?$(b.handles[f]):b.handle?$(c).select("."+b.handle)[0]:c;b.draggables.push(new Draggable(c,Object.extend(d,{handle:j})));Droppables.add(c,e);b.tree&&(c.treeNode=a);b.droppables.push(c)});b.tree&&(Sortable.findTreeElements(a,b)||[]).each(function(c){Droppables.add(c,f);c.treeNode=a;b.droppables.push(c)});this.sortables[a.identify()]=b;Draggables.addObserver(new SortableObserver(a,b.onUpdate))},findElements:function(a,c){return Element.findChildren(a,c.only,
c.tree?!0:!1,c.tag)},findTreeElements:function(a,c){return Element.findChildren(a,c.only,c.tree?!0:!1,c.treeTag)},onHover:function(a,c,b){if(!Element.isParent(c,a)&&!(0.33<b&&0.66>b&&Sortable.options(c).tree))if(0.5<b){if(Sortable.mark(c,"before"),c.previousSibling!=a){b=a.parentNode;a.style.visibility="hidden";c.parentNode.insertBefore(a,c);if(c.parentNode!=b)Sortable.options(b).onChange(a);Sortable.options(c.parentNode).onChange(a)}}else{Sortable.mark(c,"after");var d=c.nextSibling||null;if(d!=
a){b=a.parentNode;a.style.visibility="hidden";c.parentNode.insertBefore(a,d);if(c.parentNode!=b)Sortable.options(b).onChange(a);Sortable.options(c.parentNode).onChange(a)}}},onEmptyHover:function(a,c,b){var d=a.parentNode,e=Sortable.options(c);if(!Element.isParent(c,a)){var f=Sortable.findElements(c,{tag:e.tag,only:e.only}),g=null;if(f)for(var h=Element.offsetSize(c,e.overlap)*(1-b),b=0;b<f.length;b+=1)if(0<=h-Element.offsetSize(f[b],e.overlap))h-=Element.offsetSize(f[b],e.overlap);else{g=0<=h-Element.offsetSize(f[b],
e.overlap)/2?b+1<f.length?f[b+1]:null:f[b];break}c.insertBefore(a,g);Sortable.options(d).onChange(a);e.onChange(a)}},unmark:function(){Sortable._marker&&Sortable._marker.hide()},mark:function(a,c){var b=Sortable.options(a.parentNode);if(!b||b.ghosting){Sortable._marker||(Sortable._marker=($("dropmarker")||Element.extend(document.createElement("DIV"))).hide().addClassName("dropmarker").setStyle({position:"absolute"}),document.getElementsByTagName("body").item(0).appendChild(Sortable._marker));var d=
a.cumulativeOffset();Sortable._marker.setStyle({left:d[0]+"px",top:d[1]+"px"});"after"==c&&("horizontal"==b.overlap?Sortable._marker.setStyle({left:d[0]+a.clientWidth+"px"}):Sortable._marker.setStyle({top:d[1]+a.clientHeight+"px"}));Sortable._marker.show()}},_tree:function(a,c,b){for(var d=Sortable.findElements(a,c)||[],e=0;e<d.length;++e){var f=d[e].id.match(c.format);f&&(f={id:encodeURIComponent(f?f[1]:null),element:a,parent:b,children:[],position:b.children.length,container:$(d[e]).down(c.treeTag)},
f.container&&this._tree(f.container,c,f),b.children.push(f))}return b},tree:function(a,c){var a=$(a),b=this.options(a),b=Object.extend({tag:b.tag,treeTag:b.treeTag,only:b.only,name:a.id,format:b.format},c||{});return Sortable._tree(a,b,{id:null,parent:null,children:[],container:a,position:0})},_constructIndex:function(a){var c="";do a.id&&(c="["+a.position+"]"+c);while(null!=(a=a.parent));return c},sequence:function(a,c){var a=$(a),b=Object.extend(this.options(a),c||{});return $(this.findElements(a,
b)||[]).map(function(a){return a.id.match(b.format)?a.id.match(b.format)[1]:""})},setSequence:function(a,c,b){var a=$(a),d=Object.extend(this.options(a),b||{}),e={};this.findElements(a,d).each(function(a){a.id.match(d.format)&&(e[a.id.match(d.format)[1]]=[a,a.parentNode]);a.parentNode.removeChild(a)});c.each(function(a){var b=e[a];b&&(b[1].appendChild(b[0]),delete e[a])})},serialize:function(a,c){var a=$(a),b=Object.extend(Sortable.options(a),c||{}),d=encodeURIComponent(c&&c.name?c.name:a.id);return b.tree?
Sortable.tree(a,c).children.map(function(a){return[d+Sortable._constructIndex(a)+"[id]="+encodeURIComponent(a.id)].concat(a.children.map(arguments.callee))}).flatten().join("&"):Sortable.sequence(a,c).map(function(a){return d+"[]="+encodeURIComponent(a)}).join("&")}};Element.isParent=function(a,c){return!a.parentNode||a==c?!1:a.parentNode==c?!0:Element.isParent(a.parentNode,c)};
Element.findChildren=function(a,c,b,d){if(!a.hasChildNodes())return null;d=d.toUpperCase();c&&(c=[c].flatten());var e=[];$A(a.childNodes).each(function(a){a.tagName&&(a.tagName.toUpperCase()==d&&(!c||Element.classNames(a).detect(function(a){return c.include(a)})))&&e.push(a);b&&(a=Element.findChildren(a,c,b,d))&&e.push(a)});return 0<e.length?e.flatten():[]};Element.offsetSize=function(a,c){return a["offset"+("vertical"==c||"height"==c?"Height":"Width")]};
if("undefined"==typeof Effect)throw"controls.js requires including script.aculo.us' effects.js library";var Autocompleter={};
Autocompleter.Base=Class.create({baseInitialize:function(a,b,c){this.element=a=$(a);this.update=$(b);this.active=this.changed=this.hasFocus=!1;this.entryCount=this.index=0;this.oldElementValue=this.element.value;this.setOptions?this.setOptions(c):this.options=c||{};this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||
function(a,b){if(!b.style.position||"absolute"==b.style.position)b.style.position="absolute",Position.clone(a,b,{setHeight:!1,offsetTop:a.offsetHeight});Effect.Appear(b,{duration:0.15})};this.options.onHide=this.options.onHide||function(a,b){new Effect.Fade(b,{duration:0.15})};"string"==typeof this.options.tokens&&(this.options.tokens=Array(this.options.tokens));this.options.tokens.include("\n")||this.options.tokens.push("\n");this.observer=null;this.element.setAttribute("autocomplete","off");Element.hide(this.update);
Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){if("none"==Element.getStyle(this.update,"display"))this.options.onShow(this.element,this.update);!this.iefix&&(Prototype.Browser.IE&&"absolute"==Element.getStyle(this.update,"position"))&&(new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>'),
this.iefix=$(this.update.id+"_iefix"));this.iefix&&setTimeout(this.fixIEOverlapping.bind(this),50)},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:!this.update.style.height});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix)},hide:function(){this.stopIndicator();if("none"!=Element.getStyle(this.update,"display"))this.options.onHide(this.element,this.update);this.iefix&&Element.hide(this.iefix)},startIndicator:function(){this.options.indicator&&
Element.show(this.options.indicator)},stopIndicator:function(){this.options.indicator&&Element.hide(this.options.indicator)},onKeyPress:function(a){if(this.active)switch(a.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry(),Event.stop(a);case Event.KEY_ESC:this.hide();this.active=!1;Event.stop(a);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(a);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(a);
return}else if(a.keyCode==Event.KEY_TAB||a.keyCode==Event.KEY_RETURN||0<Prototype.Browser.WebKit&&0==a.keyCode)return;this.hasFocus=this.changed=!0;this.observer&&clearTimeout(this.observer);this.observer=setTimeout(this.onObserverEvent.bind(this),1E3*this.options.frequency)},activate:function(){this.changed=!1;this.hasFocus=!0;this.getUpdatedChoices()},onHover:function(a){var b=Event.findElement(a,"LI");this.index!=b.autocompleteIndex&&(this.index=b.autocompleteIndex,this.render());Event.stop(a)},
onClick:function(a){this.index=Event.findElement(a,"LI").autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(){setTimeout(this.hide.bind(this),250);this.active=this.hasFocus=!1},render:function(){if(0<this.entryCount){for(var a=0;a<this.entryCount;a++)this.index==a?Element.addClassName(this.getEntry(a),"selected"):Element.removeClassName(this.getEntry(a),"selected");this.hasFocus&&(this.show(),this.active=!0)}else this.active=!1,this.hide()},markPrevious:function(){0<this.index?this.index--:
this.index=this.entryCount-1;this.getEntry(this.index).scrollIntoView(!0)},markNext:function(){this.index<this.entryCount-1?this.index++:this.index=0;this.getEntry(this.index).scrollIntoView(!1)},getEntry:function(a){return this.update.firstChild.childNodes[a]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=!1;this.updateElement(this.getCurrentEntry())},updateElement:function(a){if(this.options.updateElement)this.options.updateElement(a);else{var b=
"";if(this.options.select){var c=$(a).select("."+this.options.select)||[];0<c.length&&(b=Element.collectTextNodes(c[0],this.options.select))}else b=Element.collectTextNodesIgnoreClass(a,"informal");c=this.getTokenBounds();if(-1!=c[0]){var d=this.element.value.substr(0,c[0]),e=this.element.value.substr(c[0]).match(/^\s+/);e&&(d+=e[0]);this.element.value=d+b+this.element.value.substr(c[1])}else this.element.value=b;this.oldElementValue=this.element.value;this.element.focus();this.options.afterUpdateElement&&
this.options.afterUpdateElement(this.element,a)}},updateChoices:function(a){if(!this.changed&&this.hasFocus){this.update.innerHTML=a;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}}else this.entryCount=0;this.stopIndicator();this.index=0;1==this.entryCount&&this.options.autoSelect?
(this.selectEntry(),this.hide()):this.render()}},addObservers:function(a){Event.observe(a,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(a,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=!1;this.tokenBounds=null;this.getToken().length>=this.options.minChars?this.getUpdatedChoices():(this.active=!1,this.hide());this.oldElementValue=this.element.value},getToken:function(){var a=this.getTokenBounds();return this.element.value.substring(a[0],
a[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds)return this.tokenBounds;var a=this.element.value;if(a.strip().empty())return[-1,0];for(var b=arguments.callee.getFirstDifferencePos(a,this.oldElementValue),c=b==this.oldElementValue.length?1:0,d=-1,e=a.length,h,f=0,g=this.options.tokens.length;f<g;++f)h=a.lastIndexOf(this.options.tokens[f],b+c-1),h>d&&(d=h),h=a.indexOf(this.options.tokens[f],b+c),-1!=h&&h<e&&(e=h);return this.tokenBounds=[d+1,e]}});
Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(a,b){for(var c=Math.min(a.length,b.length),d=0;d<c;++d)if(a[d]!=b[d])return d;return c};
Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(a,b,c,d){this.baseInitialize(a,b,d);this.options.asynchronous=!0;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=c},getUpdatedChoices:function(){this.startIndicator();var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,a):a;this.options.defaultParams&&
(this.options.parameters+="&"+this.options.defaultParams);new Ajax.Request(this.url,this.options)},onComplete:function(a){this.updateChoices(a.responseText)}});
Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(a,b,c,d){this.baseInitialize(a,b,d);this.options.array=c},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(a){this.options=Object.extend({choices:10,partialSearch:!0,partialChars:2,ignoreCase:!0,fullSearch:!1,selector:function(a){for(var c=[],d=[],e=a.getToken(),h=0;h<a.options.array.length&&c.length<a.options.choices;h++)for(var f=a.options.array[h],g=a.options.ignoreCase?f.toLowerCase().indexOf(e.toLowerCase()):
f.indexOf(e);-1!=g;){if(0==g&&f.length!=e.length){c.push("<li><strong>"+f.substr(0,e.length)+"</strong>"+f.substr(e.length)+"</li>");break}else if(e.length>=a.options.partialChars&&(a.options.partialSearch&&-1!=g)&&(a.options.fullSearch||/\s/.test(f.substr(g-1,1)))){d.push("<li>"+f.substr(0,g)+"<strong>"+f.substr(g,e.length)+"</strong>"+f.substr(g+e.length)+"</li>");break}g=a.options.ignoreCase?f.toLowerCase().indexOf(e.toLowerCase(),g+1):f.indexOf(e,g+1)}d.length&&(c=c.concat(d.slice(0,a.options.choices-
c.length)));return"<ul>"+c.join("")+"</ul>"}},a||{})}});Field.scrollFreeActivate=function(a){setTimeout(function(){Field.activate(a)},1)};
Ajax.InPlaceEditor=Class.create({initialize:function(a,b,c){this.url=b;this.element=a=$(a);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(c);Object.extend(this.options,c||{});!this.options.formId&&this.element.id&&(this.options.formId=this.element.id+"-inplaceeditor",$(this.options.formId)&&(this.options.formId=""));this.options.externalControl&&(this.options.externalControl=$(this.options.externalControl));this.options.externalControl||(this.options.externalControlOnly=
!1);this._originalBackground=this.element.getStyle("background-color")||"transparent";this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this.registerListeners()},checkForEscapeOrReturn:function(a){this._editing&&
(!a.ctrlKey&&!a.altKey&&!a.shiftKey)&&(Event.KEY_ESC==a.keyCode?this.handleFormCancellation(a):Event.KEY_RETURN==a.keyCode&&this.handleFormSubmission(a))},createControl:function(a,b,c){var d=this.options[a+"Control"],b=this.options[a+"Text"];"button"==d?(c=document.createElement("input"),c.type="submit",c.value=b,c.className="editor_"+a+"_button","cancel"==a&&(c.onclick=this._boundCancelHandler),this._form.appendChild(c),this._controls[a]=c):"link"==d&&(d=document.createElement("a"),d.href="#",d.appendChild(document.createTextNode(b)),
d.onclick="cancel"==a?this._boundCancelHandler:this._boundSubmitHandler,d.className="editor_"+a+"_link",c&&(d.className+=" "+c),this._form.appendChild(d),this._controls[a]=d)},createEditField:function(){var a=this.options.loadTextURL?this.options.loadingText:this.getText(),b;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){b=document.createElement("input");b.type="text";var c=this.options.size||this.options.cols||0;0<c&&(b.size=c)}else b=document.createElement("textarea"),b.rows=1>=this.options.rows?
this.options.autoRows:this.options.rows,b.cols=this.options.cols||40;b.name=this.options.paramName;b.value=a;b.className="editor_field";this.options.submitOnBlur&&(b.onblur=this._boundSubmitHandler);this._controls.editor=b;this.options.loadTextURL&&this.loadExternalText();this._form.appendChild(this._controls.editor)},createForm:function(){function a(a,d){var e=b.options["text"+a+"Controls"];e&&!1!==d&&b._form.appendChild(document.createTextNode(e))}var b=this;this._form=$(document.createElement("form"));
this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();"textarea"==this._controls.editor.tagName.toLowerCase()&&this._form.appendChild(document.createElement("br"));if(this.options.onFormCustomization)this.options.onFormCustomization(this,this._form);a("Before",this.options.okControl||this.options.cancelControl);this.createControl("ok",this._boundSubmitHandler);a("Between",this.options.okControl&&this.options.cancelControl);
this.createControl("cancel",this._boundCancelHandler,"editor_cancel");a("After",this.options.okControl||this.options.cancelControl)},destroy:function(){this._oldInnerHTML&&(this.element.innerHTML=this._oldInnerHTML);this.leaveEditMode();this.unregisterListeners()},enterEditMode:function(a){!this._saving&&!this._editing&&(this._editing=!0,this.triggerCallback("onEnterEditMode"),this.options.externalControl&&this.options.externalControl.hide(),this.element.hide(),this.createForm(),this.element.parentNode.insertBefore(this._form,
this.element),this.options.loadTextURL||this.postProcessEditField(),a&&Event.stop(a))},enterHover:function(){this.options.hoverClassName&&this.element.addClassName(this.options.hoverClassName);this._saving||this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML.unescapeHTML()},handleAJAXFailure:function(a){this.triggerCallback("onFailure",a);this._oldInnerHTML&&(this.element.innerHTML=this._oldInnerHTML,this._oldInnerHTML=null)},handleFormCancellation:function(a){this.wrapUp();
a&&Event.stop(a)},handleFormSubmission:function(a){var b=this._form,c=$F(this._controls.editor);this.prepareSubmission();b=this.options.callback(b,c)||"";Object.isString(b)&&(b=b.toQueryParams());b.editorId=this.element.id;this.options.htmlResponse?(c=Object.extend({evalScripts:!0},this.options.ajaxOptions),Object.extend(c,{parameters:b,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler}),new Ajax.Updater({success:this.element},this.url,c)):(c=Object.extend({method:"get"},this.options.ajaxOptions),
Object.extend(c,{parameters:b,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler}),new Ajax.Request(this.url,c));a&&Event.stop(a)},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();this.options.externalControl&&this.options.externalControl.show();this._editing=this._saving=!1;this._oldInnerHTML=null;this.triggerCallback("onLeaveEditMode")},
leaveHover:function(){this.options.hoverClassName&&this.element.removeClassName(this.options.hoverClassName);this._saving||this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=!0;var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(a){this._form.removeClassName(this.options.loadingClassName);
a=a.responseText;this.options.stripLoadedTextTags&&(a=a.stripTags());this._controls.editor.value=a;this._controls.editor.disabled=!1;this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,a)},postProcessEditField:function(){var a=this.options.fieldPostCreation;if(a)$(this._controls.editor)["focus"==a?"focus":"activate"]()},prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,
Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(a){Object.extend(this.options,a)}.bind(this))},prepareSubmission:function(){this._saving=!0;this.removeForm();this.leaveHover();this.showSaving()},registerListeners:function(){this._listeners={};var a;$H(Ajax.InPlaceEditor.Listeners).each(function(b){a=this[b.value].bind(this);this._listeners[b.key]=a;this.options.externalControlOnly||this.element.observe(b.key,a);this.options.externalControl&&this.options.externalControl.observe(b.key,
a)}.bind(this))},removeForm:function(){this._form&&(this._form.remove(),this._form=null,this._controls={})},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show()},triggerCallback:function(a,b){if("function"==typeof this.options[a])this.options[a](this,b)},unregisterListeners:function(){$H(this._listeners).each(function(a){this.options.externalControlOnly||
this.element.stopObserving(a.key,a.value);this.options.externalControl&&this.options.externalControl.stopObserving(a.key,a.value)}.bind(this))},wrapUp:function(a){this.leaveEditMode();this._boundComplete(a,this.element)}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});
Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,b,c,d){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(b,c,d)},createEditField:function(){var a=document.createElement("select");a.name=this.options.paramName;a.size=1;this._controls.editor=a;this._collection=this.options.collection||[];this.options.loadCollectionURL?this.loadCollection():this.checkForExternalText();this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);
this.showLoadingText(this.options.loadingCollectionText);var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(a){a=a.responseText.strip();if(!/^\[.*\]$/.test(a))throw"Server returned an invalid collection representation.";this._collection=eval(a);this.checkForExternalText()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,a)},
showLoadingText:function(a){this._controls.editor.disabled=!0;var b=this._controls.editor.firstChild;b||(b=document.createElement("option"),b.value="",this._controls.editor.appendChild(b),b.selected=!0);b.update((a||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText();this.options.loadTextURL?this.loadExternalText():this.buildOptionList()},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var a=Object.extend({method:"get"},this.options.ajaxOptions);
Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(a){this._text=a.responseText.strip();this.buildOptionList()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,a)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(a){return 2===a.length?a:[a,a].flatten()});var a="value"in this.options?this.options.value:this._text,
b=this._collection.any(function(b){return b[0]==a}.bind(this));this._controls.editor.update("");var c;this._collection.each(function(d,e){c=document.createElement("option");c.value=d[0];c.selected=b?d[0]==a:0==e;c.appendChild(document.createTextNode(d[1]));this._controls.editor.appendChild(c)}.bind(this));this._controls.editor.disabled=!1;Field.scrollFreeActivate(this._controls.editor)}});
Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(a){function b(b,d){b in a||void 0===d||(a[b]=d)}a&&(b("cancelControl",a.cancelLink?"link":a.cancelButton?"button":!1==(a.cancelLink==a.cancelButton)?!1:void 0),b("okControl",a.okLink?"link":a.okButton?"button":!1==(a.okLink==a.okButton)?!1:void 0),b("highlightColor",a.highlightcolor),b("highlightEndColor",a.highlightendcolor))};
Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelText:"cancel",clickToEditText:"Click to edit",externalControl:null,externalControlOnly:!1,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:!0,loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",
savingText:"Saving...",size:0,stripLoadedTextTags:!1,submitOnBlur:!1,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(a){return Form.serialize(a)},onComplete:function(a,b){new Effect.Highlight(b,{startcolor:this.options.highlightColor,keepBackgroundImage:!0})},onEnterEditMode:null,onEnterHover:function(a){a.element.style.backgroundColor=a.options.highlightColor;a._effect&&a._effect.cancel()},onFailure:function(a){alert("Error communication with the server: "+
a.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(a){a._effect=new Effect.Highlight(a.element,{startcolor:a.options.highlightColor,endcolor:a.options.highlightEndColor,restorecolor:a._originalBackground,keepBackgroundImage:!0})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."};
Form.Element.DelayedObserver=Class.create({initialize:function(a,b,c){this.delay=b||0.5;this.element=$(a);this.callback=c;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(){this.lastValue!=$F(this.element)&&(this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.onTimerEvent.bind(this),1E3*this.delay),this.lastValue=$F(this.element))},onTimerEvent:function(){this.timer=null;this.callback(this.element,
$F(this.element))}});
if(!Control)var Control={};
Control.Slider=Class.create({initialize:function(a,b,c){var d=this;this.handles=Object.isArray(a)?a.collect(function(a){return $(a)}):[$(a)];this.track=$(b);this.options=c||{};this.axis=this.options.axis||"horizontal";this.increment=this.options.increment||1;this.step=parseInt(this.options.step||"1");this.range=this.options.range||$R(0,1);this.value=0;this.values=this.handles.map(function(){return 0});this.spans=this.options.spans?this.options.spans.map(function(a){return $(a)}):!1;this.options.startSpan=
$(this.options.startSpan||null);this.options.endSpan=$(this.options.endSpan||null);this.restricted=this.options.restricted||!1;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||"0");this.alignY=parseInt(this.options.alignY||"0");this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?0!=this.handles[0].offsetHeight?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,
""):0!=this.handles[0].offsetWidth?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,"");this.disabled=this.dragging=this.active=!1;this.options.disabled&&this.setDisabled();if(this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):!1)this.minimum=this.allowedValues.min(),this.maximum=this.allowedValues.max();this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);
this.handles.each(function(a,b){b=d.handles.length-1-b;d.setValue(parseFloat((Object.isArray(d.options.sliderValue)?d.options.sliderValue[b]:d.options.sliderValue)||d.range.start),b);a.makePositioned().observe("mousedown",d.eventMouseDown)});this.track.observe("mousedown",this.eventMouseDown);document.observe("mouseup",this.eventMouseUp);document.observe("mousemove",this.eventMouseMove);this.initialized=!0},dispose:function(){var a=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown);
Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);this.handles.each(function(b){Event.stopObserving(b,"mousedown",a.eventMouseDown)})},setDisabled:function(){this.disabled=!0},setEnabled:function(){this.disabled=!1},getNearestValue:function(a){if(this.allowedValues){if(a>=this.allowedValues.max())return this.allowedValues.max();if(a<=this.allowedValues.min())return this.allowedValues.min();var b=Math.abs(this.allowedValues[0]-a),
c=this.allowedValues[0];this.allowedValues.each(function(d){var e=Math.abs(d-a);e<=b&&(c=d,b=e)});return c}return a>this.range.end?this.range.end:a<this.range.start?this.range.start:a},setValue:function(a,b){this.active||(this.activeHandleIdx=b||0,this.activeHandle=this.handles[this.activeHandleIdx],this.updateStyles());b=b||this.activeHandleIdx||0;this.initialized&&this.restricted&&(0<b&&a<this.values[b-1]&&(a=this.values[b-1]),b<this.handles.length-1&&a>this.values[b+1]&&(a=this.values[b+1]));a=
this.getNearestValue(a);this.values[b]=a;this.value=this.values[0];this.handles[b].style[this.isVertical()?"top":"left"]=this.translateToPx(a);this.drawSpans();(!this.dragging||!this.event)&&this.updateFinished()},setValueBy:function(a,b){this.setValue(this.values[b||this.activeHandleIdx||0]+a,b||this.activeHandleIdx||0)},translateToPx:function(a){return Math.round((this.trackLength-this.handleLength)/(this.range.end-this.range.start)*(a-this.range.start))+"px"},translateToValue:function(a){return a/
(this.trackLength-this.handleLength)*(this.range.end-this.range.start)+this.range.start},getRange:function(a){var b=this.values.sortBy(Prototype.K),a=a||0;return $R(b[a],b[a+1])},minimumOffset:function(){return this.isVertical()?this.alignY:this.alignX},maximumOffset:function(){return this.isVertical()?(0!=this.track.offsetHeight?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(0!=this.track.offsetWidth?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-
this.alignX},isVertical:function(){return"vertical"==this.axis},drawSpans:function(){var a=this;this.spans&&$R(0,this.spans.length-1).each(function(b){a.setSpan(a.spans[b],a.getRange(b))});this.options.startSpan&&this.setSpan(this.options.startSpan,$R(0,1<this.values.length?this.getRange(0).min():this.value));this.options.endSpan&&this.setSpan(this.options.endSpan,$R(1<this.values.length?this.getRange(this.spans.length-1).max():this.value,this.maximum))},setSpan:function(a,b){this.isVertical()?(a.style.top=
this.translateToPx(b.start),a.style.height=this.translateToPx(b.end-b.start+this.range.start)):(a.style.left=this.translateToPx(b.start),a.style.width=this.translateToPx(b.end-b.start+this.range.start))},updateStyles:function(){this.handles.each(function(a){Element.removeClassName(a,"selected")});Element.addClassName(this.activeHandle,"selected")},startDrag:function(a){if(Event.isLeftClick(a)){if(!this.disabled){this.active=!0;var b=Event.element(a),c=[Event.pointerX(a),Event.pointerY(a)];if(b==this.track)b=
this.track.cumulativeOffset(),this.event=a,this.setValue(this.translateToValue((this.isVertical()?c[1]-b[1]:c[0]-b[0])-this.handleLength/2)),b=this.activeHandle.cumulativeOffset(),this.offsetX=c[0]-b[0],this.offsetY=c[1]-b[1];else{for(;-1==this.handles.indexOf(b)&&b.parentNode;)b=b.parentNode;-1!=this.handles.indexOf(b)&&(this.activeHandle=b,this.activeHandleIdx=this.handles.indexOf(this.activeHandle),this.updateStyles(),b=this.activeHandle.cumulativeOffset(),this.offsetX=c[0]-b[0],this.offsetY=c[1]-
b[1])}}Event.stop(a)}},update:function(a){this.active&&(this.dragging||(this.dragging=!0),this.draw(a),Prototype.Browser.WebKit&&window.scrollBy(0,0),Event.stop(a))},draw:function(a){var b=[Event.pointerX(a),Event.pointerY(a)],c=this.track.cumulativeOffset();b[0]-=this.offsetX+c[0];b[1]-=this.offsetY+c[1];this.event=a;this.setValue(this.translateToValue(this.isVertical()?b[1]:b[0]));if(this.initialized&&this.options.onSlide)this.options.onSlide(1<this.values.length?this.values:this.value,this)},endDrag:function(a){this.active&&
this.dragging&&(this.finishDrag(a,!0),Event.stop(a));this.dragging=this.active=!1},finishDrag:function(){this.dragging=this.active=!1;this.updateFinished()},updateFinished:function(){if(this.initialized&&this.options.onChange)this.options.onChange(1<this.values.length?this.values:this.value,this);this.event=null}});
window.Modernizr=function(e,i,m){function t(a,b){for(var h in a){var g=a[h];if(!~(""+g).indexOf("-")&&u[g]!==m)return"pfx"==b?g:!0}return!1}function f(a,b,h){var g=a.charAt(0).toUpperCase()+a.slice(1),c=(a+" "+v.join(g+" ")+g).split(" ");if("string"===typeof b||"undefined"===typeof b)return t(c,b);c=(a+" "+w.join(g+" ")+g).split(" ");a:{var a=c,d;for(d in a)if(g=b[a[d]],g!==m){if(!1===h){b=a[d];break a}if("function"===typeof g){b=g.bind(h||b);break a}b=g;break a}b=!1}return b}var c={},l=i.documentElement,
d=i.createElement("modernizr"),u=d.style,v=["Webkit","Moz","O","ms"],w=["webkit","moz","o","ms"],d={},x=[],p=x.slice,n,y=function(a,b,h,c){var d,e,j=i.createElement("div"),f=i.body,k=f||i.createElement("body");if(parseInt(h,10))for(;h--;)d=i.createElement("div"),d.id=c?c[h]:"modernizr"+(h+1),j.appendChild(d);h=['&#173;<style id="smodernizr">',a,"</style>"].join("");j.id="modernizr";(f?j:k).innerHTML+=h;k.appendChild(j);f||(k.style.background="",k.style.overflow="hidden",e=l.style.overflow,l.style.overflow=
"hidden",l.appendChild(k));a=b(j,a);f?j.parentNode.removeChild(j):(k.parentNode.removeChild(k),l.style.overflow=e);return!!a},z={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"},q={}.hasOwnProperty,r;r="undefined"!==typeof q&&"undefined"!==typeof q.call?function(a,b){return q.call(a,b)}:function(a,b){return b in a&&"undefined"===typeof a.constructor.prototype[b]};Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;
var c=p.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var e=new e,f=b.apply(e,c.concat(p.call(arguments)));return Object(f)===f?f:e}return b.apply(a,c.concat(p.call(arguments)))};return d});d.draganddrop=function(){var a=i.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a};d.websockets=function(){return"WebSocket"in e||"MozWebSocket"in e};d.csstransforms=function(){return!!f("transform")};d.csstransforms3d=function(){var a=
!!f("perspective");a&&"webkitPerspective"in l.style&&y("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b){a=9===b.offsetLeft&&3===b.offsetHeight});return a};d.csstransitions=function(){return f("transition")};d.video=function(){var a=i.createElement("video"),b=!1;try{if(b=!!a.canPlayType)b=new Boolean(b),b.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),b.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,
""),b.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}catch(c){}return b};for(var s in d)r(d,s)&&(n=s.toLowerCase(),c[n]=d[s](),x.push((c[n]?"":"no-")+n));c.addTest=function(a,b){if("object"==typeof a)for(var d in a)r(a,d)&&c.addTest(d,a[d]);else{a=a.toLowerCase();if(c[a]!==m)return c;b="function"==typeof b?b():b;"undefined"!==typeof enableClasses&&enableClasses&&(l.className+=" "+(b?"":"no-")+a);c[a]=b}return c};u.cssText="";d=null;c._version="2.6.2";c._prefixes=" -webkit- -moz- -o- -ms- ".split(" ");
c._domPrefixes=w;c._cssomPrefixes=v;c.hasEvent=function(a,b){var b=b||i.createElement(z[a]||"div"),a="on"+a,c=a in b;c||(b.setAttribute||(b=i.createElement("div")),b.setAttribute&&b.removeAttribute&&(b.setAttribute(a,""),c="function"===typeof b[a],"undefined"===typeof b[a]||(b[a]=m),b.removeAttribute(a)));return c};c.testProp=function(a){return t([a])};c.testAllProps=f;c.testStyles=y;c.prefixed=function(a,b,c){return b?f(a,b,c):f(a,"pfx")};return c}(this,this.document);
Modernizr.addTest("cssfilters",function(){var e=document.createElement("div");e.style.cssText=Modernizr._prefixes.join("filter:blur(2px); ");return!!e.style.length&&(void 0===document.documentMode||9<document.documentMode)});Modernizr.addTest("fullscreen",function(){for(var e=0;e<Modernizr._domPrefixes.length;e++)if(document[Modernizr._domPrefixes[e].toLowerCase()+"CancelFullScreen"])return!0;return!!document.cancelFullScreen||!1});
Modernizr.addTest("notification",!!Modernizr.prefixed("Notifications",window));
function _(a){return document.getElementById(a)}_Element={toggle:function(a){a.style.display="none"==a.style.display?"":"none"},visible:function(a){return"none"!=a.style.display}};
_Event={blurObservers:[],observeBlur:function(a,c){a.observe("blur",c);this.blurObservers.push(c)},stopObservingBlur:function(a,c){a.stopObserving("blur",c);this.blurObservers.remove(c)},callBlurObservers:function(){for(var a=0;a<this.blurObservers.length;a++)this.blurObservers[a]()},triggerEvent:function(a,c,d){var e=document.createEvent("CustomEvent");e.initCustomEvent(c,!0,!0,d);a.dispatchEvent(e)}};Ajax.Responders.register({onComplete:function(a){_Event.triggerEvent(document,"ajax:complete",a)}});
var isEventSupported=function(a){var c={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return function(d,e){var e=e||document.createElement(c[d]||"div"),d="on"+d,f=d in e;f||(e.setAttribute||(e=document.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(d,""),f="function"==typeof e[d],"undefined"!=typeof e[d]&&(e[d]=a),e.removeAttribute(d)));return f}}();
function getStyle(a,c){var d=a.style[c];if(!d||"auto"==d)d=(d=document.defaultView?document.defaultView.getComputedStyle(a,null):null)?d[c]:null;return"opacity"==c?d?parseFloat(d):1:"auto"==d?null:d}function childElements(a){var c=[];if(!a.hasChildNodes())return[];for(var a=a.childNodes,d=0,e=a.length;d<e;d++){var f=a[d];1==f.nodeType&&c.push(f)}return c}
function isVisible(a){if(a.style&&"none"==a.style.display)return!1;for(a=a.parentNode;a&&a!=document;){if(a.style&&a.style.display&&"none"==a.style.display)return!1;a=a.parentNode}return!0}function hideForPositioning(a){a.style.display="none";a.style.visibility="visible"}function showForPositioning(a){a.style.visibility="hidden";a.style.display=""}
function descendants(a,c){var d=[];if(!a.hasChildNodes())return[];for(var e=a.childNodes,f=0,h=e.length;f<h;f++){var i=e[f];1==i.nodeType&&(c&&c.call(null,i))&&d.push(i);i.hasChildNodes()&&(d=d.concat(descendants(i,c)))}return d}function nextSibling(a,c){var d=a.nextSibling;return!d?null:1==d.nodeType&&c&&c.call(null,d)?d:nextSibling(d,c)}function nextTwin(a){return nextSibling(a,function(c){return c.tagName==a.tagName})}
function previousSibling(a,c){var d=a.previousSibling;return!d?null:1==d.nodeType&&c&&c.call(null,d)?d:previousSibling(d,c)}function previousTwin(a){return previousSibling(a,function(c){return c.tagName==a.tagName})}function siblings(a,c){return descendants(a.parentNode,function(d){return c.call(null,d)&&d!=a})}
function getDimensions(a){var c=getStyle(a,"display");if("none"!=c&&null!=c)return{width:a.offsetWidth,height:a.offsetHeight};var c=a.style,d=c.visibility,e=c.position,f=c.display;c.visibility="hidden";"fixed"!=e&&(c.position="absolute");c.display="block";var h=a.clientWidth,a=a.clientHeight;c.display=f;c.position=e;c.visibility=d;return{width:h,height:a}}function addClassName(a,c){a&&-1==a.className.indexOf(c)&&(a.className+=(a.className?" ":"")+c)}
function removeClassName(a,c){a&&-1!=a.className.indexOf(c)&&(a.className=a.className.replace(RegExp("(^|\\s+)"+c+"(\\s+|$)")," ").strip())}function hasClassName(a,c){return!a?!1:"string"==typeof a.className&&-1<a.className.indexOf(c)}function hide(a){a.style.display="none"}function show(a){a.style.display=""}
function parseDate(a){var c=/(\d\d\d\d)(-)?(\d\d)(-)?(\d\d)(T)?(\d\d)(:)?(\d\d)(:)?(\d\d)(\.\d+)?(Z|([+-])(\d\d)(:)?(\d\d))/;if(isIE8&&a.toString().match(RegExp(c))){var a=a.match(RegExp(c)),c=0,d=new Date;d.setUTCDate(1);d.setUTCFullYear(parseInt(a[1],10));d.setUTCMonth(parseInt(a[3],10)-1);d.setUTCDate(parseInt(a[5],10));d.setUTCHours(parseInt(a[7],10));d.setUTCMinutes(parseInt(a[9],10));d.setUTCSeconds(parseInt(a[11],10));a[12]?d.setUTCMilliseconds(1E3*parseFloat(a[12])):d.setUTCMilliseconds(0);
"Z"!=a[13]&&(c=60*a[15]+parseInt(a[17],10),c*="-"==a[14]?-1:1,d.setTime(d.getTime()-6E4*c));return d}return new Date(a)}Prototype.BrowserVersion={get:function(a){return this._search(navigator.userAgent,a)||this._search(navigator.appVersion,a)},_search:function(a,c){var d=a.indexOf(c);if(-1!=d)return parseFloat(a.substring(d+c.length+1))}};
Object.extend(Array.prototype,{insert:function(a,c){if(c>this.length)return this[this.length]=a,this.length-1;for(var d=this.length;d>c;d--)this[d]=this[d-1];this[c]=a;return c},remove:function(a){for(var c=0;c<this.length;c++)if(a.equals){if(a.equals(this[c]))break}else if(this[c]==a)break;if(c==this.length)return null;for(a=c;a<this.length-1;a++)this[a]=this[a+1];this.pop();return c},count:function(a){for(var c=0,d=this.length;0<d;)a(this[--d])&&c++;return c},sum:function(){for(var a=0,c=this.length;0<
c;)a+=this[--c];return a},diff:function(a,c){for(var d=[],e=0,f=this.length;e<f;e++){for(var h=this[e],i=!1,j=0,k=a.length;j<k;j++)if(c(h,a[j])){i=!0;break}i||d.push(h)}return d},uniqBy:function(a){for(var c=[],d=this.length,e=0;e<d;e++){for(var f=e+1;f<d;f++)a(this[e],this[f])&&(f=++e);c.push(this[e])}return c},equals:function(a){if(this.length!=a.length)return!1;for(var c=this.length,d=!1;0<c&&!d;)c--,this[c]!=a[c]&&(d=!0);return!d}});
Object.extend(String.prototype,{toBoolean:function(){switch(this.toString()){case "true":return!0;case "false":return!1;default:return null}},toLink:function(){return this.gsub(/https?:\/\/[^\s<]*/,function(a){return'<a href="'+a+'" target="new_page">'+a+"</a>"}).gsub(/(?:^|\s)www\.[^\s<]*/,function(a){return'<a href="http://'+a+'" target="new_page">'+a+"</a>"})},stripHTML:function(){return this.replace(/<(?:.|\s)*?>/g,"")},safeUnescapeHTML:function(){return this.split("\r").collect(function(a){return a.unescapeHTML()}).join("\r").gsub(/&quot;/,
'"')},parseRGB:function(a){var c="#"==this.charAt(0)?this.substr(1,6):this,d=c.match(/^(\w{2})(\w{2})(\w{2})$/);if(d)r=parseInt(d[1],16),g=parseInt(d[2],16),b=parseInt(d[3],16);else if(d=c.match(/^(\w{1})(\w{1})(\w{1})$/))r=parseInt(d[1]+d[1],16),g=parseInt(d[2]+d[2],16),b=parseInt(d[3]+d[3],16);else return null;return a?[r,g,b]:"rgb("+r+","+g+","+b+")"},tr:function(a){var c=i18n[this];if(!c)return this;if(a)if(0==Array.from(a).length)a=new Hash(a),a.keys().each(function(d){c=c.gsub("{"+d+"}",a.get(d))});
else{for(var d=c.split("%"),e=d[0],f=/^([ds])(.*)$/,h=1;h<d.length;h++){var i=f.exec(d[h]);i&&a[h-1]&&("d"==i[1]?e+=parseInt(a[h-1],10):"s"==i[1]&&(e+=a[h-1]),e+=i[2])}c=e}return"undefined"!=typeof ServerData&&ServerData.inlineTranslation?"<u id=translation_"+this+" class=js>"+c+"</u>":c},toDate:function(){switch(ServerData.user.date_format){case "%Y-%m-%D":var a=this.split("-"),a=a[1]+"/"+a[2]+"/"+a[0];return a.toString();case "%m/%D/%Y":return this.toString();case "%D.%m.%Y":return a=this.split("."),
a=a[1]+"/"+a[0]+"/"+a[2],a.toString();case "%D-%m-%Y":return a=this.split("-"),a=a[1]+"/"+a[0]+"/"+a[2],a.toString();default:return this.toString()}}});String.naturalCompare=function(a,c){function d(a){for(var c=[],d=0,e=-1,f=0,h,i;h=(i=a.charAt(d++)).charCodeAt(0);)h=46==h||48<=h&&57>=h,h!==f&&(c[++e]="",f=h),c[e]+=i;return c}var e=d(a),f=d(c);for(x=0;e[x]&&f[x];x++)if(e[x]!==f[x]){var h=Number(e[x]),i=Number(f[x]);return h==e[x]&&i==f[x]?h-i:e[x]>f[x]?1:-1}return e.length-f.length};
Object.extend(Form,{defaultHint:function(a){a=$(a);a._default=a.value;return a.observe("focus",function(){a._default==a.value&&(a.removeClassName("inactive").value="")}).observe("blur",function(){""==a.value.strip()&&(a.addClassName("inactive").value=a._default)}).addClassName("inactive")},clearHints:function(a){a=$(a);a.getElements().each(function(a){a._default==a.value&&(a.value="");a.removeClassName("inactive")})},getRadioSelectValue:function(a,c,d){"string"==typeof a&&(a=document.forms[a]);a=
a.elements[c];if(void 0==a.length)return a.checked?a.value:"";for(c=0;c<a.length;c++)if(a[c].checked)if("radio_image_format"==a[c].id){if(_(d))return _(d).value;break}else return a[c].value;return""}});Object.extend(Position,{withinExtended:function(a,c,d,e,f){var h=Element.cumulativeOffset(a),c=c+e,d=d+f;return d>=h[1]&&d<h[1]+a.offsetHeight+f&&c>=h[0]&&c<h[0]+a.offsetWidth+e}});
Object.extend(Event,{wheel:function(a){var c=0;a||(a=window.event);a.wheelDelta?(c=a.wheelDelta/120,window.opera&&(c=-c)):a.detail&&(c=-a.detail/3);return 0<c?Math.ceil(c):Math.floor(c)},observeOnce:function(a,c,d){var e=function(){Event.stopObserving(a,c,e);d.apply(a,arguments)};Event.observe(a,c,e);return a},getTouchsafeCoordinates:function(a){return useTouchEvents?[a.targetTouches[0].clientX,a.targetTouches[0].clientY]:[a.clientX,a.clientY]}});
Object.extend(Date.prototype,{strftime:function(a){function c(a){return a.toPaddedString(2)}var d=this.getDay(),e=this.getMonth(),f=this.getHours(),h=this.getMinutes();return a.gsub(/\%([aAbBcdDHiImMpSwyY])/,function(a){switch(a[1]){case "a":return["js_sunday_short".tr(),"js_monday_short".tr(),"js_tuesday_short".tr(),"js_wednesday_short".tr(),"js_thursday_short".tr(),"js_friday_short".tr(),"js_saturday_short".tr()][d];case "A":return["js_sunday".tr(),"js_monday".tr(),"js_tuesday".tr(),"js_wednesday".tr(),
"js_thursday".tr(),"js_friday".tr(),"js_saturday".tr()][d];case "b":return["js_january_short".tr(),"js_february_short".tr(),"js_march_short".tr(),"js_april_short".tr(),"js_may".tr(),"js_june_short".tr(),"js_july_short".tr(),"js_august_short".tr(),"js_september_short".tr(),"js_october_short".tr(),"js_november_short".tr(),"js_december_short".tr()][e];case "B":return["js_january".tr(),"js_february".tr(),"js_march".tr(),"js_april".tr(),"js_may".tr(),"js_june".tr(),"js_july".tr(),"js_august".tr(),"js_september".tr(),
"js_october".tr(),"js_november".tr(),"js_december".tr()][e];case "c":return this.toString();case "d":return this.getUTCDate();case "D":return c(this.getUTCDate());case "H":return c(f);case "i":return 12===f||0===f?12:(f+12)%12;case "I":return c(12===f||0===f?12:(f+12)%12);case "m":return c(e+1);case "M":return c(h);case "p":return 11<f?"PM":"AM";case "S":return c(this.getUTCSeconds());case "w":return d;case "y":return c(this.getUTCFullYear()%100);case "Y":return this.getUTCFullYear().toString()}}.bind(this))},
toUIString:function(a){var c=ServerData.user.date_format;a||(c+=0==ServerData.user.hour_format?" %i:%M %p":" %H:%M");return this.strftime(c)},ago:function(){var a=Math.round((new Date-this)/1E3/60);if(1>a)return"just now";if(1==a)return"1 minute ago";if(2<=a&&45>=a)return a+" minutes ago";if(46<=a&&90>=a)return"about one hour ago";if(91<=a&&1440>=a)return Math.round(a/60)+" hours ago";if(1441<=a&&2880>=a)return"about one day ago";if(2881<=a&&10080>=a)return Math.round(a/1440)+" days ago";if(10081<=
a&&20160>=a)return"about one week ago";if(20161<=a&&43200>=a)return Math.round(a/10080)+" weeks ago";if(43201<=a)return Math.round(a/43200)+" months ago"}});Date.fromUTC=function(a){a=new Date(a);return new Date(a-6E4*a.getTimezoneOffset())};Date.toUTC=function(a){a=new Date(a);return new Date(a.getTime()+6E4*a.getTimezoneOffset())};
Object.extend(Number.prototype,{between:function(a){return a.include(this)},toHumanSize:function(a){return 1024>this?this+" Bytes":1048100>this?Math.round(this/1024,a)+" KB":Math.round(this/1048576,a)+" MB"},formatMoney:function(a,c,d){var e=this,a=isNaN(a=Math.abs(a))?2:a,c=void 0==c?",":c,d=void 0==d?".":d,f=0>e?"-":"",h=parseInt(e=Math.abs(+e||0).toFixed(a))+"",i=3<(i=h.length)?i%3:0;return f+(i?h.substr(0,i)+d:"")+h.substr(i).replace(/(\d{3})(?=\d)/g,"$1"+d)+(a?c+Math.abs(e-h).toFixed(a).slice(2):
"")}});String.prototype.toCamel=function(){return this.replace(/(\-[a-z])/g,function(a){return a.toUpperCase().replace("-","")})};String.prototype.toDash=function(){return this.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})};Element.Methods.getOffsetParent=function(a){if(!isIE&&a.offsetParent)return $(a.offsetParent);if(a==document.body||"HTML"==a.tagName)return $(a);for(;(a=a.parentNode)&&a!=document.body;)if("static"!=Element.getStyle(a,"position"))return $(a);return $(document.body)};
Element.Methods.removeStyle=function(a,c){["Webkit","Moz","O","ms","Khtml"].each(function(a){c.match(a)&&(c=c.toDash())});if(a=$(a))if(isIE){var d=a.getAttribute("style");if(d){a.removeAttribute("style");for(var d=d.split(/;\s*/),e=0,f=d.length;e<f;e++)RegExp(c+":","i").test(d[e])&&(d[e]="");a.setAttribute("style",d.join("; "))}}else a.style.removeProperty(c)};
Element.Methods.toRectangle=function(a,c){a=$(a);if(!a)return null;var c=c||0,d=a.cumulativeOffset(),e=[a.clientWidth,a.clientHeight],f=new Point(d[0]-c,d[1]-c),d=new Point(d[0]+e[0]+c,d[1]+e[1]+c);return new Rectangle(f,d)};
Element.addMethods({moveTo:function(a,c){a.style.left=c[0]+"px";a.style.top=c[1]+"px"},moveToElement:function(a,c,d){c=canvas.getElementOffset(c);c[0]+=d[0];c[1]+=d[1];Element.moveTo(a,c);return c},bindOnClick:function(a,c,d,e){var f="string"==typeof a?_(a):a;f&&(f.onclick=isIE?function(){if(hasClassName(f,"disabled"))return!1;c(event);e&&Event.stop(event);return!!d}:function(a){if(hasClassName(f,"disabled"))return!1;c(a);e&&Event.stop(a);return!!d})},bindOnHover:function(a,c,d){("string"==typeof a?
_(a):a).onmouseover=function(){c();return!!d}},bindOnUnhover:function(a,c,d){("string"==typeof a?_(a):a).onmouseout=function(){c();return!!d}},bindOnClickNoBubble:function(a,c){this.bindOnClick(a,c,!1,!0)},safeSelect:function(a,c){if(!isIE)return $(a).down("."+c);for(var d=$(a).childNodes,e=0,f=d.length;e<f;e++)if(d[e].className==c)return $(d[e])}});
Element.discard=function(a){var c=_("IELeakGarbageBin");c||(c=new Element("div",{id:"IELeakGarbageBin"}),c.style.display="none",document.body.appendChild(c));c.appendChild(a);c.innerHTML=""};
Object.keys=Object.keys||function(){var a=Object.prototype.hasOwnProperty,c=!{toString:null}.propertyIsEnumerable("toString"),d="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),e=d.length;return function(f){if("object"!=typeof f&&"function"!=typeof f||null===f)throw new TypeError("Object.keys called on a non-object");var h=[],i;for(i in f)a.call(f,i)&&h.push(i);if(c)for(i=0;i<e;i++)a.call(f,d[i])&&h.push(d[i]);return h}}();
Effect.Scroll=Class.create();
Object.extend(Object.extend(Effect.Scroll.prototype,Effect.Base.prototype),{initialize:function(a,b){this.element=$(a);var c=Object.extend({x:0,y:0,mode:"absolute"},b||{});this.start(c)},setup:function(){this.options.continuous&&!this.element._ext&&(this.element.cleanWhitespace(),this.element._ext=!0,this.element.appendChild(this.element.firstChild));this.originalLeft=this.element.scrollLeft;this.originalTop=this.element.scrollTop;"absolute"==this.options.mode&&(this.options.x-=this.originalLeft,
this.options.y-=this.originalTop)},update:function(a){this.element.scrollLeft=this.options.x*a+this.originalLeft;this.element.scrollTop=this.options.y*a+this.originalTop}});
var CSS_PREFIXES={filter:Prototype.Browser.WebKit?"WebkitFilter":"MozFilter"},CSS={prefix:function(){var a=document.createElement("dummy").style,b=["Webkit","Moz","O","ms","Khtml"],c=CSS_PREFIXES;return function(d){if("undefined"===typeof c[d]){var e=d.charAt(0).toUpperCase()+d.substr(1),e=(d+" "+b.join(e+" ")+e).split(" ");c[d]=null;for(var f in e)if(void 0!==a[e[f]]){c[d]=e[f];break}}return c[d]}}(),set:function(a,b){var c,d;for(c in b)b.hasOwnProperty(c)&&(d=CSS.prefix(c),null!==d&&(a.style[d]=
b[c]));return a},remove:function(a,b){var c;b.each(function(b){c=CSS.prefix(b);a.removeStyle(c)});return a},translate:function(a,b){return b?" translate3d("+a.x+"px,"+a.y+"px,"+a.z+"px) ":" translate("+a.x+"px,"+a.y+"px) "},rotate:function(a,b,c){var d=" rotateX("+a.x+"deg) ",e=" rotateY("+a.y+"deg) ",a=" rotateZ("+a.z+"deg) ";c||(a="");return b?a+e+d:d+e+a},scale:function(a){return" scale("+a+") "},perspective:function(a,b){return b?" perspective("+a+"px) ":""},visible:function(a){return"none"!=
$(a).style.display&&"0"!=$(a).style.opacity},Effect:{Appear:function(a,b){if(Modernizr.csstransitions)$(a).setStyle({display:"block",opacity:1});else return new Effect.Appear(a,b)},Fade:function(a,b){if(Modernizr.csstransitions)$(a).setStyle({opacity:0});else return new Effect.Fade(a,b)},BlindUp:function(a,b){if(Modernizr.csstransitions)CSS.set(a,{transform:"scaleY(0)"}),setTimeout(function(){a.hide()},500);else return new Effect.BlindUp(a,b)},Morph:function(a,b){b=b||{};if(Modernizr.csstransitions)CSS.set(a,
Object.extend(b.style,{transition:"all "+(b.duration||"0.5")+"s ease-in-out"}));else return new Effect.Morph(a,b)}}};
window.name||(window.name="mindmeister");
var cache={},isFF="Firefox"==navigator.userAgent.match(/Firefox/),isSF="Safari"==navigator.userAgent.match(/Safari/)&&!isCH,isOP="Opera"==navigator.userAgent.match(/Opera/),isCH="Chrome"==navigator.userAgent.match(/Chrome/),isIE="MSIE"==navigator.appVersion.match(/MSIE/),isIE8="MSIE 8.0"==navigator.appVersion.match(/MSIE 8.0/),isMac="Macintosh"==navigator.appVersion.match(/Macintosh/),isWin="Windows"==navigator.appVersion.match(/Windows/),isWebKit=isCH||isSF,isLinux="Linux"==navigator.userAgent.match(/Linux/),
isIPhone="iPhone"==navigator.appVersion.match(/iPhone/),isIPad="iPad"==navigator.appVersion.match(/iPad/),isAndroid="Android"==navigator.appVersion.match(/Android/),isIOSDevice=isIPhone||isIPad,isRetina="devicePixelRatio"in window&&1<window.devicePixelRatio,useTouchEvents=isIOSDevice,hasFlash=navigator.mimeTypes["application/x-shockwave-flash"],hasInvisibleScrollbars=function(){return isSF&&10.7<=Prototype.BrowserVersion._search(navigator.userAgent.replace(/_/g,"."),"Mac OS X")};
Object.extend(i18n,{js_lang_en:"English",js_lang_de:"Deutsch",js_lang_da:"Dansk",js_lang_fr:"Fran\u00e7ais",js_lang_es:"Espa\u00f1ol",js_lang_pt:"Portugu\u00eas",js_lang_nl:"Nederlands",js_lang_ru:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439",js_lang_ja:"\u65e5\u672c\u8a9e"});
var MM={plugins:{}};
MM.debug={on:!1,log:function(a){if(MM.debug.on)if(isFF&&"undefined"!=typeof console)console.log(a);else if("Safari"==navigator.userAgent.match(/Safari/)&&window.console)window.console.log(a);else{if(!_("ie_console")){var b=(new Element("div",{id:"ie_console"})).setStyle({position:"absolute",top:"10px",left:"10px",width:"340px",height:"100px",zIndex:"9999",backgroundColor:"#ffc",padding:"5px",fontSize:"11px",lineHeight:"11px",overflowY:"scroll"});document.body.appendChild(b)}_("ie_console").innerHTML+=
a+"<br/>"}},profile:function(a,b){MM.debug.on&&("undefined"!=typeof console&&console.profile?b?console.profileEnd(a):console.profile(a):b?d((new Date).getTime()-ieTime+" ms"):ieTime=(new Date).getTime())}};var d=MM.debug.log;"www.mindmeister.com"==window.location.hostname&&("undefined"!=typeof console&&"function"==typeof console.log)&&console.log("Inspecting web pages, huh? At MindMeister we're looking for people like you, to join us as web developers (JavaScript, CSS, ideally also Ruby on Rails) in Munich or Vienna. If you're interested please contact jobs@mindmeister.com!");
window.diagnostics=function(){MM.ui.dialogs.show("diagnostics",{map_id:tree.root.id})};
MM.error={MapInitErrorMsg:"js_this_map_cant_be_initialized".tr()+".\n"+"js_event_logged_and_error_will_be_corected".tr()+"\n",ResponseNotMatching:function(){},stackTrace:function(){try{throw Error("ForcedException");}catch(a){return a.stack||a.description}},reportException:function(a,b,d,f,c){var e="",g=a?a.stack||a.description:this.stackTrace();b&&(e+=b);a&&(e+=(a.name?a.name.escapeHTML():"")+" - "+a.message);ServerConnection.other.logException({message:e,backtrace:g,details:d});f&&alert(f);c&&setTimeout(c,
500);App.debugMode&&alert(b)},reportMapException:function(a,b,d,f,c){App.config.shareMode=null;c=Object.toJSON(_mm_file_versions)+"\n---\n"+App.requestLog.join()+"\n---\n"+Object.toJSON(c);this.reportException(a,b,c,d,f)},reportCriticalMapException:function(a,b){ServerConnection.forcedPageReload=!0;var d="!!!User feedback: "+prompt("js_crash_feedback".tr(),"")+"\n---\n"+App.requestLog.join();this.reportException(a,"RELOAD - "+b,d,null,MM.utils.reloadPage)}};
MM.status={isOffline:function(){return"undefined"!=typeof Offline&&Offline.getGlobalStatus()},allowAction:function(){return!this.isOffline()||Offline.utils.allowAction()},params:window.location.href.toQueryParams(),helpTopic:"/overview"};
MM.onload={FB:[],onload:function(){if(!MM.onload.done){MM.onload.done=!0;for(var a=0,b=MM.onload.f.length;a<b;a++)MM.onload.f[a]()}},add:function(){for(var a=arguments,b=0,c=a.length;b<c;b++)if("function"===typeof a[b])if(MM.onload.done)a[b]();else MM.onload.f.push(a[b])},listen:function(){if(/WebKit|khtml/i.test(navigator.userAgent))MM.onload.timer=setInterval(function(){/loaded|complete/.test(document.readyState)&&(clearInterval(MM.onload.timer),delete MM.onload.timer,MM.onload.onload())},10);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",
MM.onload.onload,!1);else if(!MM.onload.iew32)if(window.addEventListener)window.addEventListener("load",MM.onload.onload,!1);else if(window.attachEvent)return window.attachEvent("onload",MM.onload.onload)},offline:function(){window.localStorage&&("1"==window.localStorage.getItem("status")&&"/home/off_index/"!=window.location.pathname&&"/maps/show_offline/"!=window.location.pathname&&"/offline.html"!=window.location.pathname?window.location.href="/home/off_index/":"2"==window.localStorage.getItem("status")&&
("/home/off_clean/"!=window.location.pathname&&window.location.href!=window.location.origin+"/home/off_index/?redirect=true"&&window.location.href!=window.location.origin+"/home/off_index/?id=go_online")&&(window.location="https:"==window.location.protocol?"http://"+window.location.hostname+"/home/off_index/":"https://"+window.location.hostname+"/home/off_index/"))},f:[],done:!1,timer:null,iew32:!1};MM.onload.listen();
MM.utils={empty:function(){},getSiteURL:function(){return location.protocol+"//"+document.domain+(location.port?":"+location.port:"")},reloadPage:function(){window.location.reload()},redirectTo:function(a){window.location=a},setCookie:function(a,b,d){var c=new Date;c.setTime(c.getTime()+864E5*(d||1));document.cookie=a+"="+escape(b)+"; expires="+c.toUTCString()},getCookie:function(a){a=RegExp(a+"=([^;]*);?","gi").exec(document.cookie)||[];return 1<a.length?unescape(a[1]):null},deleteCookie:function(a){MM.utils.setCookie(a,
"",-1)},getClientLocation:function(a){new Ajax.Request("/home/get_location/",{asynchronous:!0,evalScripts:!0,onComplete:function(b){b=b.responseText.evalJSON();if(b.error)a({country:null,city:null,region:null,latitude:null,longitude:null});else{var d=b.countryName&&"Unknown"!=b.countryName?b.countryName.toLowerCase().capitalize():null,c=b.cityName&&"Unknown"!=b.cityName?b.cityName.toLowerCase().capitalize():null,e=b.regionName&&"Unknown"!=b.regionName?b.regionName.toLowerCase().capitalize():null;
a({country:d,city:c,region:e,latitude:b.cityLatitude,longitude:b.cityLongitude})}}})},setClientLocation:function(a){"undefined"==typeof a?MM.utils.getClientLocation(MM.utils.setClientLocation):(a.latitude&&a.longitude&&MM.utils.setCookie("user_location",a.latitude+","+a.longitude,365),a.country&&MM.utils.setCookie("user_country",a.country,365))},addCacheBuster:function(a){"undefined"!=typeof App&&"development"==App.config.environment?a=a+"?"+(new Date).getTime():"undefined"!=typeof ServerData&&(a=
a+"?"+ServerData.cacheBuster);return a},loadScript:function(a,b,d){var c=a.split("/").last();if(document.getElementById(c))b&&b();else{0==a.indexOf("/")&&(a=MM.utils.addCacheBuster(a),MM.utils.getCookie("debug_js")&&"true"==MM.utils.getCookie("debug_js")&&(["tiny_mce"].find(function(b){return 0<=a.indexOf(b)})||(a=a.replace(".js","-nonobfuscated.js"))));var e=document.createElement("script");e.setAttribute("id",c);e.setAttribute("type","text/javascript");e.setAttribute("src",a);document.getElementsByTagName("head")[0].appendChild(e);
if(b){if(isSF)if(d)var f=setInterval(function(){var a=!1;try{a=d.call()}catch(c){}a&&(clearInterval(f),b.call())},100);else e.observe("load",b);else isIE?e.onreadystatechange=d?function(){if("complete"==this.readyState||"loaded"==this.readyState)var a=setInterval(function(){var c=!1;try{c=d.call()}catch(e){}c&&(clearInterval(a),b.call())},100)}:function(){("complete"==this.readyState||"loaded"==this.readyState)&&b()}:e.onload=function(){b()};!isOP&&!isIE&&(e.onreadystatechange=function(){("complete"==
this.readyState||"loaded"==this.readyState)&&b()})}}},loadCSS:function(a){a.each(function(a){var d=a.split("/").last();if(!_(d)){var c=document.createElement("link");c.setAttribute("type","text/css");c.setAttribute("rel","stylesheet");c.setAttribute("id",d);a=MM.utils.addCacheBuster(a);c.setAttribute("href",a);c.setAttribute("media","screen");document.getElementsByTagName("head")[0].appendChild(c)}})},loadSWF:function(a,b,d,c,e){var f="",a=window.location.protocol+"//"+window.location.host+"/resources/"+
a+".swf";if(isIE)var g=location.href.match(/^https/i)?"https://":"http://",f=f+('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+g+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+c+'" height="'+e+'" id="'+b+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+a+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+
d+'"/><param name="wmode" value="transparent"/></object>');else f+='<embed id="'+b+'" src="'+a+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+c+'" height="'+e+'" name="'+b+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+d+'" wmode="transparent" />';return f},badBrowser:function(){return MM.utils.reallyBadBrowser()||!isFF&&!isSF&&!isCH&&!isIE||3.6>
Prototype.BrowserVersion.get("Firefox")||533>Prototype.BrowserVersion.get("Safari")},reallyBadBrowser:function(){return 8>parseInt(Prototype.BrowserVersion.get("MSIE"))&&"chromeframe"!=navigator.appVersion.toLowerCase().match(/chromeframe/)},mobileBadBrowser:function(){return isAndroid&&Prototype.BrowserVersion.get("AppleWebKit")?"Firefox for Android":!1},ieCompatibilityView:function(){return MM.utils.reallyBadBrowser()&&3<Prototype.BrowserVersion.get("Trident")},hasFlash:function(){return null!=
navigator.plugins&&0<navigator.plugins.length&&(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"])?!0:!1},loginCheck:function(){""==document.signin.login.value?Element.addClassName("username","username_bg_image"):_("username").style.backgroundImage="none";""==document.signin.password.value?Element.addClassName("password","password_bg_image"):_("password").style.backgroundImage="none"},loginClear:function(a){_("canvas")&&canvas&&canvas.removeFocus();_(a).style.backgroundImage=
"none"},urlFor:function(a){"object"==typeof a&&(a=a.controller+"/"+a.action+(a.id?"/"+a.id:""));return!ServerData.user.logged_in&&"en"!=ServerData.user.language&&0!=a.indexOf("/"+ServerData.user.language+"/")?"/"+ServerData.user.language+a:a},getLocalURL:function(a){return App.config.is_remote&&SiteURLSecure?SiteURLSecure+a:a},getLocalCssURL:function(a){return"url("+this.getLocalURL(a)+")"},supportsOffline:function(){return(isSF||isCH)&&window.openDatabase&&window.localStorage&&window.applicationCache},
validateEmail:function(a){return/^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i.test(a)},highlightText:function(a,b){return a.replace(RegExp(b,"gi"),function(a){return"<em>"+a+"</em>"})},preloadImages:function(a,b,d){for(var c=[],e=0;e<a.length;e++)c[e]=new Image,c[e].src=(b?b:"")+a[e]+(d?"":"?"+ServerData.cacheBuster)},loadPipe:function(a,b,d){var c=document.createElement("script");c.src="https:"==window.location.protocol?"/dialog/auto_link_proxy?_id="+a+"&_render=json&_callback="+b+"&"+Hash.toQueryString(d):
"http://pipes.yahooapis.com/pipes/pipe.run?_id="+a+"&_render=json&_callback="+b+"&"+Hash.toQueryString(d);document.body.appendChild(c);return c},sendPublicMapShare:function(a){var b=_("forward_message").value||"",d=_("forward_to").value||"",c=_("forward_from").value||"",e=_("forward_subject").value||"";new Ajax.Request("/dialog/share_public/"+a+"?message="+b+"&invitees="+d+"&from="+c+"&subject="+e,{asynchronous:!0,evalScripts:!0})},loadYQL:function(a,b,d){var c=document.createElement("script");c.src=
window.location.protocol+"//query.yahooapis.com/v1/public/yql?q="+a+"&diagnostics=false&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&format=json&callback="+b+"&"+Hash.toQueryString(d);document.body.appendChild(c);return c},trackEvent:function(a){"undefined"!=typeof _gaq&&(a.unshift("_trackEvent"),_gaq.push(a))},_authenticate:function(){var a=_("user_email").value;_("_authenticity_token").value=MM.utils.SHA1.translate(a)}};
MM.utils.KeyMap=function(b,a,c,d){this.el=$(b);this.id=a;this.eventName=d||"keydown";this.bindings=[];this._usefulKeys=[];c&&this.addBinding(c);this._listener=(isOP?this.handleKeyDownHacked:this.handleKeyDown).bindAsEventListener(this);this.enable()};
MM.utils.KeyMap.prototype={stopEvent:!0,addBinding:function(b){if(Object.isArray(b))for(var a=0,c=b.length;a<c;a++)this.addBinding(b[a]);else{var d=b.key,e=b.shift,f=b.notShift,g=b.ctrl,k=b.notCtrl,l=b.alt,i=b.fn||b.handler,j=b.scope,m=b.withEvent;if("string"==typeof d){for(var b=[],a=d.toUpperCase(),h=0,c=a.length;h<c;h++)b.push(a.charCodeAt(h));d=b}var n=Object.isArray(d);n?this.addUsefulKeys(d.collect(function(a){return{code:a,shift:e,notShift:f,ctrl:g,notCtrl:k,alt:l}})):this.addUsefulKeys({code:d,
shift:e,notShift:f,ctrl:g,notCtrl:k,alt:l});this.bindings.push(function(a){if(!(e&&!a.shiftKey||f&&a.shiftKey||g&&!a.ctrlKey||k&&a.ctrlKey||l&&!a.altKey)){var b=a.getKey();if(n)for(var c=0,h=d.length;c<h;c++){if(d[c]==b){this.stopEvent&&a.stopEvent();m?i.call(j||window,a):i.call(j||window);break}}else b==d&&(this.stopEvent&&a.stopEvent(),m?i.call(j||window,a):i.call(j||window))}})}},addUsefulKeys:function(b){this._usefulKeys=this._usefulKeys.concat(b)},isUsefulEvent:function(b){var a=b.getKey();return this._usefulKeys.any(function(c){return a==
c.code&&!!c.alt==!!b.altKey&&!!c.shift==!!b.shiftKey&&!!c.ctrl==!!b.ctrlKey&&(c.notShift?!b.shiftKey:!0)&&(c.notCtrl?!b.ctrlKey:!0)})},on:function(b,a,c){var d,e,f,g;"object"==typeof b&&!Object.isArray(b)?(d=b.key,e=b.shift,f=b.ctrl,g=b.alt):d=b;this.addBinding({key:d,shift:e,notShift:b.notShift,ctrl:f,notCtrl:b.notCtrl,alt:g,fn:a,scope:c})},handleKeyDown:function(b){b=MM.utils.KeyEvent.setEvent(b);if(this.enabled)for(var a=this.bindings,c=0,d=a.length;c<d;c++)a[c].call(this,b)},handleKeyDownHacked:function(b){var a=
0,c=function(b){0==a&&this.handleKeyDown.call(this,b);this.isUsefulEvent(MM.utils.KeyEvent.setEvent(b))&&b.stop();a++}.bind(this);c(b);var d=this;this.el.observe("keyup",function(a){d.el.stopObserving("keypress",c,!0);d.el.stopObserving("keyup",arguments.callee,!0);a.stop()},!0);this.el.observe("keypress",c,!0)},isEnabled:function(){return this.enabled},enable:function(){this.enabled||(this.el.observe("keydown",this._listener),this.enabled=!0)},disable:function(){this.enabled&&(this.el.stopObserving("keydown",
this._listener),this.enabled=!1)}};
MM.utils.KeyEvent=function(){var b={63234:37,63235:39,63232:38,63233:40,63276:33,63277:34,63272:46,63273:36,63275:35,63237:113,63243:119};MM.utils.KeyEventImpl=function(a){a&&this.setEvent(a.browserEvent||a)};MM.utils.KeyEventImpl.prototype={browserEvent:null,button:-1,shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1,BACKSPACE:8,TAB:9,RETURN:13,ENTER:13,SHIFT:16,CONTROL:17,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,F1:112,F2:113,F5:116,F6:117,
F8:119,F9:120,F10:121,PLUS:[43,61,107,171,187],MINUS:[95,109,173,189],NINE_FIX:[57,221],setEvent:function(a){if(a==this||a&&a.browserEvent)return a;this.browserEvent=a;this.type=a.type;this.shiftKey=a.shiftKey;this.ctrlKey=a.ctrlKey||a.metaKey;this.altKey=a.altKey;this.metaKey=a.metaKey;this.keyCode=a.keyCode;this.charCode=a.charCode;this.target=a.element();return this},stopEvent:function(){this.browserEvent&&this.browserEvent.stop()},isNavKeyPress:function(){var a=this.keyCode,a=Prototype.Browser.WebKit?
b[a]||a:a;return 33<=a&&40>=a||a==this.RETURN||a==this.TAB||a==this.ESC},isSpecialKey:function(){var a=this.keyCode;return"keypress"==this.type&&this.ctrlKey||9==a||13==a||40==a||27==a||16==a||17==a||18<=a&&20>=a||33<=a&&35>=a||36<=a&&39>=a||44<=a&&45>=a},getCharCode:function(){return this.charCode||this.keyCode},getKey:function(){var a=this.keyCode||this.charCode;return Prototype.Browser.WebKit?b[a]||a:a},hasModifier:function(){return this.ctrlKey||this.altKey||this.shiftKey?!0:!1}};return new MM.utils.KeyEventImpl}();
MM.utils.File={upload:function(a,c,b){var b=Object.extend({file_type:"file"},b),e=a.type&&""!=a.type?a.type:"application/octet-stream",d=new XMLHttpRequest;d.open("POST",c);if(isFF)if(b=Object.extend({content_type:e,file_name:a.name},b),a.getAsBinary)MM.utils.File.sendRequest(d,a.getAsBinary(),b);else{var f=new FileReader;f.readAsBinaryString(a);f.onloadend=function(){MM.utils.File.sendRequest(d,f.result,b)}}else d.setRequestHeader("X-File-Name",a.name),d.setRequestHeader("X-File-Size",a.fileSize),
d.setRequestHeader("X-File-Type",e),d.setRequestHeader("Content-Type","application/octet-stream"),d.onreadystatechange=function(){if(4==d.readyState)if(b.onSuccess)b.onSuccess(d);else Prototype.emptyFunction()},d.send(a)},sendRequest:function(a,c,b){var e="------multipartformboundary"+(new Date).getTime(),d;d="--"+e+"\r\n"+('content-disposition: form-data; name="'+b.file_type+'"');d+='; filename="'+encodeURIComponent(b.file_name)+'"';d+="\r\ncontent-type: "+b.content_type+"\r\n";d+="\r\n";d+=c;d+=
"\r\n--"+e+"--\r\n";a.setRequestHeader("content-type","multipart/form-data; boundary="+e);a.onload=b.onSuccess?function(){b.onSuccess(a)}.bind(null):Prototype.emptyFunction;a.sendAsBinary(d)}};
MM.utils.File.Droppables={drops:[],get:function(a){return this.drops.find(function(c){return c.element.id==a})},remove:function(a){this.drops=this.drops.reject(function(c){return c.element.id==a})},add:function(a,c){var b=$(a);if(!this.drops.find(function(a){return a.element==b})){var e=Object.extend({hoverclass:null,tree:!1,enabled:!1},c||{});e.element=b;this.drops.push(e)}},deactivate:function(a,c){var b=c.target;a.getElement&&(b=a.getElement(b));a.hoverclass&&b&&Element.removeClassName(b,a.hoverclass)},
activate:function(a,c){var b=c.target;a.getElement&&(b=a.getElement(b));a.hoverclass&&b&&Element.addClassName(b,a.hoverclass);c.preventDefault()},onDrop:function(a,c){c.stopPropagation();c.preventDefault();this.last_active&&a.hoverclass&&Element.removeClassName(this.last_active,a.hoverclass);var b=new MM.utils.File.DataTransfer(c.dataTransfer);if(a.onDrop)a.onDrop(c.target,b);this.deactivate(a,c)},enable:function(a){a.enabled||(a.activateListener||(a.activateListener=this.activate.bind(this,a)),a.deactivateListener||
(a.deactivateListener=this.deactivate.bind(this,a)),a.dropListener||(a.dropListener=this.onDrop.bind(this,a)),Element.observe(a.element,"dragenter",a.activateListener),Element.observe(a.element,"dragleave",a.deactivateListener),Element.observe(a.element,"dragover",a.activateListener),Element.observe(a.element,"drop",a.dropListener),a.enabled=!0)},disable:function(a){a.enabled&&(Element.stopObserving(a.element,"dragenter",a.activateListener),Element.stopObserving(a.element,"dragleave",a.deactivateListener),
Element.stopObserving(a.element,"dragover",a.activateListener),Element.stopObserving(a.element,"drop",a.dropListener),a.enabled=!1)}};
MM.utils.File.DataTransfer=Class.create({imageTypes:"jpeg jpg gif png bmp tiff".split(" "),data:null,initialize:function(a){this.data=a;this.files=[];this.images=[];this.links=[];this.imageLinks=[];if(a.files&&0<a.files.length)for(var c=a.files,b=0,e=c.length;b<e;b++){var d=c[b];0<d.size&&(d.type.match(/^image/g)?this.images.push(d):this.files.push(d))}if(this.hasType("text/uri-list")||this.hasType("text/x-moz-url"))c=a.getData("URL")||a.getData("text/x-moz-url"),this.links.push(c);this.hasType("text/html")&&
((c=/href=\"([^\"]*)\"/.exec(a.getData("text/html")))&&this.links.push(c[1]),(c=/src=\"([^\"]*)\"/.exec(a.getData("text/html")))&&RegExp("("+this.imageTypes.join("|")+")$").test(c[1])&&this.imageLinks.push(c[1]))},hasType:function(a){return this.data.types.contains&&this.data.types.contains(a)||this.data.types.include&&this.data.types.include(a)}});
MM.utils.payments={showPrice:function(a,c,b,d){c||(c="United States");b=_(b);a=Object.extend({months:1,plan:a,"billing[country]":c},d);new Ajax.Request("/payments/payment_total_price_remote",{asynchronous:!0,parameters:a,onSuccess:function(a){a=a.responseText.evalJSON();b.innerHTML=a.price_html;show(b)}})}};
MM.utils.Url={getHashParams:function(){var a=window.location.hash,a=a.replace("#","");return a.toQueryParams()},toHashParams:function(a){typeof a!=Hash&&(a=new Hash(a));return a.toQueryString()},add:function(a,b){var c=this.getHashParams();c[a]=b;window.location.hash=this.toHashParams(c)},remove:function(a){var b=this.getHashParams();delete b[a];window.location.hash=this.toHashParams(b)}};
MM.utils.mapLocation={current:null,setLoc:function(a){MM.utils.mapLocation.current!=a&&(MM.utils.mapLocation.reset(),MM.utils.Url.add(a),MM.utils.mapLocation.current=a)},getLoc:function(){return MM.utils.mapLocation.current},reset:function(){MM.utils.mapLocation.current&&MM.utils.Url.remove(MM.utils.mapLocation.current);MM.utils.mapLocation.current=null}};
MM.ui={page:document.viewport.getDimensions(),onLoad:function(){Event.observe(window,"resize",MM.ui.onResize);MM.ui.pageTitle=document.title;MM.ui.onResize();MM.ui.retinize()},onResize:function(){MM.ui.page=document.viewport.getDimensions();0==MM.ui.page.width&&0==MM.ui.page.height&&(MM.ui.page={width:parseInt(MM.status.params.width)||800,height:parseInt(MM.status.params.height)||600});590>MM.ui.page.height?addClassName(document.body,"b-small"):removeClassName(document.body,"b-small")},retinize:function(){windowHasLoaded=
!0;if((isRetina||MM.status.params.retina)&&!MM.utils.getCookie("retina"))MM.utils.setCookie("retina",1,99),MM.utils.loadScript("/javascripts/tools/image_replacer.js")},getScrollBarWidth:function(a){document.body.style.overflow="hidden";var b=document.body.clientWidth;document.body.style.overflow="scroll";(b-=document.body.clientWidth)||(b=document.body.offsetWidth-document.body.clientWidth);document.body.style.overflow=a||"";return Math.max(b,10)},fieldEnable:function(){for(var a=$A(arguments),b=
a.length;0<b;)_(a[--b]).disabled=!1,Element.removeClassName(a[b],"disabled")},fieldDisable:function(){for(var a=$A(arguments),b=a.length;0<b;)_(a[--b]).disabled=!0,Element.addClassName(a[b],"disabled")},disableButton:function(){for(var a=0,b=arguments.length;a<b;a++){var c=_(arguments[a]);c&&(c.disabled=!0,c.href&&(c.href_old=c.href,c.href="#"),c.onclick&&(c.onclick_old=c.onclick,c.onclick=null),addClassName(c,"disabled"))}},enableButton:function(){for(var a=0,b=arguments.length;a<b;a++){var c=_(arguments[a]);
c&&(c.disabled=!1,c.href_old&&(c.href=c.href_old),c.onclick_old&&(c.onclick=c.onclick_old),removeClassName(c,"disabled"))}},addDisabledOverlay:function(a){var a=$(a),b=new Element("div",{style:"position:absolute; z-index:9999; top: 0; left: 0; width:"+a.clientWidth+"px; height:"+a.clientHeight+"px;"});a.parentNode.setStyle({position:"relative"});a.parentNode.insert(b,{before:a})},isButtonSelected:function(a){return-1!=_(a).className.indexOf("selected")},buttonUnselect:function(){for(var a=$A(arguments),
b=a.length;0<b;)Element.removeClassName(a[--b],"selected")},buttonSelect:function(){for(var a=$A(arguments),b=a.length;0<b;)Element.addClassName(a[--b],"selected")},smartSelect:function(a,b,c){$(b).select(c||"a").each(function(a){a.removeClassName("selected")});$(a).addClassName("selected")},smartShow:function(a,b,c){$(b).select(c||"div").each(function(a){a.hide()});$(a).show()},bindSmartTabs:function(){$("tab_btns").select("li").each(function(a){Element.bindOnClick(a,function(a){MM.ui.smartSelect(a,
"tab_btns","li");MM.ui.smartShow("tab_content_"+a.id.substring(8),"tab_contents",".tabcontent")}.bind(this,a))})},setFieldVisible:function(a){(a=_("msg_"+a))&&0<a.innerHTML.length?(a.className="formSpace",Element.show(a)):Element.hide(a)},stylizeFile:function(a,b){if(isOP)return Element.removeClassName(a.parentNode,"cabinet");a.parentNode.file=a;a.parentNode.onmousemove=function(a){"undefined"==typeof a&&(a=window.event);var d=Event.pointerX(a),a=Event.pointerY(a),e=Element.cumulativeOffset(this);
b.rightMargin&&d>e[0]+this.offsetWidth-b.rightMargin?this.file.hide():this.file.show();if(!isIE||!(a<e[1]||a>=e[1]+this.offsetHeight||d<e[0]||d>=e[0]+this.offsetWidth)){var d=d-e[0],f=this.file.offsetWidth;this.file.style.top=a-e[1]-this.file.offsetHeight/2-this.offsetHeight+"px";this.file.style.left=d-(f-30)+"px";_("file_label").style.textDecoration="none"}};a.parentNode.onmouseout=function(){_("file_label").style.textDecoration="none"}},centerLeft:function(a){a=$(a);a.setStyle({marginLeft:-(a.getWidth()/
2)+"px"})},centerAndShow:function(a){document.body.appendChild(a);var b=document.viewport.getDimensions();a.setStyle({top:(b.height-a.clientHeight)/2+"px",left:(b.width-a.clientWidth)/2+"px",visibility:"visible"})},showBusy:function(a){MM.ui._activity=new MM.ui.Activity(a)},hideBusy:function(){MM.ui._activity.close()},getColorWithAlpha:function(a,b){return isIE?"#"+MM.ui.getShades(a,!0):"rgba("+MM.ui.getRGB(a).join(",")+","+b+")"},getRGB:function(a){a=a.toLowerCase();return[parseInt(a.slice(0,2),
16),parseInt(a.slice(2,4),16),parseInt(a.slice(4),16)]},getHEX:function(a){return("0"+a[0].toString(16)).slice(-2)+("0"+a[1].toString(16)).slice(-2)+("0"+a[2].toString(16)).slice(-2)},lightenColor:function(a,b){return this._shadeColor(a,b,1)},darkenColor:function(a,b){return this._shadeColor(a,b,-1)},_shadeColor:function(a,b,c){if(6!=a.length)return a;for(var a=this.getRGB(a),d=0;3>d;d++)a[d]+=c*Math.round(a[d]*b),255<a[d]&&(a[d]=255),0>a[d]&&(a[d]=0);return this.getHEX(a)},smartTruncate:function(a,
b){return"text-overflow"in document.body.style?a:a.truncate(b)},showFlashMessage:function(a,b,c){var d=_("messages");d&&(c||(c="notice"),d.innerHTML="<div id='messagebar' style='display:none'><div class='message "+c+"'><h3>"+("js_"+c).tr()+"</h3><p>"+a+"</p></div></div>",new Effect.BlindDown("messagebar",{duration:0.5}),setTimeout(function(){new Effect.BlindUp("messagebar",{duration:0.5})},b?1E3*b:1E4))},showUpgradeMessage:function(a,b,c){MM.ui.showFlashMessage("js_you_cant_do_things_become_premium_to_do_that_s".tr([a,
b])+'<a href="'+c+'" class="button highlight">'+"js_upgrade".tr()+"</a>")},showFieldError:function(a,b){var c=$("msg_"+a);c.innerHTML=b;c.className="formError";c.show()},hideFieldError:function(a){a=$("msg_"+a);a.innerHTML="";a.className="formSpace";a.hide()},openHelp:function(a,b,c){var d="/help",e=ServerData.user.language;e&&"en"!=e&&(d="/"+e+d);d=a&&0<=a.indexOf("/")?d+a:d+((a?"/"+a:"")+(b?"/"+b:"")+(c?"#"+c:""));window.open(d,"help","width=950,height=600,menubar=no,toolbar=no,scrollbars=yes,resizable=yes");
return!1},buildAccountPopover:function(){var a=new Popover("account",MM.ui.doAccountActions),b=[];b.push((new Element("a",{href:"",id:"btn_signout"})).update("js_signout".tr()));b.push((new Element("a",{href:"",id:"btn_myaccount"})).update("js_myaccount".tr()));ServerData.user.team_admin&&b.push((new Element("a",{href:"",id:"btn_myteam"})).update("js_myteam".tr()));ServerData.user.admin&&b.push((new Element("a",{href:"",id:"btn_acc_admin"})).update("js_admin".tr()));ServerData.user.translator&&b.push((new Element("a",
{href:"",id:"btn_acc_translate"})).update("js_translate".tr()));b.push((new Element("a",{href:"",id:"btn_help"})).update("js_help".tr()));a.addElements(b)},doAccountActions:function(a){switch(a){case "btn_myaccount":window.location.href="/account/index";break;case "btn_myteam":window.location.href="/team/activity";break;case "btn_acc_admin":window.location.href="/admin/index";break;case "btn_acc_translate":window.location.href="/translations";break;case "btn_help":MM.ui.openHelp();break;case "btn_signout":window.location.href=
"/account/logout"}},buildLanguagePopover:function(){(new Popover("language",MM.ui.doLanguageActions)).popover.elements=$$("#popover_language li")},doLanguageActions:function(a){ServerData.user.logged_in?new Ajax.Request("/settings/update_language_settings?switcher=true&preferred_language="+a.substring(9)):window.location.href=$(a).href}};MM.onload.add(MM.ui.onLoad);
var Window=Class.create();Window.keepMultiModalWindow=!1;Window.hasEffectLib="undefined"!=typeof Effect;Window.resizeEffectDuration=0.4;
Window.prototype={initialize:function(){var a,b=0;0<arguments.length&&("string"==typeof arguments[0]?(a=arguments[0],b=1):a=arguments[0]?arguments[0].id:null);a||(a="window_"+(new Date).getTime());$(a)||(this.options=Object.extend({className:"dialog",blurClassName:null,minWidth:100,minHeight:20,userData:null,showEffect:Window.hasEffectLib?Effect.Appear:Element.show,hideEffect:Window.hasEffectLib?Effect.Fade:Element.hide,showEffectOptions:{},hideEffectOptions:{afterFinish:function(){WindowUtilities.resetBodyOverflow()}},
useEffects:!0,effectOptions:null,parent:document.body,title:"",url:null,onload:Prototype.emptyFunction,width:200,height:414,opacity:1,autoRecenter:!0,autoSize:!1,keymap:null,closeable:!1,closeCallback:null,destroyOnClose:!1,gridX:1,gridY:1},arguments[b]||{}),MM.utils.loadCSS(["/stylesheets/compiled"+(isRetina?"/x2":"")+"/pages/dialogs.css"]),this.options.blurClassName&&(this.options.focusClassName=this.options.className),"undefined"==typeof this.options.top&&"undefined"==typeof this.options.bottom&&
(this.options.top=this._round(500*Math.random(),this.options.gridY)),"undefined"==typeof this.options.left&&"undefined"==typeof this.options.right&&(this.options.left=this._round(500*Math.random(),this.options.gridX)),this.options.effectOptions&&(Object.extend(this.options.hideEffectOptions,this.options.effectOptions),Object.extend(this.options.showEffectOptions,this.options.effectOptions),this.options.showEffect==Element.Appear&&(this.options.showEffectOptions.to=this.options.opacity)),Window.hasEffectLib&&
(this.options.showEffect==Effect.Appear&&(this.options.showEffectOptions.to=this.options.opacity),this.options.hideEffect==Effect.Fade&&(this.options.hideEffectOptions.from=this.options.opacity)),this.options.hideEffect==Element.hide&&(this.options.hideEffect=function(){Element.hide(this.element);this.options.destroyOnClose&&this.destroy()}.bind(this)),this.options.parent!=document.body&&(this.options.parent=$(this.options.parent)),this.options.keymap&&this.options.keymap.enable(),this.element=this._createWindow(a),
this.element.win=this,this.eventOnLoad=this._getWindowBorderSize.bindAsEventListener(this),this.eventMouseDownContent=this.toFront.bindAsEventListener(this),this.eventResize=this._recenter.bindAsEventListener(this),this.content=$(this.element.id+"_content"),Event.observe(window,"load",this.eventOnLoad),Event.observe(window,"resize",this.eventResize),Event.observe(window,"scroll",this.eventResize),Event.observe(this.options.parent,"scroll",this.eventResize),this.useTop=this.useLeft=null,"undefined"!=
typeof this.options.left?(this.element.setStyle({left:parseFloat(this.options.left)+"px"}),this.useLeft=!0):(this.element.setStyle({right:parseFloat(this.options.right)+"px"}),this.useLeft=!1),"undefined"!=typeof this.options.top?(this.element.setStyle({top:parseFloat(this.options.top)+"px"}),this.useTop=!0):(this.element.setStyle({bottom:parseFloat(this.options.bottom)+"px"}),this.useTop=!1),this.storedLocation=null,this.setOpacity(this.options.opacity),this.options.zIndex&&this.setZIndex(this.options.zIndex),
this.options.destroyOnClose&&this.setDestroyOnClose(!0),this._getWindowBorderSize(),this.width=this.options.width,this.height=this.options.height,this.constraint=this.visible=!1,this.constraintPad={top:0,left:0,bottom:0,right:0},this.width&&this.height&&this.setSize(this.options.width,this.options.height),this.setTitle(this.options.title),Windows.register(this))},destroy:function(){this._notify("onDestroy");Event.stopObserving(this.topbar,"mousedown",this.eventMouseDown);Event.stopObserving(this.bottombar,
"mousedown",this.eventMouseDown);Event.stopObserving(this.content,"mousedown",this.eventMouseDownContent);Event.stopObserving(window,"load",this.eventOnLoad);Event.stopObserving(window,"resize",this.eventResize);Event.stopObserving(window,"scroll",this.eventResize);Event.stopObserving(this.content,"load",this.options.onload);if(this._oldParent){for(var a=this.getContent(),b=null,c=0;c<a.childNodes.length;c++){b=a.childNodes[c];if(1==b.nodeType)break;b=null}b&&this._oldParent.appendChild(b);this._oldParent=
null}this.sizer&&Event.stopObserving(this.sizer,"mousedown",this.eventMouseDown);this.options.url&&(this.content.src=null);this.options.keymap&&this.options.keymap.disable();"undefined"!=typeof canvas&&null!=canvas&&canvas.addFocus();this.iefix&&Element.remove(this.iefix);Element.remove(this.element);Windows.unregister(this)},setCloseCallback:function(a){this.options.closeCallback=a},getContent:function(){return this.content},setContent:function(a,b,c){var d=$(a);if(null==d)throw"Unable to find element '"+
a+"' in DOM";this._oldParent=d.parentNode;var e=a=null;b&&(a=Element.getDimensions(d));c&&(e=Position.cumulativeOffset(d));var f=this.getContent();this.setHTMLContent("");f=this.getContent();f.appendChild(d);d.show();b&&this.setSize(a.width,a.height);c&&this.setLocation(e[1]-this.heightN,e[0]-this.widthW)},setHTMLContent:function(a){if(this.options&&this.options.url){this.content.src=null;this.options.url=null;var b='<div id="'+this.getId()+'_content" class="'+this.options.className.split(" ")[0]+
'_content"> </div>';$(this.getId()+"_table_content").innerHTML=b;this.content=$(this.element.id+"_content")}Element.update(this.getContent(),a);this.options.autoSize&&this.updateHeight()},setAjaxContent:function(a,b,c,d){this.showFunction=c?"showCenter":"show";this.showModal=d||!1;b=b||{};this.setHTMLContent("");this.onComplete=b.onComplete;this._onCompleteHandler||(this._onCompleteHandler=this._setAjaxContent.bind(this));b.onComplete=this._onCompleteHandler;new Ajax.Request(a,b);b.onComplete=this.onComplete},
_setAjaxContent:function(a){Element.update(this.getContent(),a.responseText);if(this.onComplete)this.onComplete(a);this.onComplete=null;this[this.showFunction](this.showModal)},setURL:function(a){this.options.url&&(this.content.src=null);this.options.url=a;a="<iframe frameborder='0' name='"+this.getId()+"_content'  id='"+this.getId()+"_content' src='"+a+"' width='"+this.width+"' height='"+this.height+"'> </iframe>";$(this.getId()+"_table_content").innerHTML=a;this.content=$(this.element.id+"_content")},
getURL:function(){return this.options.url?this.options.url:null},refresh:function(){this.options.url&&($(this.element.getAttribute("id")+"_content").src=this.options.url)},setCookie:function(a,b,c,d,e){a=a||this.element.id;this.cookie=[a,b,c,d,e];if(a=WindowUtilities.getCookie(a))d=a.split(","),a=d[0].split(":"),b=d[1].split(":"),c=parseFloat(d[2]),d=parseFloat(d[3]),this.setSize(c,d),this.useLeft="l"==a[0],this.useTop="t"==b[0],this.element.setStyle(this.useLeft?{left:a[1]}:{right:a[1]}),this.element.setStyle(this.useTop?
{top:b[1]}:{bottom:b[1]})},getId:function(){return this.element.id},setDestroyOnClose:function(){this.options.destroyOnClose=!0},setConstraint:function(a,b){this.constraint=a;this.constraintPad=Object.extend(this.constraintPad,b||{});this.useTop&&this.useLeft&&this.setLocation(parseFloat(this.element.style.top),parseFloat(this.element.style.left))},_round:function(a,b){return 1==b?a:Math.floor(a/b)*b},_updateLeftConstraint:function(a){if(this.constraint&&this.useLeft&&this.useTop){var b=this.options.parent==
document.body?WindowUtilities.getPageSize().windowWidth:this.options.parent.getDimensions().width;a<this.constraintPad.left&&(a=this.constraintPad.left);a+this.width+this.widthE+this.widthW>b-this.constraintPad.right&&(a=b-this.constraintPad.right-this.width-this.widthE-this.widthW)}return a},_updateTopConstraint:function(a){if(this.constraint&&this.useLeft&&this.useTop){var b=this.options.parent==document.body?WindowUtilities.getPageSize().windowHeight:this.options.parent.getDimensions().height,
c=this.height+this.heightN+this.heightS;a<this.constraintPad.top&&(a=this.constraintPad.top);a+c>b-this.constraintPad.bottom&&(a=b-this.constraintPad.bottom-c)}return a},_updateWidthConstraint:function(a){if(this.constraint&&this.useLeft&&this.useTop){var b=this.options.parent==document.body?WindowUtilities.getPageSize().windowWidth:this.options.parent.getDimensions().width,c=parseFloat(this.element.getStyle("left"));c+a+this.widthE+this.widthW>b-this.constraintPad.right&&(a=b-this.constraintPad.right-
c-this.widthE-this.widthW)}return a},_updateHeightConstraint:function(a){if(this.constraint&&this.useLeft&&this.useTop){var b=this.options.parent==document.body?WindowUtilities.getPageSize().windowHeight:this.options.parent.getDimensions().height,c=parseFloat(this.element.getStyle("top"));c+a+this.heightN+this.heightS>b-this.constraintPad.bottom&&(a=b-this.constraintPad.bottom-c-this.heightN-this.heightS)}return a},_createWindow:function(a){var b=this.options.className,c=document.createElement("div");
c.setAttribute("id",a);c.className="dialog";var d='<div id="dlg_flash_msg" style="display:none"></div>';this.options.closeable&&(d+='<div class="close" onclick="Windows.close(\''+a+"')\"></div>");d=this.options.url?d+('<iframe frameborder="0" name="'+a+'_content"  id="'+a+'_content" src="'+this.options.url+'"> </iframe>'):d+('<div id="'+a+'_content" class="'+b.split(" ")[0]+'_content"> </div>');this.options.noHelp||(d+='<a class="icon-medium help" href="#" onclick="return MM.ui.openHelp(MM.status.helpTopic)">'+
"js_help".tr()+"</a>");c.className=this.options.className+("popup"==this.options.className?"_css":"")+(300>this.options.height?" small":"");c.innerHTML=d;Element.hide(c);this.options.parent.insertBefore(c,this.options.parent.firstChild);Event.observe($(a+"_content"),"load",this.options.onload);return c},changeClassName:function(a){var b=this.options.className,c=this.getId();$A(["_content"]).each(function(d){this._toggleClassName($(c+d),b+d,a+d)}.bind(this));$$("#"+c+" td").each(function(c){c.className=
c.className.sub(b,a)});this.options.className=a},_toggleClassName:function(a,b,c){a&&(a.removeClassName(b),a.addClassName(c))},setLocation:function(a,b){var a=this._updateTopConstraint(a),b=this._updateLeftConstraint(b),c=this.currentDrag||this.element;c.setStyle({top:a+"px"});c.setStyle({left:b+"px"});this.useTop=this.useLeft=!0},getLocation:function(){var a={},a=this.useTop?Object.extend(a,{top:this.element.getStyle("top")}):Object.extend(a,{bottom:this.element.getStyle("bottom")});return a=this.useLeft?
Object.extend(a,{left:this.element.getStyle("left")}):Object.extend(a,{right:this.element.getStyle("right")})},getSize:function(){return{width:this.width,height:this.height}},setSize:function(a,b,c){a=parseFloat(a);b=parseFloat(b);a<this.options.minWidth&&(a=this.options.minWidth);b<this.options.minHeight&&(b=this.options.minHeight);this.options.maxHeight&&b>this.options.maxHeight&&(b=this.options.maxHeight);this.options.maxWidth&&a>this.options.maxWidth&&(a=this.options.maxWidth);if(this.useTop&&
this.useLeft&&Window.hasEffectLib&&Effect.ResizeWindow&&c)new Effect.ResizeWindow(this,null,null,a,b,{duration:Window.resizeEffectDuration});else if(this.width=a,this.height=b,!this.currentDrag||this.currentDrag==this.element)c=$(this.element.id+"_content"),c.setStyle({height:b+"px"}),c.setStyle({width:a+"px"}),_("dlg_flash_msg")&&(_("dlg_flash_msg").style.width=a-22+"px")},updateHeight:function(a){var b=this.content.select("div")[0];b&&this.height!=b.scrollHeight&&(a&&CSS.set(this.element,{transition:"top 0.5s ease-in-out"}),
this.setSize(this.width,b.scrollHeight,a),this._recenter(),a&&CSS.set(this.element,{transition:"all 0s ease 0s"}))},toFront:function(){this.element.style.zIndex<Windows.maxZIndex&&this.setZIndex(Windows.maxZIndex+1);this.iefix&&this._fixIEOverlapping()},getBounds:function(a){(!this.width||!this.height||!this.visible)&&this.computeBounds();var b=this.width,c=this.height;a||(b+=this.widthW+this.widthE,c+=this.heightN+this.heightS);return Object.extend(this.getLocation(),{width:b+"px",height:c+"px"})},
computeBounds:function(){if(!this.width||!this.height){var a=WindowUtilities._computeSize(this.content.innerHTML,this.content.id,this.width,this.height,0,this.options.className);this.height?this.width=a+5:this.height=a+5}this.setSize(this.width,this.height);this.centered&&this._center(this.centerTop,this.centerLeft)},show:function(a){if(!this.visible){this.visible=!0;if(a){if("undefined"==typeof this.overlayOpacity){var b=this;setTimeout(function(){b.show(a)},10);return}Windows.addModalWindow(this);
this.modal=!0;this.setZIndex(Windows.maxZIndex+1);Windows.unsetOverflow(this)}else this.element.style.zIndex||this.setZIndex(Windows.maxZIndex+1);this.oldStyle&&this.getContent().setStyle({overflow:this.oldStyle});this.computeBounds();this._notify("onBeforeShow");this.options.useEffects?this.options.showEffect!=Element.show&&this.options.showEffectOptions?(this.element.setStyle({opacity:"0.01",display:"block"}),this.options.showEffect(this.element,this.options.showEffectOptions)):this.options.showEffect(this.element):
Element.show(this.element);window.canvas&&canvas.removeFocus();WindowUtilities.unsetBodyOverflow();this._checkIEOverlapping();WindowUtilities.focusedWindow=this;this._notify("onShow")}},showCenter:function(a,b,c){this.centered=!0;this.centerTop=b;this.centerLeft=c;this.show(a)},isVisible:function(){return this.visible},_center:function(a,b){var c=WindowUtilities.getWindowScroll(this.options.parent),d=WindowUtilities.getPageSize(this.options.parent);"undefined"==typeof a&&(a=(d.windowHeight-(this.height+
this.heightN+this.heightS))/2);a+=c.top;"undefined"==typeof b&&(b=(d.windowWidth-(this.width+this.widthW+this.widthE))/2);b+=c.left;this.setLocation(a,b);this.toFront()},_recenter:function(){if(this.centered){var a=WindowUtilities.getPageSize(this.options.parent),b=WindowUtilities.getWindowScroll(this.options.parent);this.pageSize=a;this.windowScroll=b;$("overlay")&&$("overlay").setStyle({height:a.pageHeight+"px"});this.options.autoRecenter&&this._center(this.centerTop,this.centerLeft)}},setNoEffects:function(){this.options.useEffects=
!1},hide:function(){this.visible=!1;this.modal&&(Windows.removeModalWindow(this),Windows.resetOverflow());this.options.useEffects?this.options.hideEffect(this.element,this.options.hideEffectOptions):(Element.hide(this.element),this.options.destroyOnClose&&this.destroy());this.iefix&&this.iefix.hide();this.doNotNotifyHide||this._notify("onHide")},close:function(){if(this.visible&&(!this.options.closeCallback||this.options.closeCallback(this))){if(this.options.destroyOnClose){var a=this.destroy.bind(this);
if(this.options.hideEffectOptions.afterFinish){var b=this.options.hideEffectOptions.afterFinish;this.options.hideEffectOptions.afterFinish=function(){b();a()}}else this.options.hideEffectOptions.afterFinish=function(){a()}}Windows.updateFocusedWindow();this.doNotNotifyHide=!0;this.hide();this.doNotNotifyHide=!1;window.canvas&&canvas.addFocus();this._notify("onClose");MM.ui.dialogs.reloadOnClose&&setTimeout("window.location.reload()",500)}},setOpacity:function(a){Element.setOpacity&&Element.setOpacity(this.element,
a)},setZIndex:function(a){this.element.setStyle({zIndex:a});Windows.updateZindex(a,this)},setTitle:function(){},getTitle:function(){return""},setStatusBar:function(a){$(this.getId()+"_bottom");"object"==typeof a?this.bottombar.firstChild?this.bottombar.replaceChild(a,this.bottombar.firstChild):this.bottombar.appendChild(a):this.bottombar.innerHTML=a},_checkIEOverlapping:function(){!this.iefix&&(0<navigator.appVersion.indexOf("MSIE")&&0>navigator.userAgent.indexOf("Opera")&&"absolute"==this.element.getStyle("position"))&&
(new Insertion.After(this.element.id,'<iframe id="'+this.element.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>'),this.iefix=$(this.element.id+"_iefix"));this.iefix&&setTimeout(this._fixIEOverlapping.bind(this),50)},_fixIEOverlapping:function(){Position.clone(this.element,this.iefix);this.iefix.style.zIndex=this.element.style.zIndex-1;this.iefix.show()},_getWindowBorderSize:function(){this.heightN=
20;this.heightS=85;this.widthE=this.widthW=0;this.overlayOpacity=0.8},_storeLocation:function(){null==this.storedLocation&&(this.storedLocation={useTop:this.useTop,useLeft:this.useLeft,top:this.element.getStyle("top"),bottom:this.element.getStyle("bottom"),left:this.element.getStyle("left"),right:this.element.getStyle("right"),width:this.width,height:this.height})},_restoreLocation:function(){null!=this.storedLocation&&(this.useLeft=this.storedLocation.useLeft,this.useTop=this.storedLocation.useTop,
this.useLeft&&this.useTop&&Window.hasEffectLib&&Effect.ResizeWindow?new Effect.ResizeWindow(this,this.storedLocation.top,this.storedLocation.left,this.storedLocation.width,this.storedLocation.height,{duration:Window.resizeEffectDuration}):(this.element.setStyle(this.useLeft?{left:this.storedLocation.left}:{right:this.storedLocation.right}),this.element.setStyle(this.useTop?{top:this.storedLocation.top}:{bottom:this.storedLocation.bottom}),this.setSize(this.storedLocation.width,this.storedLocation.height)),
Windows.resetOverflow(),this._removeStoreLocation())},_removeStoreLocation:function(){this.storedLocation=null},_saveCookie:function(){if(this.cookie){var a="",a=this.useLeft?a+("l:"+(this.storedLocation?this.storedLocation.left:this.element.getStyle("left"))):a+("r:"+(this.storedLocation?this.storedLocation.right:this.element.getStyle("right"))),a=this.useTop?a+(",t:"+(this.storedLocation?this.storedLocation.top:this.element.getStyle("top"))):a+(",b:"+(this.storedLocation?this.storedLocation.bottom:
this.element.getStyle("bottom"))),a=a+(","+(this.storedLocation?this.storedLocation.width:this.width)),a=a+(","+(this.storedLocation?this.storedLocation.height:this.height));WindowUtilities.setCookie(a,this.cookie)}},_createWiredElement:function(){if(!this.wiredElement){Prototype.Browser.IE&&this._getWindowBorderSize();var a=document.createElement("div");a.className="wired_frame "+this.options.className+"_wired_frame";a.style.position="absolute";this.options.parent.insertBefore(a,this.options.parent.firstChild);
this.wiredElement=$(a)}this.useLeft?this.wiredElement.setStyle({left:this.element.getStyle("left")}):this.wiredElement.setStyle({right:this.element.getStyle("right")});this.useTop?this.wiredElement.setStyle({top:this.element.getStyle("top")}):this.wiredElement.setStyle({bottom:this.element.getStyle("bottom")});a=this.element.getDimensions();this.wiredElement.setStyle({width:a.width+"px",height:a.height+"px"});this.wiredElement.setStyle({zIndex:Windows.maxZIndex+30});return this.wiredElement},_hideWiredElement:function(){this.wiredElement&&
this.currentDrag&&(this.currentDrag==this.element?this.currentDrag=null:(this.useLeft?this.element.setStyle({left:this.currentDrag.getStyle("left")}):this.element.setStyle({right:this.currentDrag.getStyle("right")}),this.useTop?this.element.setStyle({top:this.currentDrag.getStyle("top")}):this.element.setStyle({bottom:this.currentDrag.getStyle("bottom")}),this.currentDrag.hide(),this.currentDrag=null,this.doResize&&this.setSize(this.width,this.height)))},_notify:function(a){if(this.options[a])this.options[a](this);
Windows.notify(a,this)}};
var Windows={windows:[],modalWindows:[],observers:[],focusedWindow:null,maxZIndex:0,overlayShowEffectOptions:{duration:0.3},overlayHideEffectOptions:{duration:0.3},addObserver:function(a){this.removeObserver(a);this.observers.push(a)},removeObserver:function(a){this.observers=this.observers.reject(function(b){return b==a})},notify:function(a,b){this.observers.each(function(c){if(c[a])c[a](a,b)})},getWindow:function(a){return this.windows.detect(function(b){return b.getId()==a})},getFocusedWindow:function(){return this.focusedWindow},
updateFocusedWindow:function(){this.focusedWindow=2<=this.windows.length?this.windows[this.windows.length-2]:null},register:function(a){this.windows.push(a)},addModalWindow:function(a){0==this.modalWindows.length?WindowUtilities.disableScreen(a.options.className,"overlay",a.overlayOpacity,a.getId(),a.options.parent):(Window.keepMultiModalWindow?($("overlay").style.zIndex=Windows.maxZIndex+1,Windows.maxZIndex+=1,WindowUtilities._hideSelect(this.modalWindows.last().getId())):this.modalWindows.last().element.hide(),
WindowUtilities._showSelect(a.getId()));this.modalWindows.push(a)},removeModalWindow:function(a){this.modalWindows.pop();0==this.modalWindows.length?WindowUtilities.enableScreen(a.options.className):Window.keepMultiModalWindow?(this.modalWindows.last().toFront(),WindowUtilities._showSelect(this.modalWindows.last().getId())):this.modalWindows.last().element.show()},register:function(a){this.windows.push(a)},unregister:function(a){this.windows=this.windows.reject(function(b){return b==a})},closeAll:function(){this.windows.each(function(a){Windows.close(a.getId())})},
closeAllModalWindows:function(){WindowUtilities.enableScreen("dialog");this.modalWindows.each(function(a){a&&a.close()})},close:function(a,b){var c=this.getWindow(a);c&&c.close();b&&Event.stop(b)},blur:function(a){if(a=this.getWindow(a))a.options.blurClassName&&a.changeClassName(a.options.blurClassName),this.focusedWindow==a&&(this.focusedWindow=null),a._notify("onBlur")},focus:function(a){if(a=this.getWindow(a))this.focusedWindow&&this.blur(this.focusedWindow.getId()),a.options.focusClassName&&a.changeClassName(a.options.focusClassName),
this.focusedWindow=a,a._notify("onFocus")},unsetOverflow:function(){},resetOverflow:function(){},updateZindex:function(a,b){a>this.maxZIndex&&(this.maxZIndex=a,this.focusedWindow&&this.blur(this.focusedWindow.getId()));(this.focusedWindow=b)&&this.focus(this.focusedWindow.getId())}},Dialog={dialogId:null,onCompleteFunc:null,callFunc:null,parameters:null,confirm:function(a,b){if(a&&"string"!=typeof a)Dialog._runAjaxRequest(a,b,Dialog.confirm);else{var a=a||"",b=b||{},c=b.okLabel?b.okLabel:"js_ok".tr(),
d=b.cancelLabel?b.cancelLabel:"js_cancel".tr(),b=Object.extend(b,b.windowParameters||{});b.windowParameters=b.windowParameters||{};b.className=b.className||"alert";a="<div class='"+b.className+"_message'>"+a+"</div><div class='"+b.className+"_buttons'><a href='#' onclick='return Dialog.okCallback()' "+("class ='"+(b.buttonClass?b.buttonClass+" ":"")+" ok_button default'")+">"+c+"</a><a href='#' onclick='return Dialog.cancelCallback()' "+("class ='"+(b.buttonClass?b.buttonClass+" ":"")+" cancel_button'")+
">"+d+"</a></div>";return this._openDialog(a,b)}},confirmOrCancel:function(a,b){b=b||{};b.windowParameters=b.windowParameters||{};var b=Object.extend(b,b.windowParameters),c=b.okLabel?b.okLabel:"OK",d=b.cancelLabel?b.cancelLabel:"Cancel",e=b.noLabel?b.noLabel:"No";b.className=b.className||"alert";a="<div class='"+b.className+"_message'>"+a+"</div><div class='"+b.className+"_buttons'><a href='#' onclick='return Dialog.okCallback()' "+("class ='"+(b.buttonClass?b.buttonClass+" ":"")+" ok_button'")+
">"+c+"</a><a href='#' onclick='return Dialog.noCallback()' "+("class ='"+(b.buttonClass?b.buttonClass+" ":"")+" no_button'")+">"+e+"</a><input type='button' value='"+d+"' onclick='Dialog.cancelCallback()' "+("class ='"+(b.buttonClass?b.buttonClass+" ":"")+" cancel_button'")+"/></div>";return this._openDialog(a,b)},alert:function(a,b){if(a&&"string"!=typeof a)Dialog._runAjaxRequest(a,b,Dialog.alert);else{var a=a||"",b=b||{},c=b.okLabel?b.okLabel:"Ok",b=Object.extend(b,b.windowParameters||{});b.windowParameters=
b.windowParameters||{};b.className=b.className||"alert";a="<div class='"+b.className+"_message'>"+a+"</div><div class='"+b.className+"_buttons'><input type='button' value='"+c+"' onclick='Dialog.okCallback()' "+("class ='"+(b.buttonClass?b.buttonClass+" ":"")+" ok_button'")+"/></div>";return this._openDialog(a,b)}},info:function(a,b){if(a&&"string"!=typeof a)Dialog._runAjaxRequest(a,b,Dialog.info);else return a=a||"",b=b||{},b=Object.extend(b,b.windowParameters||{}),b.windowParameters=b.windowParameters||
{},b.className=b.className||"alert",a="<div id='modal_dialog_message' class='"+b.className+"_message'>"+a+"</div>",b.showProgress&&(a+="<div id='modal_dialog_progress' class='"+b.className+"_progress'>  </div>"),b.ok=null,b.cancel=null,this._openDialog(a,b)},setInfoMessage:function(a){$("modal_dialog_message").update(a)},closeInfo:function(){Windows.close(this.dialogId)},_openDialog:function(a,b){var c=b.className;!b.height&&!b.width&&(b.width=WindowUtilities.getPageSize(b.options.parent||document.body).pageWidth/
2);b.id?this.dialogId=b.id:(this.dialogId="modal_dialog_"+(new Date).getTime(),b.id=this.dialogId);if(!b.height||!b.width)c=WindowUtilities._computeSize(a,this.dialogId,b.width,b.height,5,c),b.height?b.width=c+5:b.height=c+5;b.effectOptions=b.effectOptions;b.noHelp=!0;c=new Window(b);c.getContent().innerHTML=a;c.showCenter(!0,b.top,b.left);c.setDestroyOnClose();c.cancelCallback=b.onCancel||b.cancel;c.okCallback=b.onOk||b.ok;c.noCallback=b.onNo||b.no;return c},_getAjaxContent:function(a){Dialog.callFunc(a.responseText,
Dialog.parameters)},_runAjaxRequest:function(a,b,c){null==a.options&&(a.options={});Dialog.onCompleteFunc=a.options.onComplete;Dialog.parameters=b;Dialog.callFunc=c;a.options.onComplete=Dialog._getAjaxContent;new Ajax.Request(a.url,a.options)},okCallback:function(){var a=Windows.focusedWindow||Windows.getFocusedWindow();if(!a.okCallback||a.okCallback(a))$$("#"+a.getId()+" input").each(function(a){a.onclick=null}),a.close();return!1},noCallback:function(){var a=Windows.focusedWindow||Windows.getFocusedWindow();
if(!a.noCallback||a.noCallback(a))$$("#"+a.getId()+" input").each(function(a){a.onclick=null}),a.close();return!1},cancelCallback:function(){var a=Windows.focusedWindow;$$("#"+a.getId()+" input").each(function(a){a.onclick=null});a.close();a.cancelCallback&&a.cancelCallback(a);return!1}};if(Prototype.Browser.WebKit){var array=navigator.userAgent.match(RegExp(/AppleWebKit\/([\d\.\+]*)/));Prototype.Browser.WebKitVersion=parseFloat(array[1])}
var WindowUtilities={getWindowScroll:function(a){var b,c,d,a=a||document.body;if(a!=document.body)b=a.scrollTop,c=a.scrollLeft,d=a.scrollWidth,a=a.scrollHeight;else{var a=window,e=a.document,f=e.documentElement;f&&f.scrollTop?(b=f.scrollTop,c=f.scrollLeft):e.body&&(b=e.body.scrollTop,c=e.body.scrollLeft);a.innerWidth?(d=a.innerWidth,a=a.innerHeight):f&&f.clientWidth?(d=f.clientWidth,a=f.clientHeight):(d=e.body.offsetWidth,a=e.body.offsetHeight)}return{top:b,left:c,width:d,height:a}},getPageSize:function(a){var a=
a||document.body,b,c,d;a!=document.body?(b=a.getWidth(),c=a.getHeight(),d=a.scrollWidth,a=a.scrollHeight):(window.innerHeight&&window.scrollMaxY?(d=document.body.scrollWidth,a=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(d=document.body.scrollWidth,a=document.body.scrollHeight):(d=document.body.offsetWidth,a=document.body.offsetHeight),self.innerHeight?(b=self.innerWidth,c=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?
(b=document.documentElement.clientWidth,c=document.documentElement.clientHeight):document.body&&(b=document.body.clientWidth,c=document.body.clientHeight),a=a<c?c:a,d=d<b?b:d);return{pageWidth:d,pageHeight:a,windowWidth:b,windowHeight:c}},disableScreen:function(a,b,c,d,e){WindowUtilities.initLightbox(b,a,function(){this._disableScreen(a,b,c,d)}.bind(this),e||document.body)},_disableScreen:function(a,b,c,d){var e=$(b),f=WindowUtilities.getPageSize(e.parentNode);isIE&&(f.pageHeight-=1);d&&Prototype.Browser.IE&&
(WindowUtilities._hideSelect(),WindowUtilities._showSelect(d));e.style.height=f.pageHeight+"px";e.style.display="none";e.className="overlay_"+a;a=Windows.getFocusedWindow();"overlay"==b&&Window.hasEffectLib&&Windows.overlayShowEffectOptions&&a&&a.options.useEffects?(e.overlayOpacity=c,new Effect.Appear(e,Object.extend({from:0,to:c},Windows.overlayShowEffectOptions))):e.style.display="block"},enableScreen:function(a,b){var a=a||"",b=b||"overlay",c=$(b);if(c&&c.hasClassName("overlay_"+a)){var d=Windows.getFocusedWindow();
"overlay"==b&&Window.hasEffectLib&&Windows.overlayHideEffectOptions&&d&&d.options.useEffects?new Effect.Fade(c,Object.extend({from:c.overlayOpacity,to:0},Windows.overlayHideEffectOptions)):(c.style.display="none",c.parentNode.removeChild(c));"__invisible__"!=b&&WindowUtilities._showSelect()}},_hideSelect:function(a){Prototype.Browser.IE&&$$((null==a?"":"#"+a+" ")+"select").each(function(a){WindowUtilities.isDefined(a.oldVisibility)||(a.oldVisibility=a.style.visibility?a.style.visibility:"visible",
a.style.visibility="hidden")})},_showSelect:function(a){Prototype.Browser.IE&&$$((null==a?"":"#"+a+" ")+"select").each(function(a){if(WindowUtilities.isDefined(a.oldVisibility)){try{a.style.visibility=a.oldVisibility}catch(c){a.style.visibility="visible"}a.oldVisibility=null}else a.style.visibility&&(a.style.visibility="visible")})},isDefined:function(a){return"undefined"!=typeof a&&null!=a},initLightbox:function(a,b,c,d){if($(a))Element.setStyle(a,{zIndex:Windows.maxZIndex+1}),Windows.maxZIndex++,
c();else{var e=document.createElement("div");e.setAttribute("id",a);e.className="overlay_"+b;e.style.display="none";e.style.position="absolute";e.style.top="0";e.style.left="0";e.style.zIndex=Windows.maxZIndex+1;Windows.maxZIndex++;e.style.width="100%";d.insertBefore(e,d.firstChild);Prototype.Browser.WebKit&&"overlay"==a?setTimeout(function(){c()},10):c()}},unsetBodyOverflow:function(){null==document.body.oldOverflow&&(document.body.oldOverflow=$(document.body).getStyle("overflow")||"auto");document.body.setStyle({width:document.body.clientWidth+
"px",overflow:"hidden"})},resetBodyOverflow:function(){1<Windows.windows.length||(document.body.setStyle({overflow:document.body.oldOverflow}),document.body.oldOverflow=null,setTimeout("document.body.setStyle({width: 'auto'})",100))},setCookie:function(a,b){document.cookie=b[0]+"="+escape(a)+(b[1]?"; expires="+b[1].toGMTString():"")+(b[2]?"; path="+b[2]:"")+(b[3]?"; domain="+b[3]:"")+(b[4]?"; secure":"")},getCookie:function(a){var b=document.cookie,a=a+"=",c=b.indexOf("; "+a);if(-1==c){if(c=b.indexOf(a),
0!=c)return null}else c+=2;var d=document.cookie.indexOf(";",c);-1==d&&(d=b.length);return unescape(b.substring(c+a.length,d))},_computeSize:function(a,b,c,d,e,f){var h=document.body,g=document.createElement("div");g.setAttribute("id",b);g.className=f+"_content";d?g.style.height=d+"px":g.style.width=c+"px";g.style.position="absolute";g.style.top="0";g.style.left="0";g.style.display="none";g.innerHTML=a;h.insertBefore(g,h.firstChild);a=d?$(g).getDimensions().width+e:$(g).getDimensions().height+e;h.removeChild(g);
return a}};
MM.ui.dialogs={defaultOptions:function(){if(!this.keymap){var a=MM.utils.KeyEvent;this.keymap=new MM.utils.KeyMap(document,"dialog_keymap",[{key:a.ENTER,fn:function(){var b=Windows.focusedWindow;if(b.okCallback)b.okCallback();else{for(var a=b.element.select(".button.default"),d=!0,e=0;a[e]&&!a[e].visible()||a[e].hasClassName("disabled");)e++;if(!(a[e].hasAttribute("type")&&"submit"==a[e].getAttribute("type"))&&(a[e]&&a[e].onclick&&(d=a[e].onclick()),d&&(b=b.element.select("form"))&&b[0]))b[0].onsubmit&&
(d=b[0].onsubmit()),d&&b[0].submit()}}},{key:a.ESC,fn:function(){var b=Windows.focusedWindow;b.cancelCallback?b.cancelCallback():b.close()}}]);this.keymap.stopEvent=!1;this.keymap.disable()}return{buttonClass:"button",className:"dialog",width:560,zIndex:1100,keymap:this.keymap,minimizable:!1,maximizable:!1,resizable:!1,autoRecenter:480<window.innerHeight,effectOptions:{duration:0.3}}},show:function(a,b){var c=0<a.indexOf("_")?a.substring(0,a.indexOf("_")):a,b=Object.extend({update:$("listmaps"),dlg_name:c,
controller:"dialog",action:a+"_ajax"},b);"undefined"!=typeof canvas&&null!=canvas&&canvas.removeFocus();var c={},d="/"+b.controller+"/"+b.action+"?";i18n&&("en"!=i18n.current_language&&!ServerData.user.logged_in)&&(d="/"+i18n.current_language+d);b.map_id&&(c.id="object"===typeof b.map_id?b.map_id.join(","):b.map_id);new Ajax.Request(d+Object.toQueryString(c)+(b.param||""),{onComplete:function(a){a=a.responseText;if("{"==a[0]){if(a=a.evalJSON(),a.error&&a.error.code&&407==a.error.code&&"Authentication Needed"==
a.error.message&&a.error.url)return window.location.href=a.error.url,!1}else{var c=new Window(b.dlg_name,Object.extend(MM.ui.dialogs.defaultOptions(),b));c.setDestroyOnClose();c.showCenter(1);c.setHTMLContent(a)}if(b.onComplete)b.onComplete()}});return!1},close:function(a,b){Windows.close(a,b);return!1},switchTab:function(a,b,c,d,e,f,g){var g=g||"dialog",h=e?"&"+f:"?"+f;d||!_(b+"_form")?new Ajax.Request("/"+g+"/"+b+"_"+a+"_ajax/"+c+(e?"?edit="+e:"")+(f?h:""),{onComplete:function(a){var c=a.responseText;
if("{"==c[0]){if(a=c.evalJSON(),a.error&&a.error.code&&407==a.error.code&&"Authentication Needed"==a.error.message&&a.error.url)return window.location.href=a.error.url,!1}else 0<=a.getResponseHeader("Content-Type").indexOf("text/javascript;")?eval(c):$(b+"_content").update(c)}}):(_("tab").value=a,_(b+"_form").onsubmit());return!1},showAlert:function(a,b,c){c=Object.extend({width:414,height:150},c);Dialog.alert("<h2>"+a+"</h2><p>"+b+"</p>",{buttonClass:"button default",okLabel:"OK",windowParameters:Object.extend(MM.ui.dialogs.defaultOptions(),
c)})},showError:function(a,b,c){var c=c||{},d=$("dlg_flash_msg");d&&(d.className=b||"error",d.update(a).show());c.duration&&setTimeout("MM.ui.dialogs.hideError()",1E3*c.duration)},hideError:function(){$("dlg_flash_msg")&&$("dlg_flash_msg").hide()},dialogLogin:function(a,b){var c=null;a&&(c="type="+a);b&&(c=c?c+"&message="+b:"message="+b);return MM.ui.dialogs.show("login",{controller:"account",param:c,dlg_name:"dlg_login",width:500,height:b?300:236,closeable:!0,noHelp:!0})},dialogProperties:function(a,
b){return MM.ui.dialogs.show("properties_"+(b||"general"),{map_id:a||App.config.map_id,height:410})},dialogSharing:function(a,b){return MM.ui.dialogs.show("sharing",{controller:"sharing",action:"",map_id:a,width:540,height:460,autoSize:!0,onComplete:b})},dialogInvite:function(a,b){return MM.ui.dialogs.show("invite",{controller:"sharing",action:"invite",map_id:a,width:405,height:280,autoSize:!0,onComplete:b})},dialogPublish:function(a){return MM.ui.dialogs.show("publish",{map_id:a,width:415,height:330})},
dialogSettings:function(a,b){return MM.ui.dialogs.show("settings_"+(a||"general"),Object.extend({controller:"settings",width:"600",height:"455"},b||{}))},dialogExportMap:function(a){var b=new Window("export",Object.extend(MM.ui.dialogs.defaultOptions(),{title:"",height:150,width:480}));b.setAjaxContent("/maps/export_ajax/"+a);b.setDestroyOnClose();b.showCenter(1)},dialogPrintMap:function(a){var b=new Window("print",Object.extend(MM.ui.dialogs.defaultOptions(),{title:"",noHelp:!0,height:320,width:460}));
b.setAjaxContent("/maps/print_ajax/"+a);b.setDestroyOnClose();b.showCenter(1)},dialogQuickHelp:function(){return MM.ui.dialogs.show("quickhelp",{width:815,height:500})},cancelChangeEmail:function(a){new Ajax.Request("/users/cancel_change_email/"+a,{asynchronous:!0})},dialogRemoveCollaborator:function(a,b,c,d){c="self"==c?"js_you_still_have_tasks_sure_want_to_withdraw".tr():"js_s_still_has_tasks_sure_want_to_remove_s".tr([d,d]);Dialog.confirm('<h2 style="font-size:120%; font-weight: bold;">'+"js_removing_collaborator".tr()+
'</h2><p style="margin-top: 0;">'+c+"</p>",{ok:function(){this.close();MM.ui.dialogs.doRemoveCollaborator(a,b)},okLabel:"OK",windowParameters:Object.extend(MM.ui.dialogs.defaultOptions(),{height:140,width:320,tableClass:"small",buttonClass:"button small"})})},doRemoveCollaborator:function(a,b){new Ajax.Request("/sharing/remove/"+a+"?to_remove="+b+"&to_remove_type=User&confirm=true",{asynchronous:!0,evalScripts:!0})},dialogMapInaccessible:function(a){a="js_map_not_share_with_u_anymore_contact_s".tr([a]);
Dialog.alert("<h2>"+"js_inaccessible_map".tr()+"</h2><p>"+a+"</p>",{buttonClass:"button",okLabel:"OK",windowParameters:Object.extend(MM.ui.dialogs.defaultOptions(),{width:400,height:150})})},dialogPasteAsMap:function(){Dialog.confirm("<h2>"+"js_create_as_map".tr()+'</h2><p class="hint" style="width:100%">'+"js_create_as_map_explanation".tr()+'</p><p><br/><input type="checkbox" value="true" name="insert_link" id="insert_link" class="checkbox" style="margin-left:3px" checked="checked"/>'+"js_create_as_map_add_link".tr()+
'<br/><input type="checkbox" value="true" name="insert_back_link" id="insert_back_link" class="checkbox" style="margin-left:3px" checked="checked"/>'+"js_create_as_map_add_back_link".tr()+'<br/><input type="checkbox" value="true" name="preserve_permissions" id="preserve_permissions" class="checkbox" style="margin-left:3px" checked="checked"/>'+"js_create_as_map_preserve_permissions".tr()+"</p>",{buttonClass:"button",okLabel:"OK",windowParameters:Object.extend(MM.ui.dialogs.defaultOptions(),{height:150,
width:360}),ok:function(){canvas.selected.node.pasteAsMap(_("insert_link").checked,_("preserve_permissions").checked,_("insert_back_link").checked);Dialog.cancelCallback()}})},dialogTextOutline:function(a,b){canvas.removeFocus();App._start_node_for_outline=$(a)._listener.node;var c;b?c="<h2>"+"js_copy_link".tr()+'</h2><div class="tabcontent notabs">':(c="<h2>"+"js_copy_as_text".tr()+'</h2><div class="tabcontent notabs"><label class="field">'+"js_text_outline".tr()+'</label><textarea id="map_text_outline" style="float:none;width:370px;height:190px;margin-bottom:5px">'+
Tree.utils.getTextOutline(App._start_node_for_outline,!0)+"</textarea>",c+='<p class="indented"><label class="checkbox"><input type="checkbox" checked onclick="$(\'map_text_outline\').value = Tree.utils.getTextOutline(App._start_node_for_outline, this.checked);" style="margin-right: 5px;" />'+"js_indent_topics".tr()+"</label></p>");var d=document.location.origin+"/"+App._start_node_for_outline.id+document.location.search;Dialog.alert(c+'<label class="field">'+"js_direct_link".tr()+'</label><input type="text" style="width:370px" value="'+
d+'" onclick="this.select()"/><span class="hint indented" style="display:block;margin-top:5px">Click on the text and use '+(isMac?"&#8984;":"CTRL")+"js_c_to_copy_content_to_clipboard".tr()+"</span></div>",{buttonClass:"button",okLabel:"js_close".tr(),windowParameters:Object.extend(MM.ui.dialogs.defaultOptions(),{width:560,height:b?150:370}),ok:function(){Dialog.closeInfo()}})},historyDialog:function(a){MM.utils.loadScript("/javascripts/app/ui/history.js",function(){RevisionBrowser.showDialog(null,
null,a)},function(){return"undefined"!=typeof RevisionBrowser})}};
var GeneralPopover=Class.create({initialize:function(a,b){this.options=Object.extend({showEffect:Effect.Appear,hideEffect:Effect.Fade,closeOnSelect:!0,autoPositioning:!0,observeEvent:"click",disableKeyMap:null,offset:[0,0],arrowSize:[16,16],useEffects:Modernizr.csstransitions},b);this.parent=$("popover_"+a);this.arrow=new Element("span",{"class":"arrow"});this.parent.insert(this.arrow);this.opener=this.options.opener||$("btn_"+a);this.field=$("fld_"+a);this.elementHolder=$("btn_"+a+"_bg");GeneralPopover.all.push(this);
this.opener&&"none"!=this.options.observeEvent&&(this.openerListener=this.togglePopover.bindAsEventListener(this),this.opener.observe(this.options.observeEvent,this.openerListener),this.options.useEffects&&(this.parent.style.opacity=0))},togglePopover:function(a){this.parent.visible()?this.close(a):this.show(a)},show:function(a){if(!(-1<this.opener.className.indexOf("disabled"))){this.opener&&this.opener.addClassName("selected");this.field&&this.field.addClassName("selected");this.parent.show();a&&
a.stop&&a.stop();GeneralPopover.opened&&!GeneralPopover.opened.isInPopover(this.parent)&&GeneralPopover.opened.close(a);GeneralPopover.opened=this;if(this.options.onShow)this.options.onShow();this.options.autoPositioning&&this.sizeAndPosition();this.options.useEffects&&(this.parent.style.opacity=1);this.options.disableKeyMap&&canvas.removeFocus();document.observe("click",this.clickListener);"mouseover"==this.options.observeEvent&&this.opener.observe("mouseout",this.openerListener)}},close:function(a){this.opener&&
0>this.opener.className.indexOf("tk_label")&&this.opener.removeClassName("selected");this.field&&this.field.removeClassName("selected");this.parent._clearAbove&&this.parent.removeClassName("above");this.options.disableKeyMap&&canvas.addFocus();this.options.useEffects?(this.parent.style.opacity=0,setTimeout(function(){this.parent.hide()}.bind(this),300)):this.parent.hide();a&&a.stop&&a.stop();GeneralPopover.opened=null;if(this.options.onClose)this.options.onClose();this.hideSubItems();document.stopObserving("click",
this.clickListener)},dispose:function(){"none"!=this.options.observeEvent&&(this.opener.stopObserving("mouseout",this.openerListener),this.opener.stopObserving("click",this.openerListener));document.stopObserving("click",this.clickListener)},hideSubItems:function(){this.parent.select("ul.submenu").invoke("hide")},sizeAndPosition:function(a){var a=a||[0,0],b=this.parent.getWidth(),c=this.parent.getHeight();this.arrow.style.left=b/2-this.options.arrowSize[0]-a[0]+"px";var d=this.parent.hasClassName("above")?
-c-this.options.arrowSize[1]+this.options.offset[1]:this.opener.getHeight()+this.options.arrowSize[1]+this.options.offset[1],e=(this.opener.getWidth()-b)/2+a[0]+this.options.offset[0];Element.clonePosition(this.parent,this.opener,{offsetTop:d,offsetLeft:e,setWidth:!1,setHeight:!1});d=Element.viewportOffset(this.parent);d!=[0,0]&&(0>d[0]?this.sizeAndPosition([a[0]+10,a[1]]):d[0]>MM.ui.page.width-b?this.sizeAndPosition([a[0]-10,a[1]]):d[1]>MM.ui.page.height-c&&c<d[1]&&(this.parent.addClassName("above"),
this.parent._clearAbove=!0,this.sizeAndPosition(a)))},isInPopover:function(a){for(;a.parentNode&&a.id!=this.parent.id;)a=a.parentNode;return a.id==this.parent.id},isOpener:function(a){if(!this.opener)return!1;for(;a.parentNode&&a!=this.opener;)a=a.parentNode;return a.id==this.opener.id},onDocumentClick:function(a){var b=Event.element(a);if(!("path"==b.tagName||"shape"==b.tagName)){!this.isInPopover(b)&&!this.isOpener(b)&&this.close(a);this.handler&&a.stop();if(this.popover)var c=this.popover.isPopoverEntry(b);
else if(this.popovers)for(var c=null,d=this.popovers.length;0<d&&!c;)d--,c=this.popovers[d].isPopoverEntry(b);return c?(this.options.closeOnSelect&&this.close(a),c):null}}});GeneralPopover.opened=null;GeneralPopover.all=[];GeneralPopover.get=function(a){return GeneralPopover.all.detect(function(b){return b.parent.id=="popover_"+a})};
var Popover=Class.create(GeneralPopover,{initialize:function($super,b,c,d){$super(b,d);this.handler=c;this.popover=new SubSection(this.parent,this.handler);d&&d.multiselect&&(this.popover.multiselect=!0);this.clickListener=this.onDocumentClick.bindAsEventListener(this)},addElements:function(a){this.popover.addElements(a)},removeElements:function(){this.popover.removeElements()},loadElements:function(a){this.popover.loadElements(a)},onDocumentClick:function($super,b){b&&b.stop();var c=$super(b);if(c)this.popover.onElementClicked(c)},
show:function($super,b){$super(b)},close:function($super,b){$super(b)},observeElement:function(a){this.elementHolderListener&&this.elementHolder.stopObserving("click",this.elementHolderListener);this.elementHolderListener=function(b){this.handler(a);Event.stop(b)}.bindAsEventListener(this);this.elementHolder.observe("click",this.elementHolderListener)}}),Select=Class.create(Popover,{initialize:function($super,b,c,d){this.onSelectElement=c;$super(b,this.onSelect.bind(this),d)},onSelect:function(a){if(this.onSelectElement)this.onSelectElement(a);
this.select(a)},select:function(a){a=$(a).clone(!0);a.id="";this.opener.update(a)}}),TabbedPopover=Class.create(GeneralPopover,{popovers:null,initialize:function($super,b,c){$super(b,c);this.popovers=[];this.clickListener=this.onDocumentClick.bindAsEventListener(this)},addSubSection:function(a,b,c){c=c||{};a=new Element("div",{id:"subsection_"+a,"class":"subsection"+(c.klass?" "+c.klass:"")});if(c.position)for(var d in c.position){var e=$("subsection_"+c.position[[d]])||$(c.position[[d]]);e?c.position[d]=
a:c.position=null}c.position?$(e).insert(c.position):this.parent.appendChild(a);b=new SubSection(a,b);c.multiselect&&(b.multiselect=!0);this.popovers.push(b)},addElementsToSubSection:function(a,b){var c=this.getSubSectionByName(a);c&&c.addElements(b)},moveElementToSubSection:function(a,b){var c=this.getSubSectionByName(a);c&&c.moveElement(b)},setTextContentToSubSection:function(a,b){var c=this.getSubSectionByName(a);c&&c.setTextContent(b)},removeElementFromSubSection:function(a,b){var c=this.getSubSectionByName(a);
c&&c.removeElement(b)},removeElements:function(){for(;0<this.popovers.length;)this.popovers.pop().removeElements();this.parent.select(".subsection").invoke("remove")},setTitleToSubSection:function(a,b){var c=this.getSubSectionByName(a);c&&c.setTitle(b)},onDocumentClick:function($super,b){b&&b.stop();var c=$super(b);if(c){var d=this.getParentSubSection(c);if(d)d.onElementClicked(c)}},getParentSubSection:function(a){for(;a!=document&&!a.className.include("subsection");)a=a.parentNode;if(a!=document){for(var b=
0;b<this.popovers.length&&this.popovers[b].parent.id!=a.id;)b++;return b>=this.popovers.length?null:this.popovers[b]}return null},getSubSectionByName:function(a){for(var b=0;b<this.popovers.size()&&this.popovers[b].parent.id!="subsection_"+a;)b++;return b>=this.popovers.size()?null:this.popovers[b]},observeElement:function(a,b){this.elementHolderListener&&this.elementHolder.stopObserving("click",this.elementHolderListener);b&&a&&(this.elementHolderListener=function(c){b(a);Event.stop(c)}.bindAsEventListener(this),
this.elementHolder.observe("click",this.elementHolderListener))},show:function($super,b){$super(b)},close:function($super,b){$super(b)},addContainer:function(a,b,c){a=new GeneralContainer(a,"subsection"+(b?" "+b:""));c?$(a.parent).insert(c):this.parent.appendChild(a.parent);return a}}),SubSection=Class.create({multiselect:!1,initialize:function(a,b,c){this.parent=a;this.handler=b;this.options=c;this.elements=[]},loadElements:function(a){new Ajax.Request(a,{onSuccess:function(a){a=a.responseText.evalJSON();
this.addElements(a);this.parent.removeClassName("loading")}.bind(this)})},addElements:function(a){this.list=this.list||new Element("ul");for(var b=0,c=a.length;b<c;b++)this.addElement(a[b]);this.parent.appendChild(this.list);this.parent.hasClassName("menu")&&this.bindSubItems()},addElement:function(a){var b=new Element("li");Object.isElement(a)?b.appendChild(a):b.update(a);this.elements.push(b);this.list.appendChild(b)},moveElement:function(a){this.parent.insert(a,{bottom:this.parent});a.show()},
removeElements:function(){this.list&&(this.list.remove(),this.list=null,this.elements=[])},removeElement:function(a){for(var b=0;b<this.list.childElements().length&&this.list.childElements()[b].firstDescendant().id!=a;)b++;b<this.list.childElements().length&&this.list.childElements()[b].remove()},onElementClicked:function(a){hasClassName(a,"disabled")||(this.parent.hasClassName("menu")||(this.multiselect?-1!=a.parentNode.className.indexOf("selected")?removeClassName(a.parentNode,"selected"):addClassName(a.parentNode,
"selected"):(this.elements.each(function(a){removeClassName(a,"selected")}),addClassName(a.parentNode,"selected"))),this.handler&&this.handler(a.id,a.name))},setTitle:function(a){var b=new Element("span");b.update(a);this.parent.insert({top:b})},setTextContent:function(a){var b=new Element("p");b.update(a);this.parent.appendChild(b)},isPopoverEntry:function(a){for(;a.parentNode&&"LI"!=a.parentNode.tagName;)a=a.parentNode;return a.parentNode&&(-1!=this.elements.indexOf(a.parentNode)||this.isSubItemEntry(a.parentNode))?
a:null},isSubItemEntry:function(a){return a.parentNode.hasClassName("popover")},bindSubItems:function(){this.parent.select(".subitem").invoke("observe","mouseover",function(){-1==this.className.indexOf("disabled")&&(this._hovering=!0)&&this.down(".submenu").setStyle({top:"-1px",left:this.getWidth()-2+"px"}).show(!0)}).invoke("observe","mouseout",function(a){a.element().hasClassName("subitem")&&(this._hovering=null,this.down(".submenu").hide())})},insertNewlines:function(a){for(var b=this.list.childElements(),
c=a;c<b.length;c+=a)b[c].className="newline"}}),GeneralContainer=Class.create({parent:null,initialize:function(a,b){this.parent=$(a)||new Element("div",{id:a,"class":"container"+(b?" "+b:"")})},addWidget:function(a){this.parent.appendChild(a.parent)}});
MM.ui.ToolTips=Class.create({objTip:void 0,tipsArray:[],half_width:135,initialize:function(){this.tipsArray=[];objBody=$$("body")[0];this.objTip=new Element("div",{id:"tooltips_tip","class":"popover tip",style:"visibility:hidden"});this.arrow=new Element("span",{"class":"arrow"});this.objTip.insert(this.arrow);this.content=new Element("div",{id:"tooltip_content"});this.objTip.insert(this.content);objBody.appendChild(this.objTip);this.setupTooltips()},setupTooltips:function(){cnt=0;$$(".tooltip").each(function(a){var b=
a.title&&0<a.title.length?a.title:a.select(".tip")[0].innerHTML;b&&0<b.length&&(a.observe("mouseover",function(a){a.stop();this.handleMouseOver(a)}.bind(this)),a.observe("mousemove",function(a){a.stop();this.handleMouseMove(a)}.bind(this)),a.observe("mouseout",function(a){a.stop();this.handleMouseOut(a)}.bind(this)),this.tipsArray[cnt]=b,a.tip_num=cnt++,a.removeAttribute("title"))}.bind(this))},position:function(a,b){a&&(this.objTip.style.left=b.pointerX()-this.half_width+"px",this.objTip.style.top=
b.pointerY()+35+"px")},handleMouseOver:function(a){if(target=a.findElement(".tooltip")){_("tooltip_content").innerHTML=this.tipsArray[target.tip_num];this.half_width=this.objTip.clientWidth/2;this.arrow.style.left=this.half_width-16+"px";this.objTip.style.visibility="visible";if(image=a.findElement(".tooltip img"))image.alt="";this.position(target,a)}},handleMouseMove:function(a){var b=a.findElement(".tooltip");this.position(b,a)},handleMouseOut:function(){this.objTip.style.visibility="hidden"}});
MM.ui.Activity=Class.create({threshold:50,initialize:function(a,b){this.options=b||{};this.element=(new Element("div",{id:"activity","class":"hud very-rounded",style:"visibility: hidden"})).update(a);this.options.progress&&(this.progressbar=new Element("span"),this.element.insert((new Element("div",{"class":"progress"})).insert(this.progressbar)),this.options.autoUpdate&&(this.increment=this.options.duration?this.options.duration/100:50,this.interval=setInterval(this.update.bind(this,null),this.increment)),
this.progress=0);WindowUtilities.disableScreen("activity","overlay",1);MM.ui.centerAndShow(this.element)},update:function(a){a||(a=this.progress+=1);this.progressbar.style.width=a+"%";this.progress=a;100==this.progress?(this.progressbar.addClassName("full"),clearInterval(this.interval)):this.progress>this.threshold&&this.options.autoUpdate&&(this.threshold+=5,this.increment*=1.2,clearInterval(this.interval),this.interval=setInterval(this.update.bind(this,null),this.increment))},close:function(){WindowUtilities.enableScreen("activity");
this.element&&this.element.remove()}});
MM.ui.Notification={show:function(a){0<=a.type.indexOf("title")&&this.showTitle(a);0<=a.type.indexOf("popup")&&this.showPopup(a)},showTitle:function(a){document.body.hasClassName("hidden")&&(this.param=a,this.interval=setInterval(MM.ui.Notification.setFlashTitle,1500),MM.onfocus.push(MM.ui.Notification.clearFlashTitle))},setFlashTitle:function(){var a=MM.ui.Notification;document.title=document.title==MM.ui.pageTitle?a.param.title:MM.ui.pageTitle},clearFlashTitle:function(){var a=MM.ui.Notification;
document.title=MM.ui.pageTitle;clearInterval(a.interval);MM.onfocus=MM.onfocus.without(a.clearFlashTitle)},showPopup:function(a){if(window.webkitNotifications)if(0!=window.webkitNotifications.checkPermission())this.requestPermission();else{if(a.title)var b=window.webkitNotifications.createNotification("/images/logos/mmicon_square_72x72_ipad.png",a.title,a.message||"");else a.url&&(b=window.webkitNotifications.createHTMLNotification(a.url));a.persist||(b.ondisplay=function(){setTimeout(function(){this.cancel()}.bind(this),
7E3)}.bind(b));b.show();return b}},requestPermission:function(){Dialog.confirm('<h2>Enable Notifications</h2><p>You need to allow MindMeister to display web notifications . Please click OK and then click "Allow" in the permissions bar on top of this window.</p>',{ok:function(){Dialog.cancelCallback();window.webkitNotifications.requestPermission()},okLabel:"OK",windowParameters:Object.extend(MM.ui.dialogs.defaultOptions(),{height:100,width:360})})}};
MM.ui.Tokenizer=Class.create({initialize:function(a){this.field=$(a);this.values=[];this.element=new Element("ul",{"class":"tokenizer input"});this.tester=new Element("div",{"class":"tester"});this.field.parentNode.insertBefore(this.element,this.field);this.element.insert((new Element("li")).insert(this.field));this.element.insert((new Element("li")).insert(this.tester));this.element.observe("click",this.focus.bind(this));this.field.observe("keypress",this.onKeyPress.bind(this));this.field.observe("keyup",
this.resize.bind(this));this.field.observe("blur",this.blur.bind(this));if(this.form=this.element.up("form"))this.form.tokenizer=this,this.form._onsubmit=this.form.onsubmit,this.form.onsubmit=this.submit.bind(this);this.focus()},submit:function(){this.field.style.visibility="hidden";this.field.value=this.values.join(",");this.form._onsubmit();return!1},focus:function(){this.field.focus()},blur:function(){this.tokenize(!0)},resize:function(){this.tester.innerHTML=this.field.value;this.field.style.width=
this.tester.clientWidth+25+"px";this.tokenize()},tokenize:function(a){var b=this.field.value.strip().replace(/^,/g,"").strip(),c=!1;if(a||0<b.indexOf(",")){a=b.split(",");for(b=0;b<a.length;b++)if(a[b].length){var d=a[b].strip();MM.utils.validateEmail(d)?this.addToken(d,d):c=!0}}c?MM.ui.showFieldError(this.field.id,"js_email_invalid".tr()):MM.ui.hideFieldError(this.field.id)},addToken:function(a,b){var c=new MM.ui.Token(this,a,b);this.element.insertBefore(c.element,this.field.parentNode);this.field.value=
"";this.values.push(c.value);this.resize();WindowUtilities.focusedWindow&&WindowUtilities.focusedWindow.updateHeight();isIE8||this.focus()},removeToken:function(a){a.element.remove();this.values=this.values.without(a.value)},onKeyPress:function(a){switch(a.keyCode){case Event.KEY_BACKSPACE:case Event.KEY_DELETE:0==this.field.value.length&&0<this.values.length&&(this.removeToken(this.element.childElements()[this.values.length-1].token),this.focus(),a.stop());break;case Event.KEY_RETURN:this.tokenize(!0),
a.stop()}},onShow:function(a,b){$(b).select("li").each(function(a){a.scrollIntoView=function(){}});Position.clone(this.element,b,{setHeight:!1,offsetTop:this.element.offsetHeight});Effect.Appear(b,{duration:0.15})},updateElement:function(a){var b=Element.collectTextNodes(a.select(".label")[0]),a=Element.collectTextNodes(a.select(".value")[0]);0<=this.values.indexOf(a)?this.element.childElements()[this.values.indexOf(a)].token.select():this.addToken(b,a)}});
MM.ui.Token=Class.create({initialize:function(a,b,c){this.element=(new Element("li",{"class":"token",tabindex:"-1"})).insert((new Element("span")).update(b));this.closer=new Element("span",{"class":"x"});this.element.insert(this.closer);this.element.token=this;this.tokenizer=a;this.value=c;this.selected=!1;Event.observe(this.element,"click",this.onclick.bindAsEventListener(this));Event.observe(this.closer,"click",this.remove.bindAsEventListener(this))},select:function(a){this.selected=!0;this.tokenizer.selected=
this;this.element.addClassName("selected");Event.observeOnce(document,"click",this.deselect.bind(this));a&&Event.stop(a)},deselect:function(){this.selected=!1;this.tokenizer.selected=null;this.element.removeClassName("selected")},onclick:function(a){this.selected?this.deselect(a):this.select(a)},remove:function(){this.tokenizer.removeToken(this)}});
MM.ui.Lightbox=function(){var d,b,j,h,k,l,m,n,p,q,r=0;return{show:function(a,e,c,i,g,f,s){r||(b=new Element("div",{id:"lightbox","class":"popover"+(s?" "+s:"")}),j=new Element("div",{id:"tinymask"}),h=new Element("div",{id:"tinycontent"}),document.body.appendChild(j),document.body.appendChild(b),b.appendChild(h),d=new Element("div",{id:"tinyclose"}),b.appendChild(d),d.onclick=MM.ui.Lightbox.hide,j.onclick=MM.ui.Lightbox.hide,window.onresize=MM.ui.Lightbox.resize,r=1);g?(h.style.display="none",b.style.width=
b.style.height="100px"):(b.style.width=c?c+"px":"auto",b.style.height=i?i+"px":"auto",b.style.backgroundImage="none");e||(h.innerHTML=a);this.mask();k=a;l=e;m=c;n=i;p=g;this.alpha(j,1,80,3);f&&setTimeout(function(){MM.ui.Lightbox.hide()},1E3*f);if(q=$("tinybox_image"))q.onload=function(){MM.ui.Lightbox.pos()}},fill:function(a,e,c,i,g){if(e){b.style.backgroundImage="";var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");f.onreadystatechange=function(){4==f.readyState&&
200==f.status&&MM.ui.Lightbox.psh(f.responseText,c,i,g)};f.open("GET",a,1);f.send(null)}else this.psh(a,c,i,g)},psh:function(a,e,c,i){if(i){if(!e||!c){var i=b.style.width,g=b.style.height;h.innerHTML=a;b.style.width=e?e+"px":"";b.style.height=c?c+"px":"";h.style.display="";e=parseInt(h.offsetWidth);c=parseInt(h.offsetHeight);h.style.display="none";b.style.width=i;b.style.height=g}else h.innerHTML=a;this.size(b,e,c,4)}else b.style.backgroundImage="none",h.innerHTML=a},hide:function(){MM.ui.Lightbox.alpha(b,
-1,0,3)},resize:function(){MM.ui.Lightbox.pos();MM.ui.Lightbox.mask()},mask:function(){j.style.height=MM.ui.Page.theight()+"px";j.style.width="";j.style.width=MM.ui.Page.twidth()+"px"},pos:function(){var a=MM.ui.Page.height()/2-b.offsetHeight/2;b.style.top=(10>a?10:a)+MM.ui.Page.top()+"px";b.style.left=MM.ui.Page.width()/2-b.offsetWidth/2+"px"},alpha:function(a,b,c,i){clearInterval(a.ai);1==b&&(a.style.opacity=0,a.style.filter="alpha(opacity=0)",a.style.display="block",this.pos());a.ai=setInterval(function(){MM.ui.Lightbox.twalpha(a,
c,b,i)},10)},twalpha:function(a,e,c,i){var g=Math.round(100*a.style.opacity);g==e?(clearInterval(a.ai),-1==c?(a.style.display="none",a==b?MM.ui.Lightbox.alpha(j,-1,0,2):h.innerHTML=b.style.backgroundImage=""):a==j?this.alpha(b,1,100,5):MM.ui.Lightbox.fill(k,l,m,n,p)):(e=g+Math.ceil(Math.abs(e-g)/i)*c,a.style.opacity=e/100,a.style.filter="alpha(opacity="+e+")")},size:function(a,b,c,i){a="object"==typeof a?a:$(a);clearInterval(a.si);var g=a.offsetWidth,f=a.offsetHeight,d=g-parseInt(a.style.width),h=
f-parseInt(a.style.height),j=g-d>b?-1:1,k=f-h>c?-1:1;a.si=setInterval(function(){MM.ui.Lightbox.twsize(a,b,d,j,c,h,k,i)},10)},twsize:function(a,e,c,d,g,f,j,k){c=a.offsetWidth-c;f=a.offsetHeight-f;5>Math.abs(e-c)&&5>Math.abs(g-f)?(clearInterval(a.si),b.style.backgroundImage="none",h.style.display="block"):(c!=e&&(a.style.width=c+Math.ceil(Math.abs(e-c)/k)*d+"px"),f!=g&&(a.style.height=f+Math.ceil(Math.abs(g-f)/k)*j+"px"),this.pos())}}}();
MM.ui.Page=function(){return{top:function(){return document.body.scrollTop||document.documentElement.scrollTop},width:function(){return self.innerWidth||document.documentElement.clientWidth},height:function(){return self.innerHeight||document.documentElement.clientHeight},theight:function(){var d=document,b=d.body,d=d.documentElement;return Math.max(Math.max(b.scrollHeight,d.scrollHeight),Math.max(b.clientHeight,d.clientHeight))},twidth:function(){var d=document,b=d.body,d=d.documentElement;return Math.max(Math.max(b.scrollWidth,
d.scrollWidth),Math.max(b.clientWidth,d.clientWidth))}}}();
MM.ui.SearchField=Class.create({initialize:function(a,b){this.options=Object.extend({defaultText:"js_search".tr(),observeEvent:"keyup"},b);this.field=$(a);this.parent=this.field.up();this.clearer=this.parent.select(".clearer")[0];Element.bindOnClick(this.clearer,this.clear.bind(this));this.field.observe("blur",this.defaultHint.bind(this));this.field.observe(this.options.observeEvent,this.update.bind(this));this.update();this.defaultHint()},getValue:function(){return this.field.value==this.options.defaultText?
"":this.field.value},defaultHint:function(){""==this.getValue()&&(this.field.value=this.options.defaultText,Form.defaultHint(this.field.id))},disable:function(){this.field.addClassName("disabled");this.field.disabled=!0},enable:function(){this.field.removeClassName("disabled");this.field.disabled=!1},blur:function(){this.defaultHint()},update:function(a){if(""!=this.getValue()){if(this.field.removeClassName("inactive"),this.parent.addClassName("active"),this.options.onChange&&a)this.options.onChange(this.getValue())}else this.clear(a)},
clear:function(a){this.field.value="";this.parent.removeClassName("active");if(this.options.onChange&&a)this.options.onChange(this.getValue())}});
MM.ui.OnOffSlider=Class.create({element:null,container:null,control:null,onoff:null,urlOn:null,urlOff:null,urlRedirect:null,formElem:null,initialize:function(a,b,c,d,e,f,g){this.element=a;this.container=$(b);this.parent=$(b).parentNode;this.urlOn=d;this.urlOff=e;this.urlRedirect=f;this.formElem=g;this.parent.select("span").each(function(a){a.observe("click",this.handleClick.bind(this,a))}.bind(this));this.control=new Control.Slider(this.element,this.container,{axis:"horizontal",range:$R(1,100),onSlide:this.handleSlide.bind(this),
onChange:this.handleChange.bind(this)});(this.onoff=c)?(this.control.setValue(100),this.handleSlide(100)):(this.control.setValue(1),this.handleSlide(1))},handleClick:function(a){this.handleChange(a.hasClassName("on")?2:99)},handleSlide:function(a){50<a?(this.parent.removeClassName("off"),this.parent.addClassName("on")):(this.parent.removeClassName("on"),this.parent.addClassName("off"))},failedOnOff:function(){Dialog.alert('<div id="dialog_onofffailed" align="center"><h2>'+"js_your_request_was_not_done".tr()+
'</h2></div><br /><div align="center"><h3>'+"js_we_are_sorry_request_was_not_done".tr()+"</h3></div>",{buttonClass:"button",okLabel:"OK",windowParameters:Object.extend(MM.ui.dialogs.defaultOptions(),{width:400,height:200,effectOptions:{},showEffect:Element.show,hideEffect:Element.hide})})},executeAction:function(a){this.formElem?this.formElem.call(this.formElem,this.onoff):this.urlRedirect?window.location=this.urlRedirect:"on"==a?new Ajax.Request(this.urlOn,{onFailure:this.failedOnOff.bind(this),
onException:this.failedOnOff.bind(this)}):"off"==a&&new Ajax.Request(this.urlOff,{onFailure:this.failedOnOff.bind(this),onException:this.failedOnOff.bind(this)})},handleChange:function(a){this.handleSlide(a);100==a?this.onoff||(this.onoff=!0,this.executeAction("on")):1==a?this.onoff&&(this.onoff=!1,this.executeAction("off")):50<a?this.control.setValue(100):this.control.setValue(1)}});
MM.ui.Chart=Class.create({initialize:function(b,a,c,e,d,f,g){this.el=$(b);this.data=c;this.colors=e;this.size=g;this.labels=d;this.axisLabels=f;google.load("visualization","1",{packages:["corechart"]});google.setOnLoadCallback(this.draw.bind(this))}});
MM.ui.Chart.Pie=Class.create(MM.ui.Chart,{draw:function(){var b=new google.visualization.DataTable;b.addColumn("string","x");b.addColumn("number","y");for(var a=0,c=this.data.length;a<c;a++)b.addRow([this.labels[a],this.data[a]]);a=this.size.split("x")[0];c=this.size.split("x")[1];a={width:a,height:c,title:this.title,colors:this.colors,legend:{position:"bottom",textStyle:{color:"#5B636B",fontName:"Arial",fontSize:10}}};(new google.visualization.PieChart(this.el)).draw(b,a)}});
MM.ui.Chart.Line=Class.create(MM.ui.Chart,{draw:function(){var b=new google.visualization.DataTable;b.addColumn("string","x");for(var a=0,c=this.data.length;a<c;a++)b.addColumn("number",this.labels[a]);a=0;for(c=this.data[0].length;a<c;a++){for(var e=[this.axisLabels[a]],d=0,f=this.data.length;d<f;d++)e.push(this.data[d][a]);b.addRow(e)}a=this.size.split("x")[0];c=this.size.split("x")[1];a={width:a,height:c,title:this.title,colors:this.colors,legend:{position:"bottom",textStyle:{color:"#5B636B",fontName:"Arial",
fontSize:10}},hAxis:{textStyle:{color:"#5B636B",fontName:"Arial",fontSize:10},gridlines:{color:"#dddddd",count:12}},vAxis:{textStyle:{color:"#5B636B",fontName:"Arial",fontSize:10},gridlines:{color:"#dddddd",count:10}}};(new google.visualization.LineChart(this.el)).draw(b,a)}});MM.ui.Chart.Bar=Class.create(MM.ui.Chart,{draw:function(){}});
Object.extend(MM.ui,{googlePicker:{init:function(a){"undefined"!=typeof google&&(google.load("picker","1",{language:a.language}),this.options=a,this.loaded=!0)},create:function(){if("undefined"!=typeof google){Windows.close("import");var a=new google.picker.View(google.picker.ViewId.DOCS);this.options.view&&(a=this.options.view);this.options.mimeTypes&&a.setMimeTypes(this.options.mimeTypes);(new google.picker.PickerBuilder).setAppId(this.options.appId).addView(a).enableFeature(google.picker.Feature.NAV_HIDDEN).setCallback(MM.ui.googlePicker.onLoad.bind(MM.ui.googlePicker)).build().setVisible(!0);
return!1}},onLoad:function(a){if(a.action==google.picker.Action.PICKED)if(a=google.picker.ResourceId.generate(a.docs[0]).split(":")[1],this.options.onLoad)this.options.onLoad(a);else window.location.href="/external/drive/do_open?file_id="+a}}});
MM.ui.Friends={init:function(){_("friends_list")&&($("friends_list").select("li").invoke("observe","click",MM.ui.Friends.selectUser),$("friends_list").select("li").invoke("observe","dblclick",MM.ui.Friends.addUsers));_("groups_list")&&$("groups_list").select("li").invoke("observe","click",MM.ui.Friends.expandGroup)},loadUsers:function(a){a.type&&MM.utils.setCookie("tab_friends",a.type);new Ajax.Request("/sharing/friends?"+Object.toQueryString(a),{asynchronous:!0,evalScripts:!0,onComplete:function(b){b=
b.responseText;if("{"==b[0])b=b.evalJSON(),b.error&&(b.error.code&&407==b.error.code&&"Authentication Needed"==b.error.message)&&(window.location.href=b.error.url);else if(_("friends_content"))$("friends_content").update(b),MM.ui.Friends.init();else{var a=new Window("friends",Object.extend(MM.ui.dialogs.defaultOptions(),{height:380,width:600,noHelp:!0}));a.setHTMLContent(b);a.setDestroyOnClose();a.showCenter(1);MM.ui.Friends.init();return!1}}})},addUsers:function(){var a=$("friends_list").select("li.selected");
"undefined"==typeof MM.ui.shareTokenizer?"undefined"!=typeof mapList?mapList.utils.invitePeople(function(){setTimeout(function(){a.each(function(a){MM.ui.shareTokenizer.updateElement(a)})}.bind(null),500)}.bind(null)):App.config.map_id&&MM.ui.dialogs.dialogInvite(App.config.map_id,function(){setTimeout(function(){a.each(function(a){MM.ui.shareTokenizer.updateElement(a)})}.bind(null),500)}.bind(null)):a.each(function(a){MM.ui.shareTokenizer.updateElement(a)});Windows.close("friends");_("loading_friends")&&
hide(_("loading_friends"));_("friends_opener")&&show(_("friends_opener"));Windows.focusedWindow&&Windows.focusedWindow.updateHeight()},cancelDialog:function(){Windows.close("friends");hide(_("loading_friends"));show(_("friends_opener"))},selectUser:function(a){var b=isMac?a.metaKey:a.ctrlKey,d=Event.element(a);if(d)if(hasClassName(d,"selector")&&(b=!0),!b&&!a.shiftKey&&MM.ui.Friends.unSelectAll(),a.shiftKey){var c=!1;$("friends_list").select("li").each(function(a){if(a==this||a==MM.ui.Friends.lastSelected)(c=
!c)||a.addClassName("selected");c&&a.addClassName("selected")}.bind(this))}else this.hasClassName("selected")?(this.removeClassName("selected"),0==$("friends_list").select("li.selected").length&&(MM.ui.Friends.lastSelected=null)):(this.addClassName("selected"),MM.ui.Friends.lastSelected=this)},selectAll:function(){$("friends_list").select("li").invoke("addClassName","selected");MM.ui.Friends.lastSelected=$("friends_list").select("li").last()},expandGroup:function(a){if(a=Event.element(a))if(a="value"==
a.className&&"span"==a.tagName.toLowerCase()?a:"label"==a.className&&"span"==a.tagName.toLowerCase()?siblings(a,function(a){return"value"==a.className&&"span"==a.tagName.toLowerCase()})[0]:descendants(a,function(a){return"value"==a.className&&"span"==a.tagName.toLowerCase()})[0])return addClassName(a.parentNode.parentNode,"loading"),new Ajax.Request("/sharing/contact_group/",{parameters:{id:a.innerHTML}}),!1},getGroups:function(){new Ajax.Request("/sharing/contact_groups/");return!1},unSelectAll:function(){$("friends_list").select("li").invoke("removeClassName",
"selected");MM.ui.Friends.lastSelected=null}};
MM.utils.SHA1={translate:function(d){function k(a,b){return a<<b|a>>>32-b}function l(a){var b="",c,d;for(c=7;0<=c;c--)d=a>>>4*c&15,b+=d.toString(16);return b}var a,c,h=Array(80),m=1732584193,n=4023233417,p=2562383102,q=271733878,r=3285377520,b,f,g,i,j;a=d.replace(/\r\n/g,"\n");for(var e="",d=0;d<a.length;d++)c=a.charCodeAt(d),128>c?e+=String.fromCharCode(c):(127<c&&2048>c?e+=String.fromCharCode(c>>6|192):(e+=String.fromCharCode(c>>12|224),e+=String.fromCharCode(c>>6&63|128)),e+=String.fromCharCode(c&
63|128));d=e;b=d.length;e=[];for(a=0;a<b-3;a+=4)c=d.charCodeAt(a)<<24|d.charCodeAt(a+1)<<16|d.charCodeAt(a+2)<<8|d.charCodeAt(a+3),e.push(c);switch(b%4){case 0:a=2147483648;break;case 1:a=d.charCodeAt(b-1)<<24|8388608;break;case 2:a=d.charCodeAt(b-2)<<24|d.charCodeAt(b-1)<<16|32768;break;case 3:a=d.charCodeAt(b-3)<<24|d.charCodeAt(b-2)<<16|d.charCodeAt(b-1)<<8|128}for(e.push(a);14!=e.length%16;)e.push(0);e.push(b>>>29);e.push(b<<3&4294967295);for(d=0;d<e.length;d+=16){for(a=0;16>a;a++)h[a]=e[d+a];
for(a=16;79>=a;a++)h[a]=k(h[a-3]^h[a-8]^h[a-14]^h[a-16],1);c=m;b=n;f=p;g=q;i=r;for(a=0;19>=a;a++)j=k(c,5)+(b&f|~b&g)+i+h[a]+1518500249&4294967295,i=g,g=f,f=k(b,30),b=c,c=j;for(a=20;39>=a;a++)j=k(c,5)+(b^f^g)+i+h[a]+1859775393&4294967295,i=g,g=f,f=k(b,30),b=c,c=j;for(a=40;59>=a;a++)j=k(c,5)+(b&f|b&g|f&g)+i+h[a]+2400959708&4294967295,i=g,g=f,f=k(b,30),b=c,c=j;for(a=60;79>=a;a++)j=k(c,5)+(b^f^g)+i+h[a]+3395469782&4294967295,i=g,g=f,f=k(b,30),b=c,c=j;m=m+c&4294967295;n=n+b&4294967295;p=p+f&4294967295;
q=q+g&4294967295;r=r+i&4294967295}j=l(m)+l(n)+l(p)+l(q)+l(r);return j.toLowerCase()}};
MM.onfocus=[];MM.onblur=[];MM.onload.add(function(){addClassName(document.body,"visible")});
(function(){function e(a){a=a||window.event;"focus"==a.type||"focusin"==a.type?f():"blur"==a.type||"focusout"==a.type?g():this[b]?g():f()}function f(){removeClassName(document.body,"hidden");addClassName(document.body,"visible");for(var a=0;a<MM.onfocus.length;a++)MM.onfocus[a]()}function g(){removeClassName(document.body,"visible");addClassName(document.body,"hidden");for(var a=0;a<MM.onblur.length;a++)MM.onblur[a]()}var b,c,d={hidden:"visibilitychange",mozHidden:"mozvisibilitychange",webkitHidden:"webkitvisibilitychange",
msHidden:"msvisibilitychange",oHidden:"ovisibilitychange"};for(b in d)if(d.hasOwnProperty(b)&&b in document){c=d[b];break}c?document.addEventListener(c,e):window.onfocus=window.onblur=e})();
function LinkedList(){}LinkedList.prototype={length:0,first:null,last:null};LinkedList.Doubly=function(){};LinkedList.Doubly.prototype=new LinkedList;LinkedList.Doubly.prototype.insertAfter=function(a,c){c.next=a.next;c.prev=a;null===a.next?this.last=c:a.next.prev=c;a.next=c;this.length++};LinkedList.Doubly.prototype.insertBefore=function(a,c){c.prev=a.prev;c.next=a;null===a.prev?this.first=c:a.prev.next=c;a.prev=c;this.length++};
LinkedList.Doubly.prototype.insertBeginning=function(a){null===this.first?(this.last=this.first=a,a.prev=null,a.next=null,this.length++):this.insertBefore(this.first,a)};LinkedList.Doubly.prototype.insertEnd=function(a){null===this.last?this.insertBeginning(a):this.insertAfter(this.last,a)};LinkedList.Doubly.prototype.remove=function(a){null===a.prev?this.first=a.next:a.prev.next=a.next;null===a.next?this.last=a.prev:a.next.prev=a.prev;this.length--};
LinkedList.Doubly.prototype.each=function(a,c){for(var b=this.first,d=0;b;)a.call(c,b,d),b=b.next,d++};LinkedList.Doubly.prototype.indexOf=function(a){for(var c=this.first,b=0;c!=a&&c.next;)c=c.next,b++;return c!=a?-1:b};LinkedList.Doubly.prototype.detect=function(a,c){for(var b=this.first,d=!1;b&&!d;)d=a.call(c,b),d||(b=b.next);return d?b:null};LinkedList.Doubly.prototype.map=function(a,c){for(var b=this.first,d=[];b;)d.push(a.call(c,b)),b=b.next;return d};
LinkedList.Doubly.prototype.sort=function(a){function c(b){if(1===b.length)return b;for(var d=new LinkedList.Doubly,e=new LinkedList.Doubly,f=b.length/2,h=0,g=b.first;g;){var i=g.next;h<f?(b.remove(g),d.insertEnd(g)):(b.remove(g),e.insertEnd(g));g=i;h++}d=c(d);e=c(e);b=d;for(d=new LinkedList.Doubly;0<b.length||0<e.length;)0<b.length&&0<e.length?(a(b.first,e.first)?(f=b.first,b.remove(b.first)):(f=e.first,e.remove(e.first)),d.insertEnd(f)):0<b.length?(f=b.first,b.remove(b.first),d.insertEnd(f)):0<
e.length&&(f=e.first,e.remove(e.first),d.insertEnd(f));return d}return 0==this.length?this:c(this)};LinkedList.Node=function(a){this.data=a;this.next=this.prev=null};
window._mm_file_versions = window._mm_file_versions || {}; _mm_file_versions['bin/core.js'] = '24341M';
